function rainbowPastel(a,b){var c,d,e,f=b/a,g=~~(6*f),h=6*f-g,i=1-h;switch(g%6){case 0:c=1,d=h,e=0;break;case 1:c=i,d=1,e=0;break;case 2:c=0,d=1,e=h;break;case 3:c=0,d=i,e=1;break;case 4:c=h,d=0,e=1;break;case 5:c=1,d=0,e=i}var j=~~(255*c),k=~~(255*d),l=~~(255*e);j=(j+255)/2,k=(k+255)/2,l=(l+255)/2;var m="#"+("00"+(~~j).toString(16)).slice(-2)+("00"+(~~k).toString(16)).slice(-2)+("00"+(~~l).toString(16)).slice(-2);return m}function updateSlider(a){var b=$("#bpmChosen").html();NeuronalSynchrony.clock.timeStretch(NeuronalSynchrony.clock._events,b/a),console.log("setting tempo from "+b+" to "+a+" value / bpm: "+b/a),$("#bpmChosen").html(a)}function makeTriangle(a,b,c){var d=.33*TWO_PI,e=.66*TWO_PI,f=TWO_PI,g=[new Two.Anchor(c*Math.cos(d)+a,c*Math.sin(d)+b),new Two.Anchor(c*Math.cos(e)+a,c*Math.sin(e)+b),new Two.Anchor(c*Math.cos(f)+a,c*Math.sin(f)+b)],h=two.makePolygon(g);return h}function colorsEqual(a,b,c){var d=c||.25;return Math.abs(a.r-b.r)<d&&Math.abs(a.g-b.g)<d&&Math.abs(a.b-b.b)<d}function ease(a,b,c){var d=b-a;return Math.abs(d)<=1e-4?b:a+d*c}function toRGB(a){return"rgb("+Math.round(a.r)+","+Math.round(a.g)+","+Math.round(a.b)+")"}function angleBetween(a,b){var c=b.x-a.x,d=b.y-b.y;return Math.atan2(d,c)}function negate(a){return-1*a}function lerp(a,b,c){return(b-a)*c+a}function map(a,b,c,d,e){return d+(e-d)*((a-b)/(c-b))}function sigmoid(a,b,c,d){var d=d||.2;return lerp(a,b,d*c/((1+d)*c))}!function(){var a=this,b=a.has||{},c=a.navigator.userAgent,d={Android:!!c.match(/Android/gi),Blackberry:!!c.match(/BlackBerry/gi),iOS:!!c.match(/iPhone|iPad|iPod/gi),OperaMini:!!c.match(/Opera Mini/gi),Windows:!!c.match(/IEMobile/gi),WebOS:!!c.match(/webOS/gi),Arora:!!c.match(/Arora/gi),Chrome:!!c.match(/Chrome/gi),Epiphany:!!c.match(/Epiphany/gi),Firefox:!!c.match(/Firefox/gi),InternetExplorer:!!c.match(/MSIE/gi),Midori:!!c.match(/Midori/gi),Opera:!!c.match(/Opera/gi),Safari:!!c.match(/Safari/gi),webgl:function(){try{return!(!window.WebGLRenderingContext||!document.createElement("canvas").getContext("webgl")&&!document.createElement("canvas").getContext("experimental-webgl"))}catch(a){return!1}}(),noConflict:function(){return b}};d.mobile=d.Android||d.Blackberry||d.iOS||d.OperaMini||d.Windows||d.WebOS,a.has=d}(),function(a){var b={},c=a.indexOf("#");a.substring(a.indexOf("?")).replace(/([^?=&]+)(=([^&]+))?/g,function(a,c,d,e){b[c]=e}),b["boolean"]=function(a,c){return b.hasOwnProperty(a)?"false"!==b[a]:c},b["float"]=function(a,c){var d=parseFloat(b[a]);return d!=d?c:d},b["int"]=function(a,c){var d=parseInt(b[a],10);return d!=d?c:d},b.hash=-1==c?void 0:a.substring(c+1),b.setUrl=arguments.callee,window.url=b}(location.href);var TWEEN=TWEEN||function(){var a={},b=0;return{REVISION:"10-br1",generateId:function(){var a=b;return b++,a},getAll:function(){return a},removeAll:function(){a={}},add:function(b){a[b.id]=b},remove:function(b){delete a[b.id]},update:function(b){b=void 0!==b?b:void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();for(var c in a)a[c].update(b)?c++:delete a[c];return!0}}}();TWEEN.Tween=function(a){var b=a,c={},d={},e={},f=1e3,g=0,h=0,i=null,j=TWEEN.Easing.Linear.None,k=TWEEN.Interpolation.Linear,l=[],m=null,n=!1,o=null,p=null;this.id=TWEEN.generateId(),this.to=function(a,b){return void 0!==b&&(f=b),d=a,this},this.start=function(a){TWEEN.add(this),n=!1,i=void 0!==a?a:void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),i+=h;for(var f in d)if(f in b!=!1&&null!==b[f]){if(d[f]instanceof Array){if(0===d[f].length)continue;d[f]=[b[f]].concat(d[f])}c[f]=b[f],c[f]instanceof Array==0&&(c[f]*=1),e[f]=c[f]}return this},this.stop=function(){return TWEEN.remove(this),this},this.delay=function(a){return h=a,this},this.repeat=function(a){return g=a,this},this.easing=function(a){return j=a,this},this.interpolation=function(a){return k=a,this},this.chain=function(){return l=arguments,this},this.onStart=function(a){return m=a,this},this.onUpdate=function(a){return o=a,this},this.onComplete=function(a){return p=a,this},this.getObject=function(){return b},this.getOnComplete=function(){return p},this.update=function(a){if(i>a)return!0;n===!1&&(null!==m&&m.call(b),n=!0);var q=(a-i)/f;q=q>1?1:q;var r=j(q);for(var s in c){var t=c[s],u=d[s];b[s]=u instanceof Array?k(u,r):t+(u-t)*r}if(null!==o&&o.call(b,r),1==q){if(g>0){isFinite(g)&&g--;for(var s in e)c[s]=e[s];return i=a+h,!0}null!==p&&p.call(b);for(var v=0,w=l.length;w>v;v++)l[v].start(a);return!1}return!0}},TWEEN.Easing={Linear:{None:function(a){return a}},Quadratic:{In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){return(a*=2)<1?.5*a*a:-.5*(--a*(a-2)-1)}},Cubic:{In:function(a){return a*a*a},Out:function(a){return--a*a*a+1},InOut:function(a){return(a*=2)<1?.5*a*a*a:.5*((a-=2)*a*a+2)}},Quartic:{In:function(a){return a*a*a*a},Out:function(a){return 1- --a*a*a*a},InOut:function(a){return(a*=2)<1?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)}},Quintic:{In:function(a){return a*a*a*a*a},Out:function(a){return--a*a*a*a*a+1},InOut:function(a){return(a*=2)<1?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)}},Sinusoidal:{In:function(a){return 1-Math.cos(a*Math.PI/2)},Out:function(a){return Math.sin(a*Math.PI/2)},InOut:function(a){return.5*(1-Math.cos(Math.PI*a))}},Exponential:{In:function(a){return 0===a?0:Math.pow(1024,a-1)},Out:function(a){return 1===a?1:1-Math.pow(2,-10*a)},InOut:function(a){return 0===a?0:1===a?1:(a*=2)<1?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)}},Circular:{In:function(a){return 1-Math.sqrt(1-a*a)},Out:function(a){return Math.sqrt(1- --a*a)},InOut:function(a){return(a*=2)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)}},Elastic:{In:function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),-(c*Math.pow(2,10*(a-=1))*Math.sin(2*(a-b)*Math.PI/d)))},Out:function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),c*Math.pow(2,-10*a)*Math.sin(2*(a-b)*Math.PI/d)+1)},InOut:function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),(a*=2)<1?-.5*c*Math.pow(2,10*(a-=1))*Math.sin(2*(a-b)*Math.PI/d):c*Math.pow(2,-10*(a-=1))*Math.sin(2*(a-b)*Math.PI/d)*.5+1)}},Back:{In:function(a){var b=1.70158;return a*a*((b+1)*a-b)},Out:function(a){var b=1.70158;return--a*a*((b+1)*a+b)+1},InOut:function(a){var b=2.5949095;return(a*=2)<1?.5*a*a*((b+1)*a-b):.5*((a-=2)*a*((b+1)*a+b)+2)}},Bounce:{In:function(a){return 1-TWEEN.Easing.Bounce.Out(1-a)},Out:function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},InOut:function(a){return.5>a?.5*TWEEN.Easing.Bounce.In(2*a):.5*TWEEN.Easing.Bounce.Out(2*a-1)+.5}}},TWEEN.Interpolation={Linear:function(a,b){var c=a.length-1,d=c*b,e=Math.floor(d),f=TWEEN.Interpolation.Utils.Linear;return 0>b?f(a[0],a[1],d):b>1?f(a[c],a[c-1],c-d):f(a[e],a[e+1>c?c:e+1],d-e)},Bezier:function(a,b){var c,d=0,e=a.length-1,f=Math.pow,g=TWEEN.Interpolation.Utils.Bernstein;for(c=0;e>=c;c++)d+=f(1-b,e-c)*f(b,c)*a[c]*g(e,c);return d},CatmullRom:function(a,b){var c=a.length-1,d=c*b,e=Math.floor(d),f=TWEEN.Interpolation.Utils.CatmullRom;return a[0]===a[c]?(0>b&&(e=Math.floor(d=c*(1+b))),f(a[(e-1+c)%c],a[e],a[(e+1)%c],a[(e+2)%c],d-e)):0>b?a[0]-(f(a[0],a[0],a[1],a[1],-d)-a[0]):b>1?a[c]-(f(a[c],a[c],a[c-1],a[c-1],d-c)-a[c]):f(a[e?e-1:0],a[e],a[e+1>c?c:e+1],a[e+2>c?c:e+2],d-e)},Utils:{Linear:function(a,b,c){return(b-a)*c+a},Bernstein:function(a,b){var c=TWEEN.Interpolation.Utils.Factorial;return c(a)/c(b)/c(a-b)},Factorial:function(){var a=[1];return function(b){var c,d=1;if(a[b])return a[b];for(c=b;c>1;c--)d*=c;return a[b]=d}}(),CatmullRom:function(a,b,c,d,e){var f=.5*(c-a),g=.5*(d-b),h=e*e,i=e*h;return(2*b-2*c+f+g)*i+(-3*b+3*c-2*f-g)*h+f*e+b}}},function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.push,h=d.slice,i=d.concat,j=e.toString,k=e.hasOwnProperty,l=d.forEach,m=d.map,n=d.reduce,o=d.reduceRight,p=d.filter,q=d.every,r=d.some,s=d.indexOf,t=d.lastIndexOf,u=Array.isArray,v=Object.keys,w=f.bind,x=function(a){return a instanceof x?a:this instanceof x?void(this._wrapped=a):new x(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):a._=x,x.VERSION="1.5.1";var y=x.each=x.forEach=function(a,b,d){if(null!=a)if(l&&a.forEach===l)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;f>e;e++)if(b.call(d,a[e],e,a)===c)return}else for(var g in a)if(x.has(a,g)&&b.call(d,a[g],g,a)===c)return};x.map=x.collect=function(a,b,c){var d=[];return null==a?d:m&&a.map===m?a.map(b,c):(y(a,function(a,e,f){d.push(b.call(c,a,e,f))}),d)};var z="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),n&&a.reduce===n)return d&&(b=x.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(y(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(z);return c},x.reduceRight=x.foldr=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),o&&a.reduceRight===o)return d&&(b=x.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=x.keys(a);f=g.length}if(y(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)}),!e)throw new TypeError(z);return c},x.find=x.detect=function(a,b,c){var d;return A(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},x.filter=x.select=function(a,b,c){var d=[];return null==a?d:p&&a.filter===p?a.filter(b,c):(y(a,function(a,e,f){b.call(c,a,e,f)&&d.push(a)}),d)},x.reject=function(a,b,c){return x.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},x.every=x.all=function(a,b,d){b||(b=x.identity);var e=!0;return null==a?e:q&&a.every===q?a.every(b,d):(y(a,function(a,f,g){return(e=e&&b.call(d,a,f,g))?void 0:c}),!!e)};var A=x.some=x.any=function(a,b,d){b||(b=x.identity);var e=!1;return null==a?e:r&&a.some===r?a.some(b,d):(y(a,function(a,f,g){return e||(e=b.call(d,a,f,g))?c:void 0}),!!e)};x.contains=x.include=function(a,b){return null==a?!1:s&&a.indexOf===s?-1!=a.indexOf(b):A(a,function(a){return a===b})},x.invoke=function(a,b){var c=h.call(arguments,2),d=x.isFunction(b);return x.map(a,function(a){return(d?b:a[b]).apply(a,c)})},x.pluck=function(a,b){return x.map(a,function(a){return a[b]})},x.where=function(a,b,c){return x.isEmpty(b)?c?void 0:[]:x[c?"find":"filter"](a,function(a){for(var c in b)if(b[c]!==a[c])return!1;return!0})},x.findWhere=function(a,b){return x.where(a,b,!0)},x.max=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);if(!b&&x.isEmpty(a))return-1/0;var d={computed:-1/0,value:-1/0};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>d.computed&&(d={value:a,computed:g})}),d.value},x.min=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);if(!b&&x.isEmpty(a))return 1/0;var d={computed:1/0,value:1/0};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})}),d.value},x.shuffle=function(a){var b,c=0,d=[];return y(a,function(a){b=x.random(c++),d[c-1]=d[b],d[b]=a}),d};var B=function(a){return x.isFunction(a)?a:function(b){return b[a]}};x.sortBy=function(a,b,c){var d=B(b);return x.pluck(x.map(a,function(a,b,e){return{value:a,index:b,criteria:d.call(c,a,b,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index<b.index?-1:1}),"value")};var C=function(a,b,c,d){var e={},f=B(null==b?x.identity:b);return y(a,function(b,g){var h=f.call(c,b,g,a);d(e,h,b)}),e};x.groupBy=function(a,b,c){return C(a,b,c,function(a,b,c){(x.has(a,b)?a[b]:a[b]=[]).push(c)})},x.countBy=function(a,b,c){return C(a,b,c,function(a,b){x.has(a,b)||(a[b]=0),a[b]++})},x.sortedIndex=function(a,b,c,d){c=null==c?x.identity:B(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},x.toArray=function(a){return a?x.isArray(a)?h.call(a):a.length===+a.length?x.map(a,x.identity):x.values(a):[]},x.size=function(a){return null==a?0:a.length===+a.length?a.length:x.keys(a).length},x.first=x.head=x.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:h.call(a,0,b)},x.initial=function(a,b,c){return h.call(a,0,a.length-(null==b||c?1:b))},x.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:h.call(a,Math.max(a.length-b,0))},x.rest=x.tail=x.drop=function(a,b,c){return h.call(a,null==b||c?1:b)},x.compact=function(a){return x.filter(a,x.identity)};var D=function(a,b,c){return b&&x.every(a,x.isArray)?i.apply(c,a):(y(a,function(a){x.isArray(a)||x.isArguments(a)?b?g.apply(c,a):D(a,b,c):c.push(a)}),c)};x.flatten=function(a,b){return D(a,b,[])},x.without=function(a){return x.difference(a,h.call(arguments,1))},x.uniq=x.unique=function(a,b,c,d){x.isFunction(b)&&(d=c,c=b,b=!1);var e=c?x.map(a,c,d):a,f=[],g=[];return y(e,function(c,d){(b?d&&g[g.length-1]===c:x.contains(g,c))||(g.push(c),f.push(a[d]))}),f},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(a){var b=h.call(arguments,1);return x.filter(x.uniq(a),function(a){return x.every(b,function(b){return x.indexOf(b,a)>=0})})},x.difference=function(a){var b=i.apply(d,h.call(arguments,1));return x.filter(a,function(a){return!x.contains(b,a)})},x.zip=function(){for(var a=x.max(x.pluck(arguments,"length").concat(0)),b=new Array(a),c=0;a>c;c++)b[c]=x.pluck(arguments,""+c);return b},x.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},x.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=x.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(s&&a.indexOf===s)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},x.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(t&&a.lastIndexOf===t)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1},x.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);d>e;)f[e++]=a,a+=c;return f};var E=function(){};x.bind=function(a,b){var c,d;if(w&&a.bind===w)return w.apply(a,h.call(arguments,1));if(!x.isFunction(a))throw new TypeError;return c=h.call(arguments,2),d=function(){if(!(this instanceof d))return a.apply(b,c.concat(h.call(arguments)));E.prototype=a.prototype;var e=new E;E.prototype=null;var f=a.apply(e,c.concat(h.call(arguments)));return Object(f)===f?f:e}},x.partial=function(a){var b=h.call(arguments,1);return function(){return a.apply(this,b.concat(h.call(arguments)))}},x.bindAll=function(a){var b=h.call(arguments,1);if(0===b.length)throw new Error("bindAll must be passed function names");return y(b,function(b){a[b]=x.bind(a[b],a)}),a},x.memoize=function(a,b){var c={};return b||(b=x.identity),function(){var d=b.apply(this,arguments);return x.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},x.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},x.defer=function(a){return x.delay.apply(x,[a,1].concat(h.call(arguments,1)))},x.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:new Date,g=null,f=a.apply(d,e)};return function(){var j=new Date;h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k?(clearTimeout(g),g=null,h=j,f=a.apply(d,e)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},x.debounce=function(a,b,c){var d,e=null;return function(){var f=this,g=arguments,h=function(){e=null,c||(d=a.apply(f,g))},i=c&&!e;return clearTimeout(e),e=setTimeout(h,b),i&&(d=a.apply(f,g)),d}},x.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},x.wrap=function(a,b){return function(){var c=[a];return g.apply(c,arguments),b.apply(this,c)}},x.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},x.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},x.keys=v||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)x.has(a,c)&&b.push(c);return b},x.values=function(a){var b=[];for(var c in a)x.has(a,c)&&b.push(a[c]);return b},x.pairs=function(a){var b=[];for(var c in a)x.has(a,c)&&b.push([c,a[c]]);return b},x.invert=function(a){var b={};for(var c in a)x.has(a,c)&&(b[a[c]]=c);return b},x.functions=x.methods=function(a){var b=[];for(var c in a)x.isFunction(a[c])&&b.push(c);return b.sort()},x.extend=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},x.pick=function(a){var b={},c=i.apply(d,h.call(arguments,1));return y(c,function(c){c in a&&(b[c]=a[c])}),b},x.omit=function(a){var b={},c=i.apply(d,h.call(arguments,1));for(var e in a)x.contains(c,e)||(b[e]=a[e]);return b},x.defaults=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)void 0===a[c]&&(a[c]=b[c])}),a},x.clone=function(a){return x.isObject(a)?x.isArray(a)?a.slice():x.extend({},a):a},x.tap=function(a,b){return b(a),a};var F=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof x&&(a=a._wrapped),b instanceof x&&(b=b._wrapped);var e=j.call(a);if(e!=j.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;var g=a.constructor,h=b.constructor;if(g!==h&&!(x.isFunction(g)&&g instanceof g&&x.isFunction(h)&&h instanceof h))return!1;c.push(a),d.push(b);var i=0,k=!0;if("[object Array]"==e){if(i=a.length,k=i==b.length)for(;i--&&(k=F(a[i],b[i],c,d)););}else{for(var l in a)if(x.has(a,l)&&(i++,!(k=x.has(b,l)&&F(a[l],b[l],c,d))))break;if(k){for(l in b)if(x.has(b,l)&&!i--)break;k=!i}}return c.pop(),d.pop(),k};x.isEqual=function(a,b){return F(a,b,[],[])},x.isEmpty=function(a){if(null==a)return!0;if(x.isArray(a)||x.isString(a))return 0===a.length;for(var b in a)if(x.has(a,b))return!1;return!0},x.isElement=function(a){return!(!a||1!==a.nodeType)},x.isArray=u||function(a){return"[object Array]"==j.call(a)},x.isObject=function(a){return a===Object(a)},y(["Arguments","Function","String","Number","Date","RegExp"],function(a){x["is"+a]=function(b){return j.call(b)=="[object "+a+"]"}}),x.isArguments(arguments)||(x.isArguments=function(a){return!(!a||!x.has(a,"callee"))}),"function"!=typeof/./&&(x.isFunction=function(a){return"function"==typeof a}),x.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},x.isNaN=function(a){return x.isNumber(a)&&a!=+a},x.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==j.call(a)},x.isNull=function(a){return null===a},x.isUndefined=function(a){return void 0===a},x.has=function(a,b){return k.call(a,b)},x.noConflict=function(){return a._=b,this},x.identity=function(a){return a},x.times=function(a,b,c){for(var d=Array(Math.max(0,a)),e=0;a>e;e++)d[e]=b.call(c,e);return d},x.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))};var G={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};G.unescape=x.invert(G.escape);var H={escape:new RegExp("["+x.keys(G.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(G.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(a){x[a]=function(b){return null==b?"":(""+b).replace(H[a],function(b){return G[a][b]})}}),x.result=function(a,b){if(null==a)return void 0;var c=a[b];return x.isFunction(c)?c.call(a):c},x.mixin=function(a){y(x.functions(a),function(b){var c=x[b]=a[b];x.prototype[b]=function(){var a=[this._wrapped];return g.apply(a,arguments),M.call(this,c.apply(x,a))}})};var I=0;x.uniqueId=function(a){var b=++I+"";return a?a+b:b},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var J=/(.)^/,K={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(a,b,c){var d;c=x.defaults({},c,x.templateSettings);var e=new RegExp([(c.escape||J).source,(c.interpolate||J).source,(c.evaluate||J).source].join("|")+"|$","g"),f=0,g="__p+='";a.replace(e,function(b,c,d,e,h){return g+=a.slice(f,h).replace(L,function(a){return"\\"+K[a]}),c&&(g+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(g+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),e&&(g+="';\n"+e+"\n__p+='"),f=h+b.length,b}),g+="';\n",c.variable||(g="with(obj||{}){\n"+g+"}\n"),g="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";try{d=new Function(c.variable||"obj","_",g)}catch(h){throw h.source=g,h}if(b)return d(b,x);var i=function(a){return d.call(this,a,x)};return i.source="function("+(c.variable||"obj")+"){\n"+g+"}",i},x.chain=function(a){return x(a).chain()};var M=function(a){return this._chain?x(a).chain():a};x.mixin(x),y(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];x.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],M.call(this,c)}}),y(["concat","join","slice"],function(a){var b=d[a];x.prototype[a]=function(){return M.call(this,b.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this);var Backbone=Backbone||{};!function(){var a=[],b=a.slice,c=function(a,b,c){var d,e=-1,f=b.length;switch(c.length){case 0:for(;++e<f;)(d=b[e]).callback.call(d.ctx);return;case 1:for(;++e<f;)(d=b[e]).callback.call(d.ctx,c[0]);return;case 2:for(;++e<f;)(d=b[e]).callback.call(d.ctx,c[0],c[1]);return;case 3:for(;++e<f;)(d=b[e]).callback.call(d.ctx,c[0],c[1],c[2]);return;default:for(;++e<f;)(d=b[e]).callback.apply(d.ctx,c)}},d=Backbone.Events={on:function(a,b,c){this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,c){var d=this,e=_.once(function(){d.off(a,e),b.apply(this,arguments)});return e._callback=b,this.on(a,e,c),this},off:function(a,b,c){var d,e,f,g,h,i,j,k;if(!this._events)return this;if(!a&&!b&&!c)return this._events={},this;for(g=a?[a]:_.keys(this._events),h=0,i=g.length;i>h;h++)if(a=g[h],d=this._events[a]){if(f=[],b||c)for(j=0,k=d.length;k>j;j++)e=d[j],(b&&b!==(e.callback._callback||e.callback)||c&&c!==e.context)&&f.push(e);this._events[a]=f}return this},trigger:function(a){if(!this._events)return this;var d=b.call(arguments,1),e=this._events[a],f=this._events.all;return e&&c(this,e,d),f&&c(this,f,arguments),this},listenTo:function(a,b,c){var d=this._listeners||(this._listeners={}),e=a._listenerId||(a._listenerId=_.uniqueId("l"));return d[e]=a,a.on(b,c||this,this),this},stopListening:function(a,b,c){var d=this._listeners;if(d){if(a)a.off(b,c,this),b||c||delete d[a._listenerId];else{for(var e in d)d[e].off(null,null,this);this._listeners={}}return this}}};d.bind=d.on,d.unbind=d.off,"undefined"!=typeof exports&&("undefined"!=typeof module&&module.exports&&(exports=module.exports=d),exports.Backbone=exports.Backbone||Backbone)}(),function(){function a(a){var d=(new Date).getTime(),e=Math.max(0,16-(d-c)),f=b.setTimeout(function(){a(d+e)},e);return c=d+e,f}var b=this,c=0,d=["ms","moz","webkit","o"];if("undefined"!=typeof exports)return"undefined"!=typeof module&&module.exports&&(exports=module.exports=a),void(exports.requestAnimationFrame=a);for(var e=0;e<d.length&&!b.requestAnimationFrame;++e)b.requestAnimationFrame=b[d[e]+"RequestAnimationFrame"],b.cancelAnimationFrame=b[d[e]+"CancelAnimationFrame"]||b[d[e]+"CancelRequestAnimationFrame"];b.requestAnimationFrame||(b.requestAnimationFrame=a),b.cancelAnimationFrame||(b.cancelAnimationFrame=function(a){clearTimeout(a)})}(),function(){function a(){var a=document.body.getBoundingClientRect(),b=this.width=a.width,c=this.height=a.height;this.renderer.setSize(b,c,this.ratio),this.trigger(o.Events.resize,b,c)}function b(){return(c.performance&&c.performance.now?c.performance:Date).now()}var c=this,d=c.Two||{},e=Math.sin,f=Math.cos,g=Math.atan2,h=Math.sqrt,i=(Math.round,Math.abs,Math.PI),j=2*i,k=i/2,l=Math.pow,m=(Math.min,Math.max,0),n={hasEventListeners:_.isFunction(c.addEventListener),bind:function(a,b,c,d){return this.hasEventListeners?a.addEventListener(b,c,!!d):a.attachEvent("on"+b,c),this},unbind:function(a,b,c,d){return this.hasEventListeners?a.removeEventListeners(b,c,!!d):a.detachEvent("on"+b,c),this}},o=c.Two=function(b){var d=_.defaults(b||{},{fullscreen:!1,width:640,height:480,type:o.Types.svg,autostart:!1});if(_.each(d,function(a,b){"fullscreen"!==b&&"width"!==b&&"height"!==b&&"autostart"!==b&&(this[b]=a)},this),_.isElement(d.domElement)&&(this.type=o.Types[d.domElement.tagName.toLowerCase()]),this.renderer=new o[this.type](this),o.Utils.setPlaying.call(this,d.autostart),this.frameCount=0,d.fullscreen){var e=_.bind(a,this);_.extend(document.body.style,{overflow:"hidden",margin:0,padding:0,top:0,left:0,right:0,bottom:0,position:"fixed"}),_.extend(this.renderer.domElement.style,{display:"block",top:0,left:0,right:0,bottom:0,position:"fixed"}),n.bind(c,"resize",e),e()}else _.isElement(d.domElement)||(this.renderer.setSize(d.width,d.height,this.ratio),this.width=d.width,this.height=d.height);this.scene=this.renderer.scene,o.Instances.push(this)};_.extend(o,{Array:c.Float32Array||Array,Types:{webgl:"WebGLRenderer",svg:"SVGRenderer",canvas:"CanvasRenderer"},Version:"v0.4.0",Identifier:"two-",Properties:{hierarchy:"hierarchy",demotion:"demotion"},Events:{play:"play",pause:"pause",update:"update",render:"render",resize:"resize",change:"change",remove:"remove",insert:"insert"},Commands:{move:"M",line:"L",curve:"C",close:"Z"},Resolution:8,Instances:[],noConflict:function(){return c.Two=d,this},uniqueId:function(){var a=m;return m++,a},Utils:{release:function(a){_.isObject(a)&&(_.isFunction(a.unbind)&&a.unbind(),a.vertices&&(_.isFunction(a.vertices.unbind)&&a.vertices.unbind(),_.each(a.vertices,function(a){_.isFunction(a.unbind)&&a.unbind()})),a.children&&_.each(a.children,function(a){o.Utils.release(a)}))},Curve:{CollinearityEpsilon:l(10,-30),RecursionLimit:16,CuspLimit:0,Tolerance:{distance:.25,angle:0,epsilon:.01}},devicePixelRatio:c.devicePixelRatio||1,getBackingStoreRatio:function(a){return a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1},getRatio:function(a){return o.Utils.devicePixelRatio/u(a)},setPlaying:function(a){return this.playing=!!a,this},getComputedMatrix:function(a,b){for(var b=b&&b.identity()||new o.Matrix,c=a;c&&c._matrix;){var d=c._matrix.elements;b.multiply(d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8],d[9]),c=c.parent}return b},applySvgAttributes:function(a,b){return _.each(a.attributes,function(a){var c=a.nodeName;switch(c){case"transform":break;case"visibility":b.visible=!!a.nodeValue;break;case"stroke-linecap":b.cap=a.nodeValue;break;case"stroke-linejoin":b.join=a.nodeValue;break;case"stroke-miterlimit":b.miter=a.nodeValue;break;case"stroke-width":b.linewidth=parseFloat(a.nodeValue);break;case"stroke-opacity":case"fill-opacity":case"opacity":b.opacity=a.nodeValue;break;case"fill":b.fill=a.nodeValue;break;case"stroke":b.stroke=a.nodeValue}}),b},read:{svg:function(){return o.Utils.read.g.apply(this,arguments)},g:function(a){var b=new o.Group;return this.add(b),_.each(a.childNodes,function(a){var c=a.nodeName;if(c){var d=c.replace(/svg\:/gi,"").toLowerCase();if(d in o.Utils.read){var e=o.Utils.read[d].call(this,a);b.add(e)}}},this),o.Utils.applySvgAttributes(a,b)},polygon:function(a,b){var c=a.getAttribute("points"),d=[];c.replace(/([\d\.?]+),([\d\.?]+)/g,function(a,b,c){d.push(new o.Anchor(parseFloat(b),parseFloat(c)))});var e=new o.Polygon(d,!b).noStroke();return o.Utils.applySvgAttributes(a,e)},polyline:function(a){return o.Utils.read.polygon(a,!0)},path:function(a){var b,c,d,e=a.getAttribute("d"),f=!1,g=!1,h=e.match(/[a-df-z][^a-df-z]*/gi),i=h.length-1,j=_.flatten(_.map(h,function(a,e){var h,j,k,l=a[0],m=l.toLowerCase();d=a.slice(1).trim(),d=d.replace(/(-?\d+(?:\.\d*)?)[eE]([+\-]?\d+)/g,function(a,b,c){return parseFloat(b)*Math.pow(10,c)}),d=d.split(/[\s,]+|(?=\s?[+\-])/),f=l===m;var n,p,q,r,s,t,u,v,w;switch(m){case"z":e>=i?g=!0:(j=b.x,k=b.y,h=new o.Anchor(j,k,void 0,void 0,void 0,void 0,o.Commands.close));break;case"m":case"l":j=parseFloat(d[0]),k=parseFloat(d[1]),h=new o.Anchor(j,k,void 0,void 0,void 0,void 0,"m"===m?o.Commands.move:o.Commands.line),f&&h.addSelf(b),h.controls.left.copy(h),h.controls.right.copy(h),b=h;break;case"h":case"v":var x="h"===m?"x":"y",y="x"===x?"y":"x";h=new o.Anchor(void 0,void 0,void 0,void 0,void 0,void 0,o.Commands.line),h[x]=parseFloat(d[0]),h[y]=b[y],f&&(h[x]+=b[x]),h.controls.left.copy(h),h.controls.right.copy(h),b=h;break;case"s":case"c":n=b.x,p=b.y,c||(c=(new o.Vector).copy(b)),"c"===m?(q=parseFloat(d[0]),r=parseFloat(d[1]),s=parseFloat(d[2]),t=parseFloat(d[3]),u=parseFloat(d[4]),v=parseFloat(d[5])):(w=o.Utils.getReflection(b,c,f),q=w.x,r=w.y,s=parseFloat(d[0]),t=parseFloat(d[1]),u=parseFloat(d[2]),v=parseFloat(d[3])),f&&(q+=n,r+=p,s+=n,t+=p,u+=n,v+=p),_.isObject(b.controls)||o.Anchor.AppendCurveProperties(b),b.controls.right.set(q,r),h=new o.Anchor(u,v,s,t,void 0,void 0,o.Commands.curve),b=h,c=h.controls.left;break;case"t":case"q":n=b.x,p=b.y,c||(c=(new o.Vector).copy(b)),c.isZero()?(q=n,r=p):(q=c.x,p=c.y),"q"===m?(s=parseFloat(d[0]),t=parseFloat(d[1]),u=parseFloat(d[1]),v=parseFloat(d[2])):(w=o.Utils.getReflection(b,c,f),s=w.x,t=w.y,u=parseFloat(d[0]),v=parseFloat(d[1])),f&&(q+=n,r+=p,s+=n,t+=p,u+=n,v+=p),_.isObject(b.controls)||o.Anchor.AppendCurveProperties(b),b.controls.right.set(q,r),h=new o.Anchor(u,v,s,t,void 0,void 0,o.Commands.curve),b=h,c=h.controls.left;break;case"a":throw new o.Utils.Error("not yet able to interpret Elliptical Arcs.")}return h}));if(!(j.length<=1)){j=_.compact(j);var k=new o.Polygon(j,g,void 0,!0).noStroke();return o.Utils.applySvgAttributes(a,k)}},circle:function(a){var b=parseFloat(a.getAttribute("cx")),c=parseFloat(a.getAttribute("cy")),d=parseFloat(a.getAttribute("r")),g=o.Resolution,h=_.map(_.range(g),function(a){var b=a/g,c=b*j,h=d*f(c),i=d*e(c);return new o.Anchor(h,i)},this),i=new o.Polygon(h,!0,!0).noStroke();return i.translation.set(b,c),o.Utils.applySvgAttributes(a,i)},ellipse:function(a){var b=parseFloat(a.getAttribute("cx")),c=parseFloat(a.getAttribute("cy")),d=parseFloat(a.getAttribute("rx")),g=parseFloat(a.getAttribute("ry")),h=o.Resolution,i=_.map(_.range(h),function(a){var b=a/h,c=b*j,i=d*f(c),k=g*e(c);return new o.Anchor(i,k)},this),k=new o.Polygon(i,!0,!0).noStroke();return k.translation.set(b,c),o.Utils.applySvgAttributes(a,k)},rect:function(a){var b=parseFloat(a.getAttribute("x")),c=parseFloat(a.getAttribute("y")),d=parseFloat(a.getAttribute("width")),e=parseFloat(a.getAttribute("height")),f=d/2,g=e/2,h=[new o.Anchor(f,g),new o.Anchor(-f,g),new o.Anchor(-f,-g),new o.Anchor(f,-g)],i=new o.Polygon(h,!0).noStroke();return i.translation.set(b+f,c+g),o.Utils.applySvgAttributes(a,i)},line:function(a){var b=parseFloat(a.getAttribute("x1")),c=parseFloat(a.getAttribute("y1")),d=parseFloat(a.getAttribute("x2")),e=parseFloat(a.getAttribute("y2")),f=d-b,g=e-c,h=f/2,i=g/2,j=[new o.Anchor(-h,-i),new o.Anchor(h,i)],k=new o.Polygon(j).noFill();return k.translation.set(b+h,c+i),o.Utils.applySvgAttributes(a,k)}},subdivide:function(a,b,c,d,e,f,g,h,i){var i=i||o.Utils.Curve.RecursionLimit,j=i+1;return _.map(_.range(0,j),function(i){var k=i/j,l=v(k,a,c,e,g),m=v(k,b,d,f,h);return new o.Anchor(l,m)})},getPointOnCubicBezier:function(a,b,c,d,e){var f=1-a;return f*f*f*b+3*f*f*a*c+3*f*a*a*d+a*a*a*e
},getCurveFromPoints:function(a,b){for(var c=a.length,d=c-1,e=0;c>e;e++){var f=a[e];_.isObject(f.controls)||o.Anchor.AppendCurveProperties(f);var g=b?t(e-1,c):Math.max(e-1,0),h=b?t(e+1,c):Math.min(e+1,d),i=a[g],j=f,k=a[h];s(i,j,k),j._command=0===e?o.Commands.move:o.Commands.curve,j.controls.left.x=_.isNumber(j.controls.left.x)?j.controls.left.x:j.x,j.controls.left.y=_.isNumber(j.controls.left.y)?j.controls.left.y:j.y,j.controls.right.x=_.isNumber(j.controls.right.x)?j.controls.right.x:j.x,j.controls.right.y=_.isNumber(j.controls.right.y)?j.controls.right.y:j.y}},getControlPoints:function(a,b,c){var d=r(a,b),g=r(c,b),h=p(a,b),j=p(c,b),l=(d+g)/2;return b.u=_.isObject(b.controls.left)?b.controls.left:new o.Vector(b.x,b.y),b.v=_.isObject(b.controls.right)?b.controls.right:new o.Vector(b.x,b.y),1e-4>h||1e-4>j?(b.controls.left.copy(b),b.controls.right.copy(b),b):(h*=.33,j*=.33,d>g?l+=k:l-=k,b.controls.left.x=b.x+f(l)*h,b.controls.left.y=b.y+e(l)*h,l-=i,b.controls.right.x=b.x+f(l)*j,b.controls.right.y=b.y+e(l)*j,b)},getReflection:function(a,b,c){var d=a.distanceTo(b);if(1e-4>=d)return c?new o.Vector:a.clone();var e=r(a,b);return new o.Vector(d*Math.cos(e)+(c?0:a.x),d*Math.sin(e)+(c?0:a.y))},angleBetween:function(a,b){var c,d;return arguments.length>=4?(c=arguments[0]-arguments[2],d=arguments[1]-arguments[3],g(d,c)):(c=a.x-b.x,d=a.y-b.y,g(d,c))},distanceBetweenSquared:function(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d},distanceBetween:function(a,b){return h(q(a,b))},mod:function(a,b){for(;0>a;)a+=b;return a%b},Collection:function(){Array.call(this),arguments.length>1?Array.prototype.push.apply(this,arguments):arguments[0]&&Array.isArray(arguments[0])&&Array.prototype.push.apply(this,arguments[0])},Error:function(a){this.name="two.js",this.message=a}}}),o.Utils.Error.prototype=new Error,o.Utils.Error.prototype.constructor=o.Utils.Error,o.Utils.Collection.prototype=new Array,o.Utils.Collection.constructor=o.Utils.Collection,_.extend(o.Utils.Collection.prototype,Backbone.Events,{pop:function(){var a=Array.prototype.pop.apply(this,arguments);return this.trigger(o.Events.remove,[a]),a},shift:function(){var a=Array.prototype.shift.apply(this,arguments);return this.trigger(o.Events.remove,[a]),a},push:function(){var a=Array.prototype.push.apply(this,arguments);return this.trigger(o.Events.insert,arguments),a},unshift:function(){var a=Array.prototype.unshift.apply(this,arguments);return this.trigger(o.Events.insert,arguments),a},splice:function(){var a,b=Array.prototype.splice.apply(this,arguments);return this.trigger(o.Events.remove,b),arguments.length>2&&(a=this.slice(arguments[0],arguments.length-2),this.trigger(o.Events.insert,a)),b}});var p=o.Utils.distanceBetween,q=o.Utils.distanceBetweenSquared,r=o.Utils.angleBetween,s=o.Utils.getControlPoints,t=(o.Utils.getCurveFromPoints,o.Utils.solveSegmentIntersection,o.Utils.decoupleShapes,o.Utils.mod),u=o.Utils.getBackingStoreRatio,v=o.Utils.getPointOnCubicBezier;_.extend(o.prototype,Backbone.Events,{appendTo:function(a){return a.appendChild(this.renderer.domElement),this},play:function(){return o.Utils.setPlaying.call(this,!0),this.trigger(o.Events.play)},pause:function(){return this.playing=!1,this.trigger(o.Events.pause)},update:function(){var a=!!this._lastFrame,c=b();this.frameCount++,a&&(this.timeDelta=parseFloat((c-this._lastFrame).toFixed(3))),this._lastFrame=c;var d=this.width,e=this.height,f=this.renderer;return(d!==f.width||e!==f.height)&&f.setSize(d,e,this.ratio),this.trigger(o.Events.update,this.frameCount,this.timeDelta),this.render()},render:function(){return this.renderer.render(),this.trigger(o.Events.render,this.frameCount)},add:function(a){var b=a;return _.isArray(a)||(b=_.toArray(arguments)),this.scene.add(b),this},remove:function(a){var b=a;return _.isArray(a)||(b=_.toArray(arguments)),this.scene.remove(b),this},clear:function(){return this.scene.remove(_.toArray(this.scene.children)),this},makeLine:function(a,b,c,d){var e=c-a,f=d-b,g=e/2,h=f/2,i=[new o.Anchor(-g,-h),new o.Anchor(g,h)],j=new o.Polygon(i).noFill();return j.translation.set(a+g,b+h),this.scene.add(j),j},makeRectangle:function(a,b,c,d){var e=c/2,f=d/2,g=[new o.Anchor(e,f),new o.Anchor(-e,f),new o.Anchor(-e,-f),new o.Anchor(e,-f)],h=new o.Polygon(g,!0);return h.translation.set(a,b),this.scene.add(h),h},makeCircle:function(a,b,c){return this.makeEllipse(a,b,c,c)},makeEllipse:function(a,b,c,d){var g=o.Resolution,h=_.map(_.range(g),function(a){var b=a/g,h=b*j,i=c*f(h),k=d*e(h);return new o.Anchor(i,k)},this),i=new o.Polygon(h,!0,!0);return i.translation.set(a,b),this.scene.add(i),i},makeCurve:function(a){var b=arguments.length,c=a;if(!_.isArray(a)){c=[];for(var d=0;b>d;d+=2){var e=arguments[d];if(!_.isNumber(e))break;var f=arguments[d+1];c.push(new o.Anchor(e,f))}}var g=arguments[b-1],h=new o.Polygon(c,!(_.isBoolean(g)?g:void 0),!0),i=h.getBoundingClientRect(),j=i.left+i.width/2,k=i.top+i.height/2;return _.each(h.vertices,function(a){a.x-=j,a.y-=k}),h.translation.set(j,k),this.scene.add(h),h},makePolygon:function(a){var b=arguments.length,c=a;if(!_.isArray(a)){c=[];for(var d=0;b>d;d+=2){var e=arguments[d];if(!_.isNumber(e))break;var f=arguments[d+1];c.push(new o.Anchor(e,f))}}var g=arguments[b-1],h=new o.Polygon(c,!(_.isBoolean(g)?g:void 0)),i=h.getBoundingClientRect();return h.center().translation.set(i.left+i.width/2,i.top+i.height/2),this.scene.add(h),h},makeGroup:function(a){var b=a;_.isArray(a)||(b=_.toArray(arguments));var c=new o.Group;return this.scene.add(c),c.add(b),c},interpret:function(a){var b=a.tagName.toLowerCase();if(!(b in o.Utils.read))return null;var c=o.Utils.read[b].call(this,a);return this.add(c),c}}),function(){requestAnimationFrame(arguments.callee),_.each(o.Instances,function(a){a.playing&&a.update()})}(),"function"==typeof define&&define.amd?define(function(){return o}):"undefined"!=typeof module&&module.exports&&(module.exports=o)}(),function(){var a,b,c,d,e=Two.Vector=function(a,b){this.x=a||0,this.y=b||0};_.extend(e.prototype,Backbone.Events,{set:function(a,b){return this.x=a,this.y=b,this},copy:function(a){return this.x=a.x,this.y=a.y,this},clear:function(){return this.x=0,this.y=0,this},clone:function(){return new e(this.x,this.y)},add:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this},addSelf:function(a){return this.x+=a.x,this.y+=a.y,this},sub:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this},subSelf:function(a){return this.x-=a.x,this.y-=a.y,this},multiplySelf:function(a){return this.x*=a.x,this.y*=a.y,this},multiplyScalar:function(a){return this.x*=a,this.y*=a,this},divideScalar:function(a){return a?(this.x/=a,this.y/=a):this.set(0,0),this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y},lengthSquared:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSquared())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){return c=this.x-a.x,d=this.y-a.y,c*c+d*d},setLength:function(a){return this.normalize().multiplyScalar(a)},equals:function(a){return this.distanceTo(a)<1e-4},lerp:function(c,d){return a=(c.x-this.x)*d+this.x,b=(c.y-this.y)*d+this.y,this.set(a,b)},isZero:function(){return this.length()<1e-4},toString:function(){return this.x+","+this.y},toObject:function(){return{x:this.x,y:this.y}}});var f={set:function(a,b){return this._x=a,this._y=b,this.trigger(Two.Events.change)},copy:function(a){return this._x=a.x,this._y=a.y,this.trigger(Two.Events.change)},clear:function(){return this._x=0,this._y=0,this.trigger(Two.Events.change)},clone:function(){return new e(this._x,this._y)},add:function(a,b){return this._x=a.x+b.x,this._y=a.y+b.y,this.trigger(Two.Events.change)},addSelf:function(a){return this._x+=a.x,this._y+=a.y,this.trigger(Two.Events.change)},sub:function(a,b){return this._x=a.x-b.x,this._y=a.y-b.y,this.trigger(Two.Events.change)},subSelf:function(a){return this._x-=a.x,this._y-=a.y,this.trigger(Two.Events.change)},multiplySelf:function(a){return this._x*=a.x,this._y*=a.y,this.trigger(Two.Events.change)},multiplyScalar:function(a){return this._x*=a,this._y*=a,this.trigger(Two.Events.change)},divideScalar:function(a){return a?(this._x/=a,this._y/=a,this.trigger(Two.Events.change)):this.clear()},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this._x*a.x+this._y*a.y},lengthSquared:function(){return this._x*this._x+this._y*this._y},length:function(){return Math.sqrt(this.lengthSquared())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){return c=this._x-a.x,d=this._y-a.y,c*c+d*d},setLength:function(a){return this.normalize().multiplyScalar(a)},equals:function(a){return this.distanceTo(a)<1e-4},lerp:function(c,d){return a=(c.x-this._x)*d+this._x,b=(c.y-this._y)*d+this._y,this.set(a,b)},isZero:function(){return this.length()<1e-4},toString:function(){return this._x+","+this._y},toObject:function(){return{x:this._x,y:this._y}}},g={get:function(){return this._x},set:function(a){this._x=a,this.trigger(Two.Events.change,"x")}},h={get:function(){return this._y},set:function(a){this._y=a,this.trigger(Two.Events.change,"y")}};Two.Vector.prototype.bind=Two.Vector.prototype.on=function(){return this._bound||(this._x=this.x,this._y=this.y,Object.defineProperty(this,"x",g),Object.defineProperty(this,"y",h),_.extend(this,f),this._bound=!0),Backbone.Events.bind.apply(this,arguments),this}}(),function(){var a,b,c,d=Two.Commands,e=Two.Anchor=function(a,b,c,f,g,h,i){return Two.Vector.call(this,a,b),this._broadcast=_.bind(function(){this.trigger(Two.Events.change)},this),Object.defineProperty(this,"command",{get:function(){return this._command},set:function(a){return this._command=a,this._command!==d.curve||_.isObject(this.controls)||e.AppendCurveProperties(this),this.trigger(Two.Events.change)}}),this._command=i||d.move,i?(e.AppendCurveProperties(this),_.isNumber(c)&&(this.controls.left.x=c),_.isNumber(f)&&(this.controls.left.y=f),_.isNumber(g)&&(this.controls.right.x=g),void(_.isNumber(h)&&(this.controls.right.y=h))):this};_.extend(e,{AppendCurveProperties:function(c){a=c._x||c.x,b=c._y||c.y,c.controls={left:new Two.Vector(a,b),right:new Two.Vector(a,b)}}});var f={listen:function(){return _.isObject(this.controls)||e.AppendCurveProperties(this),_.each(this.controls,function(a){a.bind(Two.Events.change,this._broadcast)},this),this},ignore:function(){return _.each(this.controls,function(a){a.unbind(Two.Events.change,this._broadcast)},this),this},clone:function(){return c=this.controls,new Two.Anchor(this.x,this.y,c&&c.left.x,c&&c.left.y,c&&c.right.x,c&&c.right.y,this.command)},toObject:function(){var a={x:this.x,y:this.y};return this.command&&(a.command=this.command),this.controls&&(a.controls={left:this.controls.left.toObject(),right:this.controls.right.toObject()}),a}};_.extend(e.prototype,Two.Vector.prototype,f),Two.Anchor.prototype.bind=Two.Anchor.prototype.on=function(){Two.Vector.prototype.bind.apply(this,arguments),_.extend(this,f)}}(),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,c,K,L,M,N,O,P,Q,R,S,T,U,V,W,X=(_.range(6),Math.cos),Y=Math.sin,Z=Math.tan,$=[],ab=Two.Matrix=function(a){this.elements=new Two.Array(9);var b=a;_.isArray(b)||(b=_.toArray(arguments)),this.identity().set(b)};_.extend(ab,{Identity:[1,0,0,0,1,0,0,0,1],Multiply:function(d,f,g){return f.length<=3?(a=f[0]||0,b=f[1]||0,c=f[2]||0,e=d,l=e[0]*a+e[1]*b+e[2]*c,m=e[3]*a+e[4]*b+e[5]*c,n=e[6]*a+e[7]*b+e[8]*c,{x:l,y:m,z:n}):(o=d[0],p=d[1],q=d[2],r=d[3],s=d[4],t=d[5],u=d[6],v=d[7],w=d[8],x=f[0],y=f[1],z=f[2],A=f[3],B=f[4],C=f[5],D=f[6],E=f[7],F=f[8],g=g||new Two.Array(9),g[0]=o*x+p*A+q*D,g[1]=o*y+p*B+q*E,g[2]=o*z+p*C+q*F,g[3]=r*x+s*A+t*D,g[4]=r*y+s*B+t*E,g[5]=r*z+s*C+t*F,g[6]=u*x+v*A+w*D,g[7]=u*y+v*B+w*E,g[8]=u*z+v*C+w*F,g)}}),_.extend(ab.prototype,Backbone.Events,{set:function(a){return k=a,I=arguments.length,_.isArray(k)||(k=_.toArray(arguments)),_.each(k,function(a,b){_.isNumber(a)&&(this.elements[b]=a)},this),this.trigger(Two.Events.change)},identity:function(){return this.set(ab.Identity),this},multiply:function(a,b,c,d,e){return k=arguments,I=k.length,1>=I?(_.each(this.elements,function(b,c){this.elements[c]=b*a},this),this.trigger(Two.Events.change)):3>=I?(a=a||0,b=b||0,c=c||0,e=this.elements,l=e[0]*a+e[1]*b+e[2]*c,m=e[3]*a+e[4]*b+e[5]*c,n=e[6]*a+e[7]*b+e[8]*c,{x:l,y:m,z:n}):(G=this.elements,H=k,o=G[0],p=G[1],q=G[2],r=G[3],s=G[4],t=G[5],u=G[6],v=G[7],w=G[8],x=H[0],y=H[1],z=H[2],A=H[3],B=H[4],C=H[5],D=H[6],E=H[7],F=H[8],this.elements[0]=o*x+p*A+q*D,this.elements[1]=o*y+p*B+q*E,this.elements[2]=o*z+p*C+q*F,this.elements[3]=r*x+s*A+t*D,this.elements[4]=r*y+s*B+t*E,this.elements[5]=r*z+s*C+t*F,this.elements[6]=u*x+v*A+w*D,this.elements[7]=u*y+v*B+w*E,this.elements[8]=u*z+v*C+w*F,this.trigger(Two.Events.change))},inverse:function(b){return a=this.elements,b=b||new Two.Matrix,K=a[0],L=a[1],M=a[2],N=a[3],O=a[4],P=a[5],Q=a[6],R=a[7],S=a[8],T=S*O-P*R,U=-S*N+P*Q,V=R*N-O*Q,(W=K*T+L*U+M*V)?(W=1/W,b.elements[0]=T*W,b.elements[1]=(-S*L+M*R)*W,b.elements[2]=(P*L-M*O)*W,b.elements[3]=U*W,b.elements[4]=(S*K-M*Q)*W,b.elements[5]=(-P*K+M*N)*W,b.elements[6]=V*W,b.elements[7]=(-R*K+L*Q)*W,b.elements[8]=(O*K-L*N)*W,b):null},scale:function(a,b){return I=arguments.length,1>=I&&(b=a),this.multiply(a,0,0,0,b,0,0,0,1)},rotate:function(a){return c=X(a),J=Y(a),this.multiply(c,-J,0,J,c,0,0,0,1)},translate:function(a,b){return this.multiply(1,0,a,0,1,b,0,0,1)},skewX:function(b){return a=Z(b),this.multiply(1,a,0,0,1,0,0,0,1)},skewY:function(b){return a=Z(b),this.multiply(1,0,0,a,1,0,0,0,1)},toString:function(a){return this.toArray(a,$),$.join(" ")},toArray:function(l,m){return k=this.elements,j=!!m,a=parseFloat(k[0].toFixed(3)),b=parseFloat(k[1].toFixed(3)),c=parseFloat(k[2].toFixed(3)),d=parseFloat(k[3].toFixed(3)),e=parseFloat(k[4].toFixed(3)),f=parseFloat(k[5].toFixed(3)),l?(g=parseFloat(k[6].toFixed(3)),h=parseFloat(k[7].toFixed(3)),i=parseFloat(k[8].toFixed(3)),j?(m[0]=a,m[1]=d,m[2]=g,m[3]=b,m[4]=e,m[5]=h,m[6]=c,m[7]=f,void(m[8]=i)):[a,d,g,b,e,h,c,f,i]):j?(m[0]=a,m[1]=d,m[2]=b,m[3]=e,m[4]=c,void(m[5]=f)):[a,d,b,e,c,f]},clone:function(){return a=this.elements[0],b=this.elements[1],c=this.elements[2],d=this.elements[3],e=this.elements[4],f=this.elements[5],g=this.elements[6],h=this.elements[7],i=this.elements[8],new Two.Matrix(a,b,c,d,e,f,g,h,i)}})}(),function(){var a,b,c,d=Two.Utils.mod,e={version:1.1,ns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",createElement:function(a,d){return c=a,b=document.createElementNS(this.ns,c),"svg"===c&&(d=_.defaults(d||{},{version:this.version})),_.isObject(d)&&e.setAttributes(b,d),b},setAttribute:function(a,b){this.setAttribute(b,a)},setAttributes:function(a,b){return _.each(b,e.setAttribute,a),this},removeAttribute:function(a,b){this.removeAttribute(b)},removeAttributes:function(a,b){return _.each(b,e.removeAttribute,a),this},toString:function(a,b){var c=a.length,e=c-1;return _.map(a,function(f,g){var h,i,j,k,l,m,n,o,p,q=b?d(g-1,c):Math.max(g-1,0),r=b?d(g+1,c):Math.min(g+1,e),s=a[q],t=a[r],u=f.x.toFixed(3),v=f.y.toFixed(3);switch(f._command){case Two.Commands.close:h=Two.Commands.close;break;case Two.Commands.curve:var m=s.controls&&s.controls.right||s,n=f.controls&&f.controls.left||f;i=m.x.toFixed(3),j=m.y.toFixed(3),k=n.x.toFixed(3),l=n.y.toFixed(3),h=(0===g?Two.Commands.move:Two.Commands.curve)+" "+i+" "+j+" "+k+" "+l+" "+u+" "+v;break;default:h=(0===g?Two.Commands.move:f._command)+" "+u+" "+v}return g>=e&&b&&(f._command===Two.Commands.curve&&(o=f.controls&&f.controls.right||f,p=t.controls&&t.controls.left||t,i=o.x.toFixed(3),j=o.y.toFixed(3),k=p.x.toFixed(3),l=p.y.toFixed(3),u=t.x.toFixed(3),v=t.y.toFixed(3),h+=" C "+i+" "+j+" "+k+" "+l+" "+u+" "+v),h+=" Z"),h}).join(" ")},group:{appendChild:function(a){b=this.domElement.querySelector("#"+Two.Identifier+a),b&&this.elem.appendChild(b)},removeChild:function(a){b=this.domElement.querySelector("#"+Two.Identifier+a),b&&this.elem.removeChild(b)},renderChild:function(a){e[a._renderer.type].render.call(a,this)},render:function(b){this._update(),this._renderer.elem||(this._renderer.elem=e.createElement("g",{id:Two.Identifier+this.id}),b.appendChild(this._renderer.elem)),a=this._matrix.manual||this._flagMatrix;var c={domElement:b,elem:this._renderer.elem};return a&&this._renderer.elem.setAttribute("transform","matrix("+this._matrix.toString()+")"),_.each(this.children,e.group.renderChild,b),this._flagAdditions&&_.each(this.additions,e.group.appendChild,c),this._flagSubtractions&&_.each(this.subtractions,e.group.removeChild,c),this.flagReset()}},polygon:{render:function(c){return this._update(),this._renderer.elem||(this._renderer.elem=e.createElement("path",{id:Two.Identifier+this.id}),c.appendChild(this._renderer.elem)),b=this._renderer.elem,a=this._matrix.manual||this._flagMatrix,a&&b.setAttribute("transform","matrix("+this._matrix.toString()+")"),this._flagVertices&&(vertices=e.toString(this._vertices,this._closed),b.setAttribute("d",vertices)),this._flagFill&&b.setAttribute("fill",this._fill),this._flagStroke&&b.setAttribute("stroke",this._stroke),this._flagLinewidth&&b.setAttribute("stroke-width",this._linewidth),this._flagOpacity&&(b.setAttribute("stroke-opacity",this._opacity),b.setAttribute("fill-opacity",this._opacity)),this._flagVisible&&b.setAttribute("visibility",this._visible?"visible":"hidden"),this._flagCap&&b.setAttribute("stroke-linecap",this._cap),this._flagJoin&&b.setAttribute("stroke-linejoin",this._join),this._flagMiter&&b.setAttribute("stroke-miterlimit",this.miter),this.flagReset()}}},f=Two[Two.Types.svg]=function(a){this.domElement=a.domElement||e.createElement("svg"),this.scene=new Two.Group,this.scene.parent=this};_.extend(f,{Utils:e}),_.extend(f.prototype,Backbone.Events,{setSize:function(a,b){return this.width=a,this.height=b,e.setAttributes(this.domElement,{width:a,height:b}),this},render:function(){return e.group.render.call(this.scene,this.domElement),this}})}(),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B=Two.Utils.mod,C=Two.Utils.getRatio,D={group:{renderChild:function(a){D[a._renderer.type].render.call(a,this)},render:function(b){return this._update(),a=this._matrix.elements,b.save(),b.transform(a[0],a[3],a[1],a[4],a[2],a[5]),_.each(this.children,D.group.renderChild,b),b.restore(),this.flagReset()}},polygon:{render:function(C){return this._update(),a=this._matrix.elements,b=this.stroke,c=this.linewidth,d=this.fill,e=this.opacity,f=this.visible,g=this.cap,h=this.join,i=this.miter,j=this.closed,k=this._vertices,l=k.length,m=l-1,f?(C.save(),a&&C.transform(a[0],a[3],a[1],a[4],a[2],a[5]),d&&(C.fillStyle=d),b&&(C.strokeStyle=b),c&&(C.lineWidth=c),i&&(C.miterLimit=i),h&&(C.lineJoin=h),g&&(C.lineCap=g),_.isNumber(e)&&(C.globalAlpha=e),C.beginPath(),_.each(k,function(a,b){switch(z=a.x.toFixed(3),A=a.y.toFixed(3),a._command){case Two.Commands.close:C.closePath();break;case Two.Commands.curve:o=j?B(b-1,l):Math.max(b-1,0),n=j?B(b+1,l):Math.min(b+1,m),p=k[o],q=k[n],v=p.controls&&p.controls.right||p,w=a.controls&&a.controls.left||a,t=v.x.toFixed(3),u=v.y.toFixed(3),r=w.x.toFixed(3),s=w.y.toFixed(3),C.bezierCurveTo(t,u,r,s,z,A),b>=m&&j&&(x=a.controls&&a.controls.right||a,y=q.controls&&q.controls.left||q,t=x.x.toFixed(3),u=x.y.toFixed(3),r=y.x.toFixed(3),s=y.y.toFixed(3),z=q.x.toFixed(3),A=q.y.toFixed(3),C.bezierCurveTo(t,u,r,s,z,A));break;case Two.Commands.line:C.lineTo(z,A);break;case Two.Commands.move:C.moveTo(z,A)}}),j&&C.closePath(),C.fill(),C.stroke(),C.restore(),this.flagReset()):this}}},E=Two[Two.Types.canvas]=function(a){this.domElement=a.domElement||document.createElement("canvas"),this.ctx=this.domElement.getContext("2d"),this.overdraw=!1,this.scene=new Two.Group,this.scene.parent=this};_.extend(E,{Utils:D}),_.extend(E.prototype,Backbone.Events,{setSize:function(a,b,c){return this.width=a,this.height=b,this.ratio=_.isUndefined(c)?C(this.ctx):c,this.domElement.width=a*this.ratio,this.domElement.height=b*this.ratio,_.extend(this.domElement.style,{width:a+"px",height:b+"px"}),this},render:function(){var a=1===this.ratio;return a||(this.ctx.save(),this.ctx.scale(this.ratio,this.ratio)),this.overdraw||this.ctx.clearRect(0,0,this.width,this.height),D.group.render.call(this.scene,this.ctx),a||this.ctx.restore(),this}})}(),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,ab,bb,cb=(Two[Two.Types.canvas],Two.Matrix.Multiply),db=Two.Utils.mod,eb=[1,0,0,0,1,0,0,0,1],fb=new Two.Array(9),gb=Two.Utils.getRatio,hb={canvas:document.createElement("canvas"),uv:new Two.Array([0,0,1,0,0,1,0,1,1,0,1,1]),group:{renderChild:function(a){hb[a._renderer.type].render.call(a,this.gl,this.program)},render:function(d,e){return this._update(),a=this.parent,b=a._matrix&&a._matrix.manual||a._flagMatrix,c=this._matrix.manual||this._flagMatrix,(b||c)&&(this._renderer.matrix||(this._renderer.matrix=new Two.Array(9)),this._matrix.toArray(!0,fb),cb(fb,a._renderer.matrix,this._renderer.matrix),this._renderer.scale=this._scale*a._renderer.scale,b&&(this._flagMatrix=!0)),_.each(this.children,hb.group.renderChild,{gl:d,program:e}),this.flagReset()}},polygon:{render:function(e,f){return this._visible&&this._opacity?(a=this.parent,b=a._matrix.manual||a._flagMatrix,c=this._matrix.manual||this._flagMatrix,d=this._flagVertices||this._flagFill||this._flagStroke||this._flagLinewidth||this._flagOpacity||this._flagVisible||this._flagCap||this._flagJoin||this._flagMiter||this._flagScale,this._update(),(b||c)&&(this._renderer.matrix||(this._renderer.matrix=new Two.Array(9)),this._matrix.toArray(!0,fb),cb(fb,a._renderer.matrix,this._renderer.matrix),this._renderer.scale=this._scale*a._renderer.scale),d&&(this._renderer.rect||(this._renderer.rect={}),this._renderer.triangles||(this._renderer.triangles=new Two.Array(12)),hb.getBoundingClientRect(this._vertices,this._linewidth,this._renderer.rect),hb.getTriangles(this._renderer.rect,this._renderer.triangles),hb.updateBuffer(e,this,f),hb.updateTexture(e,this)),e.bindBuffer(e.ARRAY_BUFFER,this._renderer.textureCoordsBuffer),e.vertexAttribPointer(f.textureCoords,2,e.FLOAT,!1,0,0),e.bindTexture(e.TEXTURE_2D,this._renderer.texture),e.uniformMatrix3fv(f.matrix,!1,this._renderer.matrix),e.bindBuffer(e.ARRAY_BUFFER,this._renderer.buffer),e.vertexAttribPointer(f.position,2,e.FLOAT,!1,0,0),e.drawArrays(e.TRIANGLES,0,6),this.flagReset()):this}},getBoundingClientRect:function(a,b,c){e=1/0,f=-1/0,g=1/0,h=-1/0,_.each(a,function(a){i=a.x,j=a.y,o=a.controls,g=Math.min(j,g),e=Math.min(i,e),f=Math.max(i,f),h=Math.max(j,h),a.controls&&(p=o.left,q=o.right,p&&q&&(k=p.x,l=p.y,m=q.x,n=q.y,k&&l&&m&&n&&(g=Math.min(l,n,g),e=Math.min(k,m,e),f=Math.max(k,m,f),h=Math.max(l,n,h))))}),_.isNumber(b)&&(g-=b,e-=b,f+=b,h+=b),r=f-e,s=h-g,c.top=g,c.left=e,c.right=f,c.bottom=h,c.width=r,c.height=s,c.centroid||(c.centroid={}),c.centroid.x=-e,c.centroid.y=-g},getTriangles:function(a,b){g=a.top,e=a.left,f=a.right,h=a.bottom,b[0]=e,b[1]=g,b[2]=f,b[3]=g,b[4]=e,b[5]=h,b[6]=e,b[7]=h,b[8]=f,b[9]=g,b[10]=f,b[11]=h},updateCanvas:function(a){t=a._vertices,u=this.canvas,v=this.ctx,w=a._renderer.scale,x=a._stroke,y=a._linewidth*w,z=a._fill,A=a._opacity,B=a._cap,C=a._join,D=a._miter,E=a._closed,F=t.length,G=F-1,u.width=Math.max(Math.ceil(a._renderer.rect.width*w),1),u.height=Math.max(Math.ceil(a._renderer.rect.height*w),1),H=a._renderer.rect.centroid,I=H.x*w,J=H.y*w,v.clearRect(0,0,u.width,u.height),z&&(v.fillStyle=z),x&&(v.strokeStyle=x),y&&(v.lineWidth=y),D&&(v.miterLimit=D),C&&(v.lineJoin=C),B&&(v.lineCap=B),_.isNumber(A)&&(v.globalAlpha=A),v.beginPath(),_.each(t,function(a,b){switch(i=(a.x*w+I).toFixed(3),j=(a.y*w+J).toFixed(3),a._command){case Two.Commands.close:v.closePath();break;case Two.Commands.curve:L=E?db(b-1,F):Math.max(b-1,0),K=E?db(b+1,F):Math.min(b+1,G),k=t[L],m=t[K],Q=k.controls&&k.controls.right||k,R=a.controls&&a.controls.left||a,O=(Q.x*w+I).toFixed(3),P=(Q.y*w+J).toFixed(3),M=(R.x*w+I).toFixed(3),N=(R.y*w+J).toFixed(3),v.bezierCurveTo(O,P,M,N,i,j),b>=G&&E&&(S=a.controls&&a.controls.right||a,p=m.controls&&m.controls.left||m,O=(S.x*w+I).toFixed(3),P=(S.y*w+J).toFixed(3),M=(p.x*w+I).toFixed(3),N=(p.y*w+J).toFixed(3),i=(m.x*w+I).toFixed(3),j=(m.y*w+J).toFixed(3),v.bezierCurveTo(O,P,M,N,i,j));break;case Two.Commands.line:v.lineTo(i,j);break;case Two.Commands.move:v.moveTo(i,j)}}),E&&v.closePath(),v.fill(),v.stroke()},updateTexture:function(a,b){this.updateCanvas(b),b._renderer.texture&&a.deleteTexture(b._renderer.texture),a.bindBuffer(a.ARRAY_BUFFER,b._renderer.textureCoordsBuffer),b._renderer.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,b._renderer.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),this.canvas.width<=0||this.canvas.height<=0||a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,this.canvas)},updateBuffer:function(a,b,c){_.isObject(b._renderer.buffer)&&a.deleteBuffer(b._renderer.buffer),b._renderer.buffer=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,b._renderer.buffer),a.enableVertexAttribArray(c.position),a.bufferData(a.ARRAY_BUFFER,b._renderer.triangles,a.STATIC_DRAW),_.isObject(b._renderer.textureCoordsBuffer)&&a.deleteBuffer(b._renderer.textureCoordsBuffer),b._renderer.textureCoordsBuffer=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,b._renderer.textureCoordsBuffer),a.enableVertexAttribArray(c.textureCoords),a.bufferData(a.ARRAY_BUFFER,this.uv,a.STATIC_DRAW)},program:{create:function(a,b){if(T=a.createProgram(),_.each(b,function(b){a.attachShader(T,b)}),a.linkProgram(T),U=a.getProgramParameter(T,a.LINK_STATUS),!U)throw X=a.getProgramInfoLog(T),a.deleteProgram(T),new Two.Utils.Error("unable to link program: "+X);return T}},shaders:{create:function(a,b,c){if(V=a.createShader(a[c]),a.shaderSource(V,b),a.compileShader(V),W=a.getShaderParameter(V,a.COMPILE_STATUS),!W)throw X=a.getShaderInfoLog(V),a.deleteShader(V),new Two.Utils.Error("unable to compile shader "+V+": "+X);return V},types:{vertex:"VERTEX_SHADER",fragment:"FRAGMENT_SHADER"},vertex:["attribute vec2 a_position;","attribute vec2 a_textureCoords;","","uniform mat3 u_matrix;","uniform vec2 u_resolution;","","varying vec2 v_textureCoords;","","void main() {","   vec2 projected = (u_matrix * vec3(a_position, 1.0)).xy;","   vec2 normal = projected / u_resolution;","   vec2 clipspace = (normal * 2.0) - 1.0;","","   gl_Position = vec4(clipspace * vec2(1.0, -1.0), 0.0, 1.0);","   v_textureCoords = a_textureCoords;","}"].join("\n"),fragment:["precision mediump float;","","uniform sampler2D u_image;","varying vec2 v_textureCoords;","","void main() {","  gl_FragColor = texture2D(u_image, v_textureCoords);","}"].join("\n")}};hb.ctx=hb.canvas.getContext("2d");var ib=Two[Two.Types.webgl]=function(a){if(this.domElement=a.domElement||document.createElement("canvas"),this.scene=new Two.Group,this.scene.parent=this,this._renderer={matrix:new Two.Array(eb),scale:1},this._flagMatrix=!0,bb=_.defaults(a||{},{antialias:!1,alpha:!0,premultipliedAlpha:!0,stencil:!0,preserveDrawingBuffer:!0,overdraw:!1}),this.overdraw=bb.overdraw,Y=this.ctx=this.domElement.getContext("webgl",bb)||this.domElement.getContext("experimental-webgl",bb),!this.ctx)throw new Two.Utils.Error("unable to create a webgl context. Try using another renderer.");ab=hb.shaders.create(Y,hb.shaders.vertex,hb.shaders.types.vertex),$=hb.shaders.create(Y,hb.shaders.fragment,hb.shaders.types.fragment),this.program=hb.program.create(Y,[ab,$]),Y.useProgram(this.program),this.program.position=Y.getAttribLocation(this.program,"a_position"),this.program.matrix=Y.getUniformLocation(this.program,"u_matrix"),this.program.textureCoords=Y.getAttribLocation(this.program,"a_textureCoords"),Y.disable(Y.DEPTH_TEST),Y.enable(Y.BLEND),Y.blendEquationSeparate(Y.FUNC_ADD,Y.FUNC_ADD),Y.blendFuncSeparate(Y.SRC_ALPHA,Y.ONE_MINUS_SRC_ALPHA,Y.ONE,Y.ONE_MINUS_SRC_ALPHA)};_.extend(ib.prototype,Backbone.Events,{setSize:function(a,b,c){return this.width=a,this.height=b,this.ratio=_.isUndefined(c)?gb(this.ctx):c,this.domElement.width=a*this.ratio,this.domElement.height=b*this.ratio,_.extend(this.domElement.style,{width:a+"px",height:b+"px"}),a*=this.ratio,b*=this.ratio,this._renderer.matrix[0]=this._renderer.matrix[4]=this._renderer.scale=this.ratio,this._flagMatrix=!0,this.ctx.viewport(0,0,a,b),Z=this.ctx.getUniformLocation(this.program,"u_resolution"),this.ctx.uniform2f(Z,a,b),this},render:function(){return Y=this.ctx,this.overdraw||Y.clear(Y.COLOR_BUFFER_BIT|Y.DEPTH_BUFFER_BIT),hb.group.render.call(this.scene,Y,this.program),this._flagMatrix=!1,this}})}(),function(){var a,b=(new Two.Vector,Two.Shape=function(){this._renderer={},this.id=Two.uniqueId(),this._matrix=new Two.Matrix,this.translation=new Two.Vector,this.translation.bind(Two.Events.change,_.bind(b.FlagMatrix,this)),this.rotation=0,this.scale=1});_.extend(b,Backbone.Events,{FlagMatrix:function(){this._flagMatrix=!0},MakeObservable:function(a){Object.defineProperty(a,"rotation",{get:function(){return this._rotation},set:function(a){this._rotation=a,this._flagMatrix=!0}}),Object.defineProperty(a,"scale",{get:function(){return this._scale},set:function(a){this._scale=a,this._flagMatrix=!0,this._flagScale=!0}})}}),_.extend(b.prototype,{_flagMatrix:!0,_rotation:0,_scale:1,addTo:function(a){return a.add(this),this},clone:function(){return a=new b,a.translation.copy(this.translation),a.rotation=this.rotation,a.scale=this.scale,_.each(b.Properties,function(b){a[b]=this[b]},this),a._update()},_update:function(){return!this._matrix.manual&&this._flagMatrix&&this._matrix.identity().translate(this.translation.x,this.translation.y).scale(this.scale).rotate(this.rotation),this},flagReset:function(){return this._flagMatrix=!1,this._flagScale=!1,this}}),b.MakeObservable(b.prototype)}(),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F=Math.min,G=Math.max,H=Math.round,I=Two.Utils.getComputedMatrix,J=Two.Polygon=function(a,b,c,d){Two.Shape.call(this),this._renderer.type="polygon",this._closed=!!b,this._curved=!!c,this.beginning=0,this.ending=1,this.fill="#fff",this.stroke="#000",this.linewidth=1,this.opacity=1,this.visible=!0,this.cap="butt",this.join="miter",this.miter=4,this._vertices=[],this.vertices=a,this.automatic=!d};_.extend(J,{Properties:["fill","stroke","linewidth","opacity","visible","cap","join","miter","closed","curved","automatic","beginning","ending"],FlagVertices:function(){this._flagVertices=!0},MakeObservable:function(a){Two.Shape.MakeObservable(a),_.each(J.Properties.slice(0,8),function(b){var c="_"+b,d="_flag"+b.charAt(0).toUpperCase()+b.slice(1);Object.defineProperty(a,b,{get:function(){return this[c]},set:function(a){this[c]=a,this[d]=!0}})}),Object.defineProperty(a,"closed",{get:function(){return this._closed},set:function(a){this._closed=!!a,this._flagVertices=!0}}),Object.defineProperty(a,"curved",{get:function(){return this._curved},set:function(a){this._curved=!!a,this._flagVertices=!0}}),Object.defineProperty(J.prototype,"automatic",{get:function(){return this._automatic},set:function(a){a!==this._automatic&&(this._automatic=!!a,method=this._automatic?"ignore":"listen",_.each(this.vertices,function(a){a[method]()}))}}),Object.defineProperty(a,"beginning",{get:function(){return this._beginning},set:function(a){this._beginning=F(G(a,0),1),this._flagVertices=!0}}),Object.defineProperty(a,"ending",{get:function(){return this._ending},set:function(a){this._ending=F(G(a,0),1),this._flagVertices=!0}}),Object.defineProperty(a,"vertices",{get:function(){return this._collection},set:function(a){var b=_.bind(J.FlagVertices,this),c=_.bind(function(a){_.each(a,function(a){a.bind(Two.Events.change,b)},this),b()},this),d=_.bind(function(a){_.each(a,function(a){a.unbind(Two.Events.change,b)},this),b()},this);this._collection&&this._collection.unbind(),this._collection=new Two.Utils.Collection(a.slice(0)),this._collection.bind(Two.Events.insert,c),this._collection.bind(Two.Events.remove,d),verticesChanged=!0,c(this._collection)
}})}}),_.extend(J.prototype,Two.Shape.prototype,{_flagVertices:!0,_flagFill:!0,_flagStroke:!0,_flagLinewidth:!0,_flagOpacity:!0,_flagVisible:!0,_flagCap:!0,_flagJoin:!0,_flagMiter:!0,_fill:"#fff",_stroke:"#000",_linewidth:1,_opacity:1,_visible:!0,_cap:"round",_join:"round",_miter:4,_closed:!0,_curved:!1,_automatic:!0,_beginning:0,_ending:1,clone:function(a){return a=a||this.parent,h=_.map(this.vertices,function(a){return a.clone()}),i=new J(h,this.closed,this.curved,!this.automatic),_.each(Two.Shape.Properties,function(a){i[a]=this[a]},this),i.translation.copy(this.translation),i.rotation=this.rotation,i.scale=this.scale,a.add(i),i},toObject:function(){var a={vertices:_.map(this.vertices,function(a){return a.toObject()})};return _.each(Two.Shape.Properties,function(b){a[b]=this[b]},this),a.translation=this.translation.toObject,a.rotation=this.rotation,a.scale=this.scale,a},noFill:function(){return this.fill="transparent",this},noStroke:function(){return this.stroke="transparent",this},corner:function(){return j=this.getBoundingClientRect(!0),j.centroid={x:j.left+j.width/2,y:j.top+j.height/2},_.each(this.vertices,function(a){a.addSelf(j.centroid)}),this},center:function(){return j=this.getBoundingClientRect(!0),j.centroid={x:j.left+j.width/2,y:j.top+j.height/2},_.each(this.vertices,function(a){a.subSelf(j.centroid)}),this},remove:function(){return this.parent?(this.parent.remove(this),this):this},getBoundingClientRect:function(a){return this._update(),k=this.linewidth/2,l,m=1/0,n=-1/0,o=1/0,p=-1/0,_.each(this._vertices,function(a){q=a.x,r=a.y,o=F(r,o),m=F(q,m),n=G(q,n),p=G(r,p)}),o-=k,m-=k,n+=k,p+=k,w=a?this._matrix:I(this),s=w.multiply(m,o,1),t=w.multiply(n,o,1),u=w.multiply(n,p,1),v=w.multiply(m,p,1),o=F(s.y,t.y,u.y,v.y),m=F(s.x,t.x,u.x,v.x),n=G(s.x,t.x,u.x,v.x),p=G(s.y,t.y,u.y,v.y),{top:o,left:m,right:n,bottom:p,width:n-m,height:p-o}},plot:function(){return this.curved?(Two.Utils.getCurveFromPoints(this.vertices,this.closed),this):(_.each(this.vertices,function(a,b){a._command=0===b?Two.Commands.move:Two.Commands.line},this),this)},subdivide:function(a){return this._update(),d=this.vertices.length-1,t=this.vertices[d],e=this._closed||this.vertices[d].command===Two.Commands.close,h=[],_.each(this.vertices,function(b,c){if(0>=c&&!e||b.command===Two.Commands.move)return h.push(new Two.Anchor(t.x,t.y)),h[h.length-1].command=Two.Commands.line,void(t=b);n=t.controls&&t.controls.right,m=b.controls&&b.controls.left,x=t.x,y=t.y,z=(n||t).x,A=(n||t).y,B=(m||b).x,C=(m||b).y,D=b.x,E=b.y;var f=Two.Utils.subdivide(x,y,z,A,B,C,D,E,a);h=h.concat(f),_.each(f,function(a,b){a.command=0>=b&&t.command===Two.Commands.move?Two.Commands.move:Two.Commands.line}),c>=d&&(h.push(new Two.Anchor(D,E)),h[h.length-1].command=e?Two.Commands.close:Two.Commands.line),t=b},this),this._automatic=!1,this._curved=!1,this.vertices=h,this},_update:function(){if(this._flagVertices)for(this._automatic&&this.plot(),a=this.vertices.length,d=a-1,b=H(this._beginning*d),c=H(this._ending*d),this._vertices.length=0,g=b;c+1>g;g++)f=this.vertices[g],this._vertices.push(f);return Two.Shape.prototype._update.call(this),this},flagReset:function(){return this._flagVertices=this._flagFill=this._flagStroke=this._flagLinewidth=this._flagOpacity=this._flagVisible=this._flagCap=this._flagJoin=this._flagMiter=!1,Two.Shape.prototype.flagReset.call(this),this}}),J.MakeObservable(J.prototype)}(),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v=Math.min,w=Math.max,x=Two.Group=function(){Two.Shape.call(this,!0),this._renderer.type="group",this.additions=[],this.subtractions=[],this.children={}};_.extend(x,{MakeObservable:function(a){Two.Shape.MakeObservable(a),x.MakeGetterSetter(a,Two.Polygon.Properties)},MakeGetterSetter:function(b,c){_.isArray(c)||(c=[c]),_.each(c,function(c){a="_"+c,Object.defineProperty(b,c,{get:function(){return this[a]},set:function(b){this[a]=b,_.each(this.children,function(a){a[c]=b})}})})}}),_.extend(x.prototype,Two.Shape.prototype,{_flagAdditions:!1,_flagSubtractions:!1,_fill:"#fff",_stroke:"#000",_linewidth:1,_opacity:1,_visible:!0,_cap:"round",_join:"round",_miter:4,_closed:!0,_curved:!1,_automatic:!0,_beginning:0,_ending:1,clone:function(a){return a=a||this.parent,d=new x,a.add(d),c=_.map(this.children,function(a){return a.clone(d)}),d.translation.copy(this.translation),d.rotation=this.rotation,d.scale=this.scale,d},toObject:function(){var a={children:{},translation:this.translation.toObject(),rotation:this.rotation,scale:this.scale};return _.each(this.children,function(b,c){a.children[c]=b.toObject()},this),a},corner:function(){return e=this.getBoundingClientRect(!0),f={x:e.left,y:e.top},_.each(this.children,function(a){a.translation.subSelf(f)}),this},center:function(){return e=this.getBoundingClientRect(!0),e.centroid={x:e.left+e.width/2,y:e.top+e.height/2},_.each(this.children,function(a){a.translation.subSelf(e.centroid)}),this},add:function(a){return g=arguments.length,h=a,c=this.children,i=this.parent,j=this.additions,_.isArray(a)||(h=_.toArray(arguments)),_.each(h,function(a){a&&(k=a.id,b=a.parent,_.isUndefined(c[k])&&(b&&(delete b.children[k],u=_.indexOf(b.additions,k),u>=0&&b.additions.splice(u,1)),c[k]=a,a.parent=this,j.push(k),this._flagAdditions=!0))},this),this},remove:function(a){return g=arguments.length,h=a,c=this.children,i=this.parent,j=this.subtractions,0>=g&&i?(i.remove(this),this):(_.isArray(a)||(h=_.toArray(arguments)),_.each(h,function(a){k=a.id,grandchildren=a.children,b=a.parent,k in c&&(delete c[k],delete a.parent,u=_.indexOf(b.additions,k),u>=0&&b.additions.splice(u,1),j.push(k),this._flagSubtractions=!0)},this),this)},getBoundingClientRect:function(a){return this._update(),l=1/0,m=-1/0,n=1/0,o=-1/0,_.each(this.children,function(a){e=a.getBoundingClientRect(!0),_.isNumber(e.top)&&_.isNumber(e.left)&&_.isNumber(e.right)&&_.isNumber(e.bottom)&&(n=v(e.top,n),l=v(e.left,l),m=w(e.right,m),o=w(e.bottom,o))},this),p=a?this._matrix:Two.Utils.getComputedMatrix(this),q=p.multiply(l,n,1),r=p.multiply(m,n,1),s=p.multiply(m,o,1),t=p.multiply(l,o,1),n=v(q.y,r.y,s.y,t.y),l=v(q.x,r.x,s.x,t.x),m=w(q.x,r.x,s.x,t.x),o=w(q.y,r.y,s.y,t.y),{top:n,left:l,right:m,bottom:o,width:m-l,height:o-n}},noFill:function(){return _.each(this.children,function(a){a.noFill()}),this},noStroke:function(){return _.each(this.children,function(a){a.noStroke()}),this},subdivide:function(){var a=arguments;return _.each(this.children,function(b){b.subdivide.apply(b,a)}),this},flagReset:function(){return this._flagAdditions&&(this.additions.length=0,this._flagAdditions=!1),this._flagSubtractions&&(this.subtractions.length=0,this._flagSubtractions=!1),Two.Shape.prototype.flagReset.call(this),this}}),x.MakeObservable(x.prototype)}(),function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.push,h=d.slice,i=d.concat,j=e.toString,k=e.hasOwnProperty,l=d.forEach,m=d.map,n=d.reduce,o=d.reduceRight,p=d.filter,q=d.every,r=d.some,s=d.indexOf,t=d.lastIndexOf,u=Array.isArray,v=Object.keys,w=f.bind,x=function(a){return a instanceof x?a:this instanceof x?void(this._wrapped=a):new x(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):a._=x,x.VERSION="1.6.0";var y=x.each=x.forEach=function(a,b,d){if(null==a)return a;if(l&&a.forEach===l)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;f>e;e++)if(b.call(d,a[e],e,a)===c)return}else for(var g=x.keys(a),e=0,f=g.length;f>e;e++)if(b.call(d,a[g[e]],g[e],a)===c)return;return a};x.map=x.collect=function(a,b,c){var d=[];return null==a?d:m&&a.map===m?a.map(b,c):(y(a,function(a,e,f){d.push(b.call(c,a,e,f))}),d)};var z="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),n&&a.reduce===n)return d&&(b=x.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(y(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(z);return c},x.reduceRight=x.foldr=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),o&&a.reduceRight===o)return d&&(b=x.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=x.keys(a);f=g.length}if(y(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)}),!e)throw new TypeError(z);return c},x.find=x.detect=function(a,b,c){var d;return A(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},x.filter=x.select=function(a,b,c){var d=[];return null==a?d:p&&a.filter===p?a.filter(b,c):(y(a,function(a,e,f){b.call(c,a,e,f)&&d.push(a)}),d)},x.reject=function(a,b,c){return x.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},x.every=x.all=function(a,b,d){b||(b=x.identity);var e=!0;return null==a?e:q&&a.every===q?a.every(b,d):(y(a,function(a,f,g){return(e=e&&b.call(d,a,f,g))?void 0:c}),!!e)};var A=x.some=x.any=function(a,b,d){b||(b=x.identity);var e=!1;return null==a?e:r&&a.some===r?a.some(b,d):(y(a,function(a,f,g){return e||(e=b.call(d,a,f,g))?c:void 0}),!!e)};x.contains=x.include=function(a,b){return null==a?!1:s&&a.indexOf===s?-1!=a.indexOf(b):A(a,function(a){return a===b})},x.invoke=function(a,b){var c=h.call(arguments,2),d=x.isFunction(b);return x.map(a,function(a){return(d?b:a[b]).apply(a,c)})},x.pluck=function(a,b){return x.map(a,x.property(b))},x.where=function(a,b){return x.filter(a,x.matches(b))},x.findWhere=function(a,b){return x.find(a,x.matches(b))},x.max=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);var d=-1/0,e=-1/0;return y(a,function(a,f,g){var h=b?b.call(c,a,f,g):a;h>e&&(d=a,e=h)}),d},x.min=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);var d=1/0,e=1/0;return y(a,function(a,f,g){var h=b?b.call(c,a,f,g):a;e>h&&(d=a,e=h)}),d},x.shuffle=function(a){var b,c=0,d=[];return y(a,function(a){b=x.random(c++),d[c-1]=d[b],d[b]=a}),d},x.sample=function(a,b,c){return null==b||c?(a.length!==+a.length&&(a=x.values(a)),a[x.random(a.length-1)]):x.shuffle(a).slice(0,Math.max(0,b))};var B=function(a){return null==a?x.identity:x.isFunction(a)?a:x.property(a)};x.sortBy=function(a,b,c){return b=B(b),x.pluck(x.map(a,function(a,d,e){return{value:a,index:d,criteria:b.call(c,a,d,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var C=function(a){return function(b,c,d){var e={};return c=B(c),y(b,function(f,g){var h=c.call(d,f,g,b);a(e,h,f)}),e}};x.groupBy=C(function(a,b,c){x.has(a,b)?a[b].push(c):a[b]=[c]}),x.indexBy=C(function(a,b,c){a[b]=c}),x.countBy=C(function(a,b){x.has(a,b)?a[b]++:a[b]=1}),x.sortedIndex=function(a,b,c,d){c=B(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},x.toArray=function(a){return a?x.isArray(a)?h.call(a):a.length===+a.length?x.map(a,x.identity):x.values(a):[]},x.size=function(a){return null==a?0:a.length===+a.length?a.length:x.keys(a).length},x.first=x.head=x.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:0>b?[]:h.call(a,0,b)},x.initial=function(a,b,c){return h.call(a,0,a.length-(null==b||c?1:b))},x.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:h.call(a,Math.max(a.length-b,0))},x.rest=x.tail=x.drop=function(a,b,c){return h.call(a,null==b||c?1:b)},x.compact=function(a){return x.filter(a,x.identity)};var D=function(a,b,c){return b&&x.every(a,x.isArray)?i.apply(c,a):(y(a,function(a){x.isArray(a)||x.isArguments(a)?b?g.apply(c,a):D(a,b,c):c.push(a)}),c)};x.flatten=function(a,b){return D(a,b,[])},x.without=function(a){return x.difference(a,h.call(arguments,1))},x.partition=function(a,b,c){b=B(b);var d=[],e=[];return y(a,function(a){(b.call(c,a)?d:e).push(a)}),[d,e]},x.uniq=x.unique=function(a,b,c,d){x.isFunction(b)&&(d=c,c=b,b=!1);var e=c?x.map(a,c,d):a,f=[],g=[];return y(e,function(c,d){(b?d&&g[g.length-1]===c:x.contains(g,c))||(g.push(c),f.push(a[d]))}),f},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(a){var b=h.call(arguments,1);return x.filter(x.uniq(a),function(a){return x.every(b,function(b){return x.contains(b,a)})})},x.difference=function(a){var b=i.apply(d,h.call(arguments,1));return x.filter(a,function(a){return!x.contains(b,a)})},x.zip=function(){for(var a=x.max(x.pluck(arguments,"length").concat(0)),b=new Array(a),c=0;a>c;c++)b[c]=x.pluck(arguments,""+c);return b},x.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},x.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=x.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(s&&a.indexOf===s)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},x.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(t&&a.lastIndexOf===t)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1},x.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);d>e;)f[e++]=a,a+=c;return f};var E=function(){};x.bind=function(a,b){var c,d;if(w&&a.bind===w)return w.apply(a,h.call(arguments,1));if(!x.isFunction(a))throw new TypeError;return c=h.call(arguments,2),d=function(){if(!(this instanceof d))return a.apply(b,c.concat(h.call(arguments)));E.prototype=a.prototype;var e=new E;E.prototype=null;var f=a.apply(e,c.concat(h.call(arguments)));return Object(f)===f?f:e}},x.partial=function(a){var b=h.call(arguments,1);return function(){for(var c=0,d=b.slice(),e=0,f=d.length;f>e;e++)d[e]===x&&(d[e]=arguments[c++]);for(;c<arguments.length;)d.push(arguments[c++]);return a.apply(this,d)}},x.bindAll=function(a){var b=h.call(arguments,1);if(0===b.length)throw new Error("bindAll must be passed function names");return y(b,function(b){a[b]=x.bind(a[b],a)}),a},x.memoize=function(a,b){var c={};return b||(b=x.identity),function(){var d=b.apply(this,arguments);return x.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},x.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},x.defer=function(a){return x.delay.apply(x,[a,1].concat(h.call(arguments,1)))},x.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:x.now(),g=null,f=a.apply(d,e),d=e=null};return function(){var j=x.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k?(clearTimeout(g),g=null,h=j,f=a.apply(d,e),d=e=null):g||c.trailing===!1||(g=setTimeout(i,k)),f}},x.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=x.now()-g;b>j?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),f=e=null))};return function(){f=this,e=arguments,g=x.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},x.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},x.wrap=function(a,b){return x.partial(b,a)},x.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},x.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},x.keys=function(a){if(!x.isObject(a))return[];if(v)return v(a);var b=[];for(var c in a)x.has(a,c)&&b.push(c);return b},x.values=function(a){for(var b=x.keys(a),c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},x.pairs=function(a){for(var b=x.keys(a),c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},x.invert=function(a){for(var b={},c=x.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},x.functions=x.methods=function(a){var b=[];for(var c in a)x.isFunction(a[c])&&b.push(c);return b.sort()},x.extend=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},x.pick=function(a){var b={},c=i.apply(d,h.call(arguments,1));return y(c,function(c){c in a&&(b[c]=a[c])}),b},x.omit=function(a){var b={},c=i.apply(d,h.call(arguments,1));for(var e in a)x.contains(c,e)||(b[e]=a[e]);return b},x.defaults=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)void 0===a[c]&&(a[c]=b[c])}),a},x.clone=function(a){return x.isObject(a)?x.isArray(a)?a.slice():x.extend({},a):a},x.tap=function(a,b){return b(a),a};var F=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof x&&(a=a._wrapped),b instanceof x&&(b=b._wrapped);var e=j.call(a);if(e!=j.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;var g=a.constructor,h=b.constructor;if(g!==h&&!(x.isFunction(g)&&g instanceof g&&x.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in b)return!1;c.push(a),d.push(b);var i=0,k=!0;if("[object Array]"==e){if(i=a.length,k=i==b.length)for(;i--&&(k=F(a[i],b[i],c,d)););}else{for(var l in a)if(x.has(a,l)&&(i++,!(k=x.has(b,l)&&F(a[l],b[l],c,d))))break;if(k){for(l in b)if(x.has(b,l)&&!i--)break;k=!i}}return c.pop(),d.pop(),k};x.isEqual=function(a,b){return F(a,b,[],[])},x.isEmpty=function(a){if(null==a)return!0;if(x.isArray(a)||x.isString(a))return 0===a.length;for(var b in a)if(x.has(a,b))return!1;return!0},x.isElement=function(a){return!(!a||1!==a.nodeType)},x.isArray=u||function(a){return"[object Array]"==j.call(a)},x.isObject=function(a){return a===Object(a)},y(["Arguments","Function","String","Number","Date","RegExp"],function(a){x["is"+a]=function(b){return j.call(b)=="[object "+a+"]"}}),x.isArguments(arguments)||(x.isArguments=function(a){return!(!a||!x.has(a,"callee"))}),"function"!=typeof/./&&(x.isFunction=function(a){return"function"==typeof a}),x.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},x.isNaN=function(a){return x.isNumber(a)&&a!=+a},x.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==j.call(a)},x.isNull=function(a){return null===a},x.isUndefined=function(a){return void 0===a},x.has=function(a,b){return k.call(a,b)},x.noConflict=function(){return a._=b,this},x.identity=function(a){return a},x.constant=function(a){return function(){return a}},x.property=function(a){return function(b){return b[a]}},x.matches=function(a){return function(b){if(b===a)return!0;for(var c in a)if(a[c]!==b[c])return!1;return!0}},x.times=function(a,b,c){for(var d=Array(Math.max(0,a)),e=0;a>e;e++)d[e]=b.call(c,e);return d},x.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},x.now=Date.now||function(){return(new Date).getTime()};var G={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};G.unescape=x.invert(G.escape);var H={escape:new RegExp("["+x.keys(G.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(G.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(a){x[a]=function(b){return null==b?"":(""+b).replace(H[a],function(b){return G[a][b]})}}),x.result=function(a,b){if(null==a)return void 0;var c=a[b];return x.isFunction(c)?c.call(a):c},x.mixin=function(a){y(x.functions(a),function(b){var c=x[b]=a[b];x.prototype[b]=function(){var a=[this._wrapped];return g.apply(a,arguments),M.call(this,c.apply(x,a))}})};var I=0;x.uniqueId=function(a){var b=++I+"";return a?a+b:b},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var J=/(.)^/,K={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(a,b,c){var d;c=x.defaults({},c,x.templateSettings);var e=new RegExp([(c.escape||J).source,(c.interpolate||J).source,(c.evaluate||J).source].join("|")+"|$","g"),f=0,g="__p+='";a.replace(e,function(b,c,d,e,h){return g+=a.slice(f,h).replace(L,function(a){return"\\"+K[a]}),c&&(g+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(g+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),e&&(g+="';\n"+e+"\n__p+='"),f=h+b.length,b}),g+="';\n",c.variable||(g="with(obj||{}){\n"+g+"}\n"),g="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";try{d=new Function(c.variable||"obj","_",g)}catch(h){throw h.source=g,h}if(b)return d(b,x);var i=function(a){return d.call(this,a,x)};return i.source="function("+(c.variable||"obj")+"){\n"+g+"}",i},x.chain=function(a){return x(a).chain()};var M=function(a){return this._chain?x(a).chain():a};x.mixin(x),y(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];x.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],M.call(this,c)}}),y(["concat","join","slice"],function(a){var b=d[a];x.prototype[a]=function(){return M.call(this,b.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return x})}.call(this),function(a,b,c){function d(c,f){if(!b[c]){if(!a[c]){var g="function"==typeof require&&require;if(!f&&g)return g(c,!0);if(e)return e(c,!0);throw new Error("Cannot find module '"+c+"'")}var h=b[c]={exports:{}};a[c][0].call(h.exports,function(b){var e=a[c][1][b];return d(e?e:b)},h,h.exports)}return b[c].exports}for(var e="function"==typeof require&&require,f=0;f<c.length;f++)d(c[f]);return d}({1:[function(a){var b=a("./lib/WAAClock");window.WAAClock=b},{"./lib/WAAClock":2}],3:[function(a,b){var c=b.exports={};c.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){if(a.source===window&&"process-tick"===a.data&&(a.stopPropagation(),c.length>0)){var b=c.shift();b()}},!0),function(a){c.push(a),window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}(),c.title="browser",c.browser=!0,c.env={},c.argv=[],c.binding=function(){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(){throw new Error("process.chdir is not supported")}},{}],4:[function(a,b,c){!function(a){function b(a,b){if(a.indexOf)return a.indexOf(b);for(var c=0;c<a.length;c++)if(b===a[c])return c;return-1}a.EventEmitter||(a.EventEmitter=function(){});var d=c.EventEmitter=a.EventEmitter,e="function"==typeof Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},f=10;d.prototype.setMaxListeners=function(a){this._events||(this._events={}),this._events.maxListeners=a},d.prototype.emit=function(a){if("error"===a&&(!this._events||!this._events.error||e(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var b=this._events[a];if(!b)return!1;if("function"==typeof b){switch(arguments.length){case 1:b.call(this);break;case 2:b.call(this,arguments[1]);break;case 3:b.call(this,arguments[1],arguments[2]);break;default:var c=Array.prototype.slice.call(arguments,1);b.apply(this,c)}return!0}if(e(b)){for(var c=Array.prototype.slice.call(arguments,1),d=b.slice(),f=0,g=d.length;g>f;f++)d[f].apply(this,c);return!0}return!1},d.prototype.addListener=function(a,b){if("function"!=typeof b)throw new Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",a,b),this._events[a])if(e(this._events[a])){if(!this._events[a].warned){var c;c=void 0!==this._events.maxListeners?this._events.maxListeners:f,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),console.trace())}this._events[a].push(b)}else this._events[a]=[this._events[a],b];else this._events[a]=b;return this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){var c=this;return c.on(a,function d(){c.removeListener(a,d),b.apply(this,arguments)}),this},d.prototype.removeListener=function(a,c){if("function"!=typeof c)throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[a])return this;var d=this._events[a];if(e(d)){var f=b(d,c);if(0>f)return this;d.splice(f,1),0==d.length&&delete this._events[a]}else this._events[a]===c&&delete this._events[a];return this},d.prototype.removeAllListeners=function(a){return 0===arguments.length?(this._events={},this):(a&&this._events&&this._events[a]&&(this._events[a]=null),this)},d.prototype.listeners=function(a){return this._events||(this._events={}),this._events[a]||(this._events[a]=[]),e(this._events[a])||(this._events[a]=[this._events[a]]),this._events[a]}}(a("__browserify_process"))},{__browserify_process:3}],5:[function(a,b,c){function d(a){return a instanceof Array||Array.isArray(a)||a&&a!==Object.prototype&&d(a.__proto__)}function e(a){return a instanceof RegExp||"object"==typeof a&&"[object RegExp]"===Object.prototype.toString.call(a)}function f(a){if(a instanceof Date)return!0;if("object"!=typeof a)return!1;var b=Date.prototype&&h(Date.prototype),c=a.__proto__&&h(a.__proto__);return JSON.stringify(c)===JSON.stringify(b)}a("events");c.isArray=d,c.isDate=function(a){return"[object Date]"===Object.prototype.toString.call(a)},c.isRegExp=function(a){return"[object RegExp]"===Object.prototype.toString.call(a)},c.print=function(){},c.puts=function(){},c.debug=function(){},c.inspect=function(a,b,i,j){function k(a,i){if(a&&"function"==typeof a.inspect&&a!==c&&(!a.constructor||a.constructor.prototype!==a))return a.inspect(i);switch(typeof a){case"undefined":return m("undefined","undefined");case"string":var j="'"+JSON.stringify(a).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return m(j,"string");case"number":return m(""+a,"number");case"boolean":return m(""+a,"boolean")}if(null===a)return m("null","null");var n=g(a),o=b?h(a):n;if("function"==typeof a&&0===o.length){if(e(a))return m(""+a,"regexp");var p=a.name?": "+a.name:"";return m("[Function"+p+"]","special")}if(f(a)&&0===o.length)return m(a.toUTCString(),"date");var q,r,s;if(d(a)?(r="Array",s=["[","]"]):(r="Object",s=["{","}"]),"function"==typeof a){var t=a.name?": "+a.name:"";q=e(a)?" "+a:" [Function"+t+"]"}else q="";if(f(a)&&(q=" "+a.toUTCString()),0===o.length)return s[0]+q+s[1];if(0>i)return e(a)?m(""+a,"regexp"):m("[Object]","special");l.push(a);var u=o.map(function(b){var c,e;if(a.__lookupGetter__&&(a.__lookupGetter__(b)?e=a.__lookupSetter__(b)?m("[Getter/Setter]","special"):m("[Getter]","special"):a.__lookupSetter__(b)&&(e=m("[Setter]","special"))),n.indexOf(b)<0&&(c="["+b+"]"),e||(l.indexOf(a[b])<0?(e=null===i?k(a[b]):k(a[b],i-1),e.indexOf("\n")>-1&&(e=d(a)?e.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+e.split("\n").map(function(a){return"   "+a}).join("\n"))):e=m("[Circular]","special")),"undefined"==typeof c){if("Array"===r&&b.match(/^\d+$/))return e;c=JSON.stringify(""+b),c.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(c=c.substr(1,c.length-2),c=m(c,"name")):(c=c.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),c=m(c,"string"))}return c+": "+e});l.pop();var v=0,w=u.reduce(function(a,b){return v++,b.indexOf("\n")>=0&&v++,a+b.length+1},0);return u=w>50?s[0]+(""===q?"":q+"\n ")+" "+u.join(",\n  ")+" "+s[1]:s[0]+q+" "+u.join(", ")+" "+s[1]}var l=[],m=function(a,b){var c={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},d={special:"cyan",number:"blue","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"}[b];return d?"["+c[d][0]+"m"+a+"["+c[d][1]+"m":a};return j||(m=function(a){return a}),k(a,"undefined"==typeof i?2:i)};c.log=function(){},c.pump=null;var g=Object.keys||function(a){var b=[];for(var c in a)b.push(c);return b},h=Object.getOwnPropertyNames||function(a){var b=[];for(var c in a)Object.hasOwnProperty.call(a,c)&&b.push(c);return b},i=Object.create||function(a,b){var c;if(null===a)c={__proto__:null};else{if("object"!=typeof a)throw new TypeError("typeof prototype["+typeof a+"] != 'object'");var d=function(){};d.prototype=a,c=new d,c.__proto__=a}return"undefined"!=typeof b&&Object.defineProperties&&Object.defineProperties(c,b),c};c.inherits=function(a,b){a.super_=b,a.prototype=i(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})};var j=/%[sdj%]/g;c.format=function(a){if("string"!=typeof a){for(var b=[],d=0;d<arguments.length;d++)b.push(c.inspect(arguments[d]));return b.join(" ")}for(var d=1,e=arguments,f=e.length,g=String(a).replace(j,function(a){if("%%"===a)return"%";if(d>=f)return a;switch(a){case"%s":return String(e[d++]);case"%d":return Number(e[d++]);case"%j":return JSON.stringify(e[d++]);default:return a}}),h=e[d];f>d;h=e[++d])g+=null===h||"object"!=typeof h?" "+h:" "+c.inspect(h);return g}},{events:4}],2:[function(a,b){var c=a("underscore"),d=a("events").EventEmitter,e=a("util").inherits;if("undefined"==typeof f)if("undefined"!=typeof webkitAudioContext)var f=webkitAudioContext;else console.error("This browser doesn't seem to support web audio API");var g=function(a,b,c){this.clock=a,this.func=c,this.repeatTime=null,this.toleranceLate=.01,this.toleranceEarly=.01,this._expireTime=null,this._earliestTime=null,this.time=b,this._update()};e(g,d),c.extend(g.prototype,{clear:function(){return this.clock._removeEvent(this),this},repeat:function(a){if(0===a)throw new Error("delay cannot be 0");return this.repeatTime=a,this},tolerance:function(a,b){return c.isNumber(a)&&(this.toleranceLate=a),c.isNumber(b)&&(this.toleranceEarly=b),this._update(),this},isRepeated:function(){return null!==this.repeatTime},_schedule:function(a){this.time=a,this._update(),this.clock.context.currentTime>=this._earliestTime&&(this.clock._removeEvent(this),this.clock._handleEvent(this))},_update:function(){this._expireTime=this.time+this.toleranceLate,this._earliestTime=this.time-this.toleranceEarly,this.clock._removeEvent(this),this.clock._insertEvent(this)}});var h={toleranceLate:.1,toleranceEarly:.001},i=b.exports=function(a,b){b=c.defaults(b||{},h),c.extend(this,c.pick(b,Object.keys(h))),this.context=a,j(a,this),this._events=[],this._start()};c.extend(i.prototype,{setTimeout:function(a,b){return this._createEvent(a,this._absTime(b)).tolerance(null,0)},callbackAtTime:function(a,b){return this._createEvent(a,b).tolerance(null,0)},timeStretch:function(a,b){var d=c.min(a,function(a){return a.time}),e=d.time,f=this._absTime(b*this._relTime(e));return a.forEach(function(a){a.isRepeated()&&a.repeat(a.repeatTime*b),a._schedule(f+b*(a.time-e))}),a},_start:function(){var a=this,b=256;this._clockNode=this.context.createScriptProcessor?this.context.createScriptProcessor(b,1,1):this.context.createJavaScriptNode(b,1,1),this._clockNode.connect(this.context.destination),this._clockNode.onaudioprocess=function(){setTimeout(function(){a._tick()},0)}},_tick:function(){for(var a=this._events.shift();a&&a._earliestTime<=this.context.currentTime;)this._handleEvent(a),a=this._events.shift();a&&this._events.unshift(a)},_handleEvent:function(a){this.context.currentTime<a._expireTime?(a.func(),a.emit("executed")):(a.emit("expired"),console.warn("event expired")),a.isRepeated()&&a._schedule(a.time+a.repeatTime)},_createEvent:function(a,b){var c=new g(this,b,a);return c.tolerance(this.toleranceLate,this.toleranceEarly),c},_insertEvent:function(a){this._events.splice(this._indexByTime(a._earliestTime),0,a)},_removeEvent:function(a){var b=this._events.indexOf(a);-1!==b&&this._events.splice(b,1)},_indexByTime:function(a){return c.sortedIndex(this._events,{_earliestTime:a},function(a){return a._earliestTime
})},_absTime:function(a){return a+this.context.currentTime},_relTime:function(a){return a-this.context.currentTime}});var j=function(a,b){return["createOscillator","createBufferSource","createMediaElementSource","createMediaStreamSource","createMediaStreamDestination","createScriptProcessor","createAnalyser","createGain","createDelay","createBiquadFilter","createWaveShaper","createPanner","createConvolver","createChannelSplitter","createChannelMerger","createDynamicsCompressor","createGainNode","createDelayNode","createJavaScriptNode"].forEach(function(c){a[c]&&(a[c]=function(){var a=f.prototype[c].apply(this,arguments);return k(a,b)})}),c.extend(a,m,{_waac:b})},k=function(a,b){var d=c.filter(c.values(a),function(a){return c.isObject(a)&&c.isFunction(a.setValueAtTime)});return d.forEach(function(a){c.extend(a,o,{_waac:b})}),["start","stop","noteOn","noteGrainOn","noteOff"].forEach(function(b){a[b]&&(a[b+"2"]=l(b))}),c.extend(a,n,{_waac:b})},l=function(a){return function(b){var d=this,e=c.toArray(arguments).slice(1),f=this._waac._createEvent(function(){d[a].apply(d,[f.time].concat(e))},b);return f}},m={_waac:null},n={_waac:null},o={setValueAtTime2:function(a,b){var c=this,d=this._waac._createEvent(function(){c.setValueAtTime(a,d.time)},b);return d},_waac:null}},{events:4,util:5,underscore:6}],6:[function(a,b,c){!function(){(function(){var a=this,d=a._,e={},f=Array.prototype,g=Object.prototype,h=Function.prototype,i=f.push,j=f.slice,k=f.concat,l=g.toString,m=g.hasOwnProperty,n=f.forEach,o=f.map,p=f.reduce,q=f.reduceRight,r=f.filter,s=f.every,t=f.some,u=f.indexOf,v=f.lastIndexOf,w=Array.isArray,x=Object.keys,y=h.bind,z=function(a){return a instanceof z?a:this instanceof z?void(this._wrapped=a):new z(a)};"undefined"!=typeof c?("undefined"!=typeof b&&b.exports&&(c=b.exports=z),c._=z):a._=z,z.VERSION="1.4.4";var A=z.each=z.forEach=function(a,b,c){if(null!=a)if(n&&a.forEach===n)a.forEach(b,c);else if(a.length===+a.length){for(var d=0,f=a.length;f>d;d++)if(b.call(c,a[d],d,a)===e)return}else for(var g in a)if(z.has(a,g)&&b.call(c,a[g],g,a)===e)return};z.map=z.collect=function(a,b,c){var d=[];return null==a?d:o&&a.map===o?a.map(b,c):(A(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)}),d)};var B="Reduce of empty array with no initial value";z.reduce=z.foldl=z.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),p&&a.reduce===p)return d&&(b=z.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(A(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(B);return c},z.reduceRight=z.foldr=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),q&&a.reduceRight===q)return d&&(b=z.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=z.keys(a);f=g.length}if(A(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)}),!e)throw new TypeError(B);return c},z.find=z.detect=function(a,b,c){var d;return C(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},z.filter=z.select=function(a,b,c){var d=[];return null==a?d:r&&a.filter===r?a.filter(b,c):(A(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)}),d)},z.reject=function(a,b,c){return z.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},z.every=z.all=function(a,b,c){b||(b=z.identity);var d=!0;return null==a?d:s&&a.every===s?a.every(b,c):(A(a,function(a,f,g){return(d=d&&b.call(c,a,f,g))?void 0:e}),!!d)};var C=z.some=z.any=function(a,b,c){b||(b=z.identity);var d=!1;return null==a?d:t&&a.some===t?a.some(b,c):(A(a,function(a,f,g){return d||(d=b.call(c,a,f,g))?e:void 0}),!!d)};z.contains=z.include=function(a,b){return null==a?!1:u&&a.indexOf===u?-1!=a.indexOf(b):C(a,function(a){return a===b})},z.invoke=function(a,b){var c=j.call(arguments,2),d=z.isFunction(b);return z.map(a,function(a){return(d?b:a[b]).apply(a,c)})},z.pluck=function(a,b){return z.map(a,function(a){return a[b]})},z.where=function(a,b,c){return z.isEmpty(b)?c?null:[]:z[c?"find":"filter"](a,function(a){for(var c in b)if(b[c]!==a[c])return!1;return!0})},z.findWhere=function(a,b){return z.where(a,b,!0)},z.max=function(a,b,c){if(!b&&z.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);if(!b&&z.isEmpty(a))return-1/0;var d={computed:-1/0,value:-1/0};return A(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>=d.computed&&(d={value:a,computed:g})}),d.value},z.min=function(a,b,c){if(!b&&z.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);if(!b&&z.isEmpty(a))return 1/0;var d={computed:1/0,value:1/0};return A(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})}),d.value},z.shuffle=function(a){var b,c=0,d=[];return A(a,function(a){b=z.random(c++),d[c-1]=d[b],d[b]=a}),d};var D=function(a){return z.isFunction(a)?a:function(b){return b[a]}};z.sortBy=function(a,b,c){var d=D(b);return z.pluck(z.map(a,function(a,b,e){return{value:a,index:b,criteria:d.call(c,a,b,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index<b.index?-1:1}),"value")};var E=function(a,b,c,d){var e={},f=D(b||z.identity);return A(a,function(b,g){var h=f.call(c,b,g,a);d(e,h,b)}),e};z.groupBy=function(a,b,c){return E(a,b,c,function(a,b,c){(z.has(a,b)?a[b]:a[b]=[]).push(c)})},z.countBy=function(a,b,c){return E(a,b,c,function(a,b){z.has(a,b)||(a[b]=0),a[b]++})},z.sortedIndex=function(a,b,c,d){c=null==c?z.identity:D(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},z.toArray=function(a){return a?z.isArray(a)?j.call(a):a.length===+a.length?z.map(a,z.identity):z.values(a):[]},z.size=function(a){return null==a?0:a.length===+a.length?a.length:z.keys(a).length},z.first=z.head=z.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:j.call(a,0,b)},z.initial=function(a,b,c){return j.call(a,0,a.length-(null==b||c?1:b))},z.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:j.call(a,Math.max(a.length-b,0))},z.rest=z.tail=z.drop=function(a,b,c){return j.call(a,null==b||c?1:b)},z.compact=function(a){return z.filter(a,z.identity)};var F=function(a,b,c){return A(a,function(a){z.isArray(a)?b?i.apply(c,a):F(a,b,c):c.push(a)}),c};z.flatten=function(a,b){return F(a,b,[])},z.without=function(a){return z.difference(a,j.call(arguments,1))},z.uniq=z.unique=function(a,b,c,d){z.isFunction(b)&&(d=c,c=b,b=!1);var e=c?z.map(a,c,d):a,f=[],g=[];return A(e,function(c,d){(b?d&&g[g.length-1]===c:z.contains(g,c))||(g.push(c),f.push(a[d]))}),f},z.union=function(){return z.uniq(k.apply(f,arguments))},z.intersection=function(a){var b=j.call(arguments,1);return z.filter(z.uniq(a),function(a){return z.every(b,function(b){return z.indexOf(b,a)>=0})})},z.difference=function(a){var b=k.apply(f,j.call(arguments,1));return z.filter(a,function(a){return!z.contains(b,a)})},z.zip=function(){for(var a=j.call(arguments),b=z.max(z.pluck(a,"length")),c=new Array(b),d=0;b>d;d++)c[d]=z.pluck(a,""+d);return c},z.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},z.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=z.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(u&&a.indexOf===u)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},z.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(v&&a.lastIndexOf===v)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1},z.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);d>e;)f[e++]=a,a+=c;return f},z.bind=function(a,b){if(a.bind===y&&y)return y.apply(a,j.call(arguments,1));var c=j.call(arguments,2);return function(){return a.apply(b,c.concat(j.call(arguments)))}},z.partial=function(a){var b=j.call(arguments,1);return function(){return a.apply(this,b.concat(j.call(arguments)))}},z.bindAll=function(a){var b=j.call(arguments,1);return 0===b.length&&(b=z.functions(a)),A(b,function(b){a[b]=z.bind(a[b],a)}),a},z.memoize=function(a,b){var c={};return b||(b=z.identity),function(){var d=b.apply(this,arguments);return z.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},z.delay=function(a,b){var c=j.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},z.defer=function(a){return z.delay.apply(z,[a,1].concat(j.call(arguments,1)))},z.throttle=function(a,b){var c,d,e,f,g=0,h=function(){g=new Date,e=null,f=a.apply(c,d)};return function(){var i=new Date,j=b-(i-g);return c=this,d=arguments,0>=j?(clearTimeout(e),e=null,g=i,f=a.apply(c,d)):e||(e=setTimeout(h,j)),f}},z.debounce=function(a,b,c){var d,e;return function(){var f=this,g=arguments,h=function(){d=null,c||(e=a.apply(f,g))},i=c&&!d;return clearTimeout(d),d=setTimeout(h,b),i&&(e=a.apply(f,g)),e}},z.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},z.wrap=function(a,b){return function(){var c=[a];return i.apply(c,arguments),b.apply(this,c)}},z.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},z.after=function(a,b){return 0>=a?b():function(){return--a<1?b.apply(this,arguments):void 0}},z.keys=x||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)z.has(a,c)&&(b[b.length]=c);return b},z.values=function(a){var b=[];for(var c in a)z.has(a,c)&&b.push(a[c]);return b},z.pairs=function(a){var b=[];for(var c in a)z.has(a,c)&&b.push([c,a[c]]);return b},z.invert=function(a){var b={};for(var c in a)z.has(a,c)&&(b[a[c]]=c);return b},z.functions=z.methods=function(a){var b=[];for(var c in a)z.isFunction(a[c])&&b.push(c);return b.sort()},z.extend=function(a){return A(j.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},z.pick=function(a){var b={},c=k.apply(f,j.call(arguments,1));return A(c,function(c){c in a&&(b[c]=a[c])}),b},z.omit=function(a){var b={},c=k.apply(f,j.call(arguments,1));for(var d in a)z.contains(c,d)||(b[d]=a[d]);return b},z.defaults=function(a){return A(j.call(arguments,1),function(b){if(b)for(var c in b)null==a[c]&&(a[c]=b[c])}),a},z.clone=function(a){return z.isObject(a)?z.isArray(a)?a.slice():z.extend({},a):a},z.tap=function(a,b){return b(a),a};var G=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof z&&(a=a._wrapped),b instanceof z&&(b=b._wrapped);var e=l.call(a);if(e!=l.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;c.push(a),d.push(b);var g=0,h=!0;if("[object Array]"==e){if(g=a.length,h=g==b.length)for(;g--&&(h=G(a[g],b[g],c,d)););}else{var i=a.constructor,j=b.constructor;if(i!==j&&!(z.isFunction(i)&&i instanceof i&&z.isFunction(j)&&j instanceof j))return!1;for(var k in a)if(z.has(a,k)&&(g++,!(h=z.has(b,k)&&G(a[k],b[k],c,d))))break;if(h){for(k in b)if(z.has(b,k)&&!g--)break;h=!g}}return c.pop(),d.pop(),h};z.isEqual=function(a,b){return G(a,b,[],[])},z.isEmpty=function(a){if(null==a)return!0;if(z.isArray(a)||z.isString(a))return 0===a.length;for(var b in a)if(z.has(a,b))return!1;return!0},z.isElement=function(a){return!(!a||1!==a.nodeType)},z.isArray=w||function(a){return"[object Array]"==l.call(a)},z.isObject=function(a){return a===Object(a)},A(["Arguments","Function","String","Number","Date","RegExp"],function(a){z["is"+a]=function(b){return l.call(b)=="[object "+a+"]"}}),z.isArguments(arguments)||(z.isArguments=function(a){return!(!a||!z.has(a,"callee"))}),"function"!=typeof/./&&(z.isFunction=function(a){return"function"==typeof a}),z.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},z.isNaN=function(a){return z.isNumber(a)&&a!=+a},z.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==l.call(a)},z.isNull=function(a){return null===a},z.isUndefined=function(a){return void 0===a},z.has=function(a,b){return m.call(a,b)},z.noConflict=function(){return a._=d,this},z.identity=function(a){return a},z.times=function(a,b,c){for(var d=Array(a),e=0;a>e;e++)d[e]=b.call(c,e);return d},z.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))};var H={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};H.unescape=z.invert(H.escape);var I={escape:new RegExp("["+z.keys(H.escape).join("")+"]","g"),unescape:new RegExp("("+z.keys(H.unescape).join("|")+")","g")};z.each(["escape","unescape"],function(a){z[a]=function(b){return null==b?"":(""+b).replace(I[a],function(b){return H[a][b]})}}),z.result=function(a,b){if(null==a)return null;var c=a[b];return z.isFunction(c)?c.call(a):c},z.mixin=function(a){A(z.functions(a),function(b){var c=z[b]=a[b];z.prototype[b]=function(){var a=[this._wrapped];return i.apply(a,arguments),N.call(this,c.apply(z,a))}})};var J=0;z.uniqueId=function(a){var b=++J+"";return a?a+b:b},z.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var K=/(.)^/,L={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},M=/\\|'|\r|\n|\t|\u2028|\u2029/g;z.template=function(a,b,c){var d;c=z.defaults({},c,z.templateSettings);var e=new RegExp([(c.escape||K).source,(c.interpolate||K).source,(c.evaluate||K).source].join("|")+"|$","g"),f=0,g="__p+='";a.replace(e,function(b,c,d,e,h){return g+=a.slice(f,h).replace(M,function(a){return"\\"+L[a]}),c&&(g+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(g+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),e&&(g+="';\n"+e+"\n__p+='"),f=h+b.length,b}),g+="';\n",c.variable||(g="with(obj||{}){\n"+g+"}\n"),g="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";try{d=new Function(c.variable||"obj","_",g)}catch(h){throw h.source=g,h}if(b)return d(b,z);var i=function(a){return d.call(this,a,z)};return i.source="function("+(c.variable||"obj")+"){\n"+g+"}",i},z.chain=function(a){return z(a).chain()};var N=function(a){return this._chain?z(a).chain():a};z.mixin(z),A(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=f[a];z.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],N.call(this,c)}}),A(["concat","join","slice"],function(a){var b=f[a];z.prototype[a]=function(){return N.call(this,b.apply(this._wrapped,arguments))}}),z.extend(z.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this)}()},{}]},{},[1]),"undefined"==typeof AudioContext&&"undefined"==typeof webkitAudioContext&&alert("Your browser doesn't seem to support Web Audio API");var QUERY={};location.search.slice(1).split("&").forEach(function(a){var b=a.split("=");QUERY[b[0]]=parseInt(b[1],10)}),!function(a){if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.PouchDB=a()}}(function(){var define,module,exports;return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(_dereq_,module,exports){"use strict";function arrayFirst(a,b){for(var c=0;c<a.length;c++)if(b(a[c],c)===!0)return a[c];return!1}function yankError(a){return function(b,c){b||c[0].error?a(b||c[0]):a(null,c[0])}}function computeHeight(a){var b={},c=[];return merge.traverseRevTree(a,function(a,d,e,f){var g=d+"-"+e;return a&&(b[g]=0),void 0!==f&&c.push({from:f,to:g}),g}),c.reverse(),c.forEach(function(a){b[a.from]=void 0===b[a.from]?1+b[a.to]:Math.min(b[a.from],1+b[a.to])}),b}function AbstractPouchDB(){var a=this;EventEmitter.call(this),a.autoCompact=function(b){return a.auto_compaction?function(c,d){if(c)b(c);else{var e=d.length,f=function(){e--,e||b(null,d)};d.forEach(function(b){b.ok?a.compactDocument(b.id,1,f):f()})}}:b};var b,c=0,d=["change","delete","create","update"];this.on("newListener",function(e){if(~d.indexOf(e)){if(c)return void c++;c++;var f=0;b=this.changes({conflicts:!0,include_docs:!0,continuous:!0,since:"latest",onChange:function(b){b.seq<=f||(f=b.seq,a.emit("change",b),b.doc._deleted?a.emit("delete",b):"1"===b.doc._rev.split("-")[0]?a.emit("create",b):a.emit("update",b))}})}}),this.on("removeListener",function(a){~d.indexOf(a)&&(c--,c||b.cancel())})}function processChange(a,b,c){var d=[{rev:a._rev}];"all_docs"===c.style&&(d=merge.collectLeaves(b.rev_tree).map(function(a){return{rev:a.rev}}));var e={id:b.id,changes:d,doc:a};return utils.isDeleted(b,a._rev)&&(e.deleted=!0),c.conflicts&&(e.doc._conflicts=merge.collectConflicts(b),e.doc._conflicts.length||delete e.doc._conflicts),e}function doChanges(api,opts,promise){var callback=opts.complete;if(opts=utils.extend(!0,{},opts),"live"in opts&&!("continuous"in opts)&&(opts.continuous=opts.live),opts.processChange=processChange,opts.since||(opts.since=0),"latest"===opts.since)return void api.info(function(a,b){return promise.isCancelled?void callback(null,{status:"cancelled"}):a?void callback(a):(opts.since=b.update_seq-1,void doChanges(api,opts,promise,callback))});if("http"!==api.type()&&opts.filter&&"string"==typeof opts.filter)if("_view"===opts.filter){if(!opts.view||"string"!=typeof opts.view){var err=errors.error(errors.BAD_REQUEST,"`view` filter parameter is not provided.");return void callback(err)}var viewName=opts.view.split("/");api.get("_design/"+viewName[0],function(err,ddoc){if(promise.isCancelled)return void callback(null,{status:"cancelled"});if(err)return void callback(err);if(ddoc&&ddoc.views&&ddoc.views[viewName[1]]){var filter=eval("(function () {  return function (doc) {    var emitted = false;    var emit = function (a, b) {      emitted = true;    };    var view = "+ddoc.views[viewName[1]].map+";    view(doc);    if (emitted) {      return true;    }  }})()");return opts.filter=filter,void doChanges(api,opts,promise,callback)}var msg=ddoc.views?"missing json key: "+viewName[1]:"missing json key: views";return err=err||errors.error(errors.MISSING_DOC,msg),void callback(err)})}else{var filterName=opts.filter.split("/");api.get("_design/"+filterName[0],function(err,ddoc){if(promise.isCancelled)return void callback(null,{status:"cancelled"});if(err)return void callback(err);if(ddoc&&ddoc.filters&&ddoc.filters[filterName[1]]){var filter=eval("(function () { return "+ddoc.filters[filterName[1]]+" })()");return opts.filter=filter,void doChanges(api,opts,promise,callback)}var msg=ddoc&&ddoc.filters?"missing json key: "+filterName[1]:"missing json key: filters";return err=err||errors.error(errors.MISSING_DOC,msg),void callback(err)})}else{"descending"in opts||(opts.descending=!1),opts.limit=0===opts.limit?1:opts.limit,opts.complete=callback;var newPromise=api._changes(opts);if(newPromise&&"function"==typeof newPromise.cancel){var cancel=promise.cancel;promise.cancel=utils.getArguments(function(a){newPromise.cancel(),cancel.apply(this,a)})}}}var utils=_dereq_("./utils"),merge=_dereq_("./merge"),errors=_dereq_("./deps/errors"),EventEmitter=_dereq_("events").EventEmitter;utils.inherits(AbstractPouchDB,EventEmitter),module.exports=AbstractPouchDB,AbstractPouchDB.prototype.post=utils.adapterFun("post",function(a,b,c){return"function"==typeof b&&(c=b,b={}),"object"!=typeof a||Array.isArray(a)?c(errors.NOT_AN_OBJECT):this.bulkDocs({docs:[a]},b,this.autoCompact(yankError(c)))}),AbstractPouchDB.prototype.put=utils.adapterFun("put",utils.getArguments(function(a){var b,c,d,e,f=a.shift(),g="_id"in f;if("object"!=typeof f||Array.isArray(f))return(e=a.pop())(errors.NOT_AN_OBJECT);for(f=utils.extend(!0,{},f);;)if(b=a.shift(),c=typeof b,"string"!==c||g?"string"!==c||!g||"_rev"in f?"object"===c?d=b:"function"===c&&(e=b):f._rev=b:(f._id=b,g=!0),!a.length)break;d=d||{};var h=utils.invalidIdError(f._id);return h?e(h):this.bulkDocs({docs:[f]},d,this.autoCompact(yankError(e)))})),AbstractPouchDB.prototype.putAttachment=utils.adapterFun("putAttachment",function(a,b,c,d,e,f){function g(a){a._attachments=a._attachments||{},a._attachments[b]={content_type:e,data:d},h.put(a,f)}var h=this;"function"==typeof e&&(f=e,e=d,d=c,c=null),"undefined"==typeof e&&(e=d,d=c,c=null),h.get(a,function(b,d){return b&&b.error===errors.MISSING_DOC.error?void g({_id:a}):b?void f(b):d._rev!==c?void f(errors.REV_CONFLICT):void g(d)})}),AbstractPouchDB.prototype.removeAttachment=utils.adapterFun("removeAttachment",function(a,b,c,d){var e=this;e.get(a,function(a,f){return a?void d(a):f._rev!==c?void d(errors.REV_CONFLICT):f._attachments?(delete f._attachments[b],0===Object.keys(f._attachments).length&&delete f._attachments,void e.put(f,d)):d()})}),AbstractPouchDB.prototype.remove=utils.adapterFun("remove",function(a,b,c){"function"==typeof b&&(c=b,b={}),void 0===b&&(b={}),b=utils.extend(!0,{},b),b.was_delete=!0;var d={_id:a._id,_rev:a._rev};return d._deleted=!0,this.bulkDocs({docs:[d]},b,yankError(c))}),AbstractPouchDB.prototype.revsDiff=utils.adapterFun("revsDiff",function(a,b,c){function d(a,b){h[a]||(h[a]={missing:[]}),h[a].missing.push(b)}function e(b,c){var e=a[b].slice(0);merge.traverseRevTree(c,function(a,c,f,g,h){var i=c+"-"+f,j=e.indexOf(i);-1!==j&&(e.splice(j,1),"available"!==h.status&&d(b,i))}),e.forEach(function(a){d(b,a)})}"function"==typeof b&&(c=b,b={}),b=utils.extend(!0,{},b);var f=Object.keys(a),g=0,h={};f.map(function(b){this._getRevisionTree(b,function(d,i){if(d&&"not_found"===d.name&&"missing"===d.message)h[b]={missing:a[b]};else{if(d)return c(d);e(b,i)}return++g===f.length?c(null,h):void 0})},this)}),AbstractPouchDB.prototype.compactDocument=function(a,b,c){var d=this;this._getRevisionTree(a,function(e,f){if(e)return c(e);var g=computeHeight(f),h=[],i=[];Object.keys(g).forEach(function(a){g[a]>b&&h.push(a)}),merge.traverseRevTree(f,function(a,b,c,d,e){var f=b+"-"+c;"available"===e.status&&-1!==h.indexOf(f)&&(e.status="missing",i.push(f))}),d._doCompaction(a,f,i,c)})},AbstractPouchDB.prototype.compact=utils.adapterFun("compact",function(a,b){"function"==typeof a&&(b=a,a={});var c=this;this.changes({complete:function(a,d){if(a)return void b();var e=d.results.length;return e?void d.results.forEach(function(a){c.compactDocument(a.id,0,function(){e--,e||b()})}):void b()}})}),AbstractPouchDB.prototype.get=utils.adapterFun("get",function(a,b,c){function d(){var d=[],g=e.length;return g?void e.forEach(function(e){f.get(a,{rev:e,revs:b.revs,attachments:b.attachments},function(a,b){d.push(a?{missing:e}:{ok:b}),g--,g||c(null,d)})}):c(null,d)}if("function"==typeof b&&(c=b,b={}),"string"!=typeof a)return c(errors.INVALID_ID);var e=[],f=this;if(!b.open_revs)return this._get(a,b,function(a,d){if(b=utils.extend(!0,{},b),a)return c(a);var e=d.doc,g=d.metadata,h=d.ctx;if(b.conflicts){var i=merge.collectConflicts(g);i.length&&(e._conflicts=i)}if(b.revs||b.revs_info){var j=merge.rootToLeaf(g.rev_tree),k=arrayFirst(j,function(a){return-1!==a.ids.map(function(a){return a.id}).indexOf(e._rev.split("-")[1])});if(k.ids.splice(k.ids.map(function(a){return a.id}).indexOf(e._rev.split("-")[1])+1),k.ids.reverse(),b.revs&&(e._revisions={start:k.pos+k.ids.length-1,ids:k.ids.map(function(a){return a.id})}),b.revs_info){var l=k.pos+k.ids.length;e._revs_info=k.ids.map(function(a){return l--,{rev:l+"-"+a.id,status:a.opts.status}})}}if(b.local_seq&&(e._local_seq=d.metadata.seq),b.attachments&&e._attachments){var m=e._attachments,n=Object.keys(m).length;if(0===n)return c(null,e);Object.keys(m).forEach(function(a){this._getAttachment(m[a],{encode:!0,ctx:h},function(b,d){e._attachments[a].data=d,--n||c(null,e)})},f)}else{if(e._attachments)for(var o in e._attachments)e._attachments.hasOwnProperty(o)&&(e._attachments[o].stub=!0);c(null,e)}});if("all"===b.open_revs)this._getRevisionTree(a,function(a,b){a&&(b=[]),e=merge.collectLeaves(b).map(function(a){return a.rev}),d()});else{if(!Array.isArray(b.open_revs))return c(errors.error(errors.UNKNOWN_ERROR,"function_clause"));e=b.open_revs;for(var g=0;g<e.length;g++){var h=e[g];if("string"!=typeof h||!/^\d+-/.test(h))return c(errors.error(errors.BAD_REQUEST,"Invalid rev format"))}d()}}),AbstractPouchDB.prototype.getAttachment=utils.adapterFun("getAttachment",function(a,b,c,d){var e=this;c instanceof Function&&(d=c,c={}),c=utils.extend(!0,{},c),this._get(a,c,function(a,f){return a?d(a):f.doc._attachments&&f.doc._attachments[b]?(c.ctx=f.ctx,void e._getAttachment(f.doc._attachments[b],c,d)):d(errors.MISSING_DOC)})}),AbstractPouchDB.prototype.allDocs=utils.adapterFun("allDocs",function(a,b){if("function"==typeof a&&(b=a,a={}),a=utils.extend(!0,{},a),"keys"in a){var c=["startkey","endkey","key"].filter(function(b){return b in a})[0];if(c)return void b(errors.error(errors.QUERY_PARSE_ERROR,"Query parameter `"+c+"` is not compatible with multi-get"))}return"undefined"==typeof a.skip&&(a.skip=0),this._allDocs(a,b)}),AbstractPouchDB.prototype.changes=function(a){return utils.cancellableFun(doChanges,this,a)},AbstractPouchDB.prototype.close=utils.adapterFun("close",function(a){return this._close(a)}),AbstractPouchDB.prototype.info=utils.adapterFun("info",function(a){var b=this;this._info(function(c,d){if(c)return a(c);var e=b.prefix.length;d.db_name.length>e&&d.db_name.slice(0,e)===b.prefix&&(d.db_name=d.db_name.slice(e)),a(null,d)})}),AbstractPouchDB.prototype.id=utils.adapterFun("id",function(a){return this._id(a)}),AbstractPouchDB.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},AbstractPouchDB.prototype.bulkDocs=utils.adapterFun("bulkDocs",function(a,b,c){if("function"==typeof b&&(c=b,b={}),b=b?utils.extend(!0,{},b):{},!a||!a.docs)return c(errors.MISSING_BULK_DOCS);if(!Array.isArray(a.docs))return c(errors.QUERY_PARSE_ERROR);for(var d=0;d<a.docs.length;++d)if("object"!=typeof a.docs[d]||Array.isArray(a.docs[d]))return c(errors.NOT_AN_OBJECT);return a=utils.extend(!0,{},a),"new_edits"in b||(b.new_edits="new_edits"in a?a.new_edits:!0),this._bulkDocs(a,b,this.autoCompact(c))})},{"./deps/errors":8,"./merge":14,"./utils":18,events:22}],2:[function(a,b){"use strict";function c(a){for(var b=c.options,d=b.parser[b.strictMode?"strict":"loose"].exec(a),e={},f=14;f--;)e[b.key[f]]=d[f]||"";return e[b.q.name]={},e[b.key[12]].replace(b.q.parser,function(a,c,d){c&&(e[b.q.name][c]=d)}),e}function d(a){return/^_(design|local)/.test(a)?a:encodeURIComponent(a)}function e(a,b){if(/http(s?):/.test(a)){var d=c(a);d.remote=!0,(d.user||d.password)&&(d.auth={username:d.user,password:d.password});var e=d.path.replace(/(^\/|\/$)/g,"").split("/");if(d.db=e.pop(),d.path=e.join("/"),b=b||{},b=i.extend(!0,{},b),d.headers=b.headers||{},b.auth||d.auth){var f=b.auth||d.auth,g=i.btoa(f.username+":"+f.password);d.headers.Authorization="Basic "+g}return b.headers&&(d.headers=b.headers),d}return{host:"",path:"/",db:a,auth:!1}}function f(a,b){return g(a,a.db+"/"+b)}function g(a,b){if(a.remote){var c=a.path?"/":"";return a.protocol+"://"+a.host+":"+a.port+"/"+a.path+c+b}return"/"+b}function h(a,b){function c(a,b){return i.ajax(i.extend({},n,a),b)}function h(a,d,e,f){d=i.extend(!0,{},d);var h=k.getHost(f),j={source:l.db,target:h.protocol===l.protocol&&h.authority===l.authority?h.db:h.source};d.continuous&&(j.continuous=!0),d.create_target&&(j.create_target=!0),d.doc_ids&&(j.doc_ids=d.doc_ids),d.filter&&"string"==typeof d.filter&&(j.filter=d.filter),d.query_params&&(j.query_params=d.query_params);var m,n={},o={headers:l.headers,method:"POST",url:g(l,"_replicate"),body:j};e.cancel=function(){this.cancelled=!0,m&&!n.ok&&m.abort(),n._local_id&&(o.body={replication_id:n._local_id}),o.body.cancel=!0,c(o,function(a,c,e){return a?b(a):void i.call(d.complete,null,n,e)})},e.cancelled||(m=c(o,function(a,c,e){return a?b(a):(n.ok=!0,c._local_id&&(n._local_id=c._local_id),void i.call(d.complete,null,c,e))}))}var k=this;k.getHost=a.getHost?a.getHost:e;var l=k.getHost(a.name,a),m=f(l,"");k.getUrl=function(){return m};var n=a.ajax||{};a=i.extend(!0,{},a);var o={list:[],get:function(a,b){"function"==typeof a&&(b=a,a={count:10});var d=function(a,c){!a&&"uuids"in c?(o.list=o.list.concat(c.uuids),b(null,"OK")):b(a||j.UNKNOWN_ERROR)},e="?count="+a.count;c({headers:l.headers,method:"GET",url:g(l,"_uuids")+e},d)}},p=function(){c({headers:l.headers,method:"PUT",url:m},function(a){a&&401===a.status?c({headers:l.headers,method:"HEAD",url:m},function(a){a?b(a):b(null,k)}):a&&412!==a.status?b(a):b(null,k)})};a.skipSetup||c({headers:l.headers,method:"GET",url:m},function(a){a?404===a.status?p():b(a):b(null,k)}),k.type=function(){return"http"},k.id=i.adapterFun("id",function(a){c({headers:l.headers,method:"GET",url:g(l,"")},function(b,c){if(b)a(b);else{var d=c&&c.uuid?c.uuid+l.db:f(l,"");a(null,d)}})}),k.request=i.adapterFun("request",function(a,b){a.headers=l.headers,a.url=f(l,a.url),c(a,b)}),k.compact=i.adapterFun("compact",function(a,b){"function"==typeof a&&(b=a,a={}),a=i.extend(!0,{},a),c({headers:l.headers,url:f(l,"_compact"),method:"POST"},function(){function c(){k.info(function(d,e){e.compact_running?setTimeout(c,a.interval||200):b()})}"function"==typeof b&&c()})}),k._info=function(a){c({headers:l.headers,method:"GET",url:f(l,"")},function(b,c){b?a(b):(c.host=f(l,""),a(null,c))})},k.get=i.adapterFun("get",function(a,b,e){"function"==typeof b&&(e=b,b={}),b=i.extend(!0,{},b),void 0===b.auto_encode&&(b.auto_encode=!0);var g=[];b.revs&&g.push("revs=true"),b.revs_info&&g.push("revs_info=true"),b.local_seq&&g.push("local_seq=true"),b.open_revs&&("all"!==b.open_revs&&(b.open_revs=JSON.stringify(b.open_revs)),g.push("open_revs="+b.open_revs)),b.attachments&&g.push("attachments=true"),b.rev&&g.push("rev="+b.rev),b.conflicts&&g.push("conflicts="+b.conflicts),g=g.join("&"),g=""===g?"":"?"+g,b.auto_encode&&(a=d(a));var h={headers:l.headers,method:"GET",url:f(l,a+g)},j=a.split("/");(j.length>1&&"_design"!==j[0]&&"_local"!==j[0]||j.length>2&&"_design"===j[0]&&"_local"!==j[0])&&(h.binary=!0),c(h,function(a,b,c){return a?e(a):void e(null,b,c)})}),k.remove=i.adapterFun("remove",function(a,b,e){"function"==typeof b&&(e=b,b={}),c({headers:l.headers,method:"DELETE",url:f(l,d(a._id))+"?rev="+a._rev},e)}),k.getAttachment=i.adapterFun("getAttachment",function(a,b,c,e){"function"==typeof c&&(e=c,c={}),c=i.extend(!0,{},c),void 0===c.auto_encode&&(c.auto_encode=!0),c.auto_encode&&(a=d(a)),c.auto_encode=!1,k.get(a+"/"+b,c,e)}),k.removeAttachment=i.adapterFun("removeAttachment",function(a,b,e,g){c({headers:l.headers,method:"DELETE",url:f(l,d(a)+"/"+b)+"?rev="+e},g)}),k.putAttachment=i.adapterFun("putAttachment",function(a,b,e,g,h,i){"function"==typeof h&&(i=h,h=g,g=e,e=null),"undefined"==typeof h&&(h=g,g=e,e=null);var j=d(a)+"/"+b,k=f(l,j);e&&(k+="?rev="+e);var m={headers:l.headers,method:"PUT",url:k,processData:!1,body:g,timeout:6e4};m.headers["Content-Type"]=h,c(m,i)}),k.put=i.adapterFun("put",i.getArguments(function(a){var b,e,g,h,k=a.shift(),m="_id"in k;if("object"!=typeof k||Array.isArray(k))return(h=a.pop())(j.NOT_AN_OBJECT);for(k=i.extend(!0,{},k);;)if(b=a.shift(),e=typeof b,"string"!==e||m?"string"!==e||!m||"_rev"in k?"object"===e?g=i.extend(!0,{},b):"function"===e&&(h=b):k._rev=b:(k._id=b,m=!0),!a.length)break;g=g||{};var n=i.invalidIdError(k._id);if(n)return h(n);var o=[];g&&"undefined"!=typeof g.new_edits&&o.push("new_edits="+g.new_edits),o=o.join("&"),""!==o&&(o="?"+o),c({headers:l.headers,method:"PUT",url:f(l,d(k._id))+o,body:k},h)})),k.post=i.adapterFun("post",function(a,b,c){return"function"==typeof b&&(c=b,b={}),b=i.extend(!0,{},b),"object"!=typeof a?c(j.NOT_AN_OBJECT):void("_id"in a?k.put(a,b,c):o.list.length>0?(a._id=o.list.pop(),k.put(a,b,c)):o.get(function(d){return d?c(j.UNKNOWN_ERROR):(a._id=o.list.pop(),void k.put(a,b,c))
}))}),k.bulkDocs=i.adapterFun("bulkDocs",function(a,b,d){if("function"==typeof b&&(d=b,b={}),b||(b={}),!Array.isArray(a.docs))return d(j.error(j.NOT_AN_OBJECT,"Missing JSON list of 'docs'"));var e=a.docs.filter(function(a){return"object"!=typeof a||Array.isArray(a)});return e.length?d(j.NOT_AN_OBJECT):(a=i.extend(!0,{},a),b=i.extend(!0,{},b),"undefined"!=typeof b.new_edits&&(a.new_edits=b.new_edits),void c({headers:l.headers,method:"POST",url:f(l,"_bulk_docs"),body:a},d))}),k.allDocs=i.adapterFun("allDocs",function(a,b){"function"==typeof a&&(b=a,a={}),a=i.extend(!0,{},a);var d,e=[],g="GET";if(a.conflicts&&e.push("conflicts=true"),a.descending&&e.push("descending=true"),a.include_docs&&e.push("include_docs=true"),a.key&&e.push("key="+encodeURIComponent(JSON.stringify(a.key))),a.startkey&&e.push("startkey="+encodeURIComponent(JSON.stringify(a.startkey))),a.endkey&&e.push("endkey="+encodeURIComponent(JSON.stringify(a.endkey))),"undefined"!=typeof a.limit&&e.push("limit="+a.limit),"undefined"!=typeof a.skip&&e.push("skip="+a.skip),e=e.join("&"),""!==e&&(e="?"+e),"undefined"!=typeof a.keys){var h=2e3,j="keys="+encodeURIComponent(JSON.stringify(a.keys));j.length+e.length+1<=h?e+=(-1!==e.indexOf("?")?"&":"?")+j:(g="POST",d=JSON.stringify({keys:a.keys}))}c({headers:l.headers,method:g,url:f(l,"_all_docs"+e),body:d},b)}),k._changes=function(a){var b=25;a=i.extend(!0,{},a),a.timeout=a.timeout||0;var d={timeout:2e4},e="undefined"!=typeof a.limit?a.limit:!1;0===e&&(e=1);var g=e;if(a.style&&(d.style=a.style),(a.include_docs||a.filter&&"function"==typeof a.filter)&&(d.include_docs=!0),a.continuous&&(d.feed="longpoll"),a.conflicts&&(d.conflicts=!0),a.descending&&(d.descending=!0),a.filter&&"string"==typeof a.filter&&(d.filter=a.filter,"_view"===a.filter&&a.view&&"string"==typeof a.view&&(d.view=a.view)),a.query_params&&"object"==typeof a.query_params)for(var h in a.query_params)a.query_params.hasOwnProperty(h)&&(d[h]=a.query_params[h]);var k,m,n=function(h,i){if(!a.aborted){d.since=h,a.descending?e&&(d.limit=g):d.limit=!e||g>b?b:g;var j="?"+Object.keys(d).map(function(a){return a+"="+d[a]}).join("&"),n={headers:l.headers,method:"GET",url:f(l,"_changes"+j),timeout:a.timeout};m=h,a.aborted||(k=c(n,i))}},o=10,p=0,q={results:[]},r=function(c,d){if(!a.aborted){var f=0;if(d&&d.results){f=d.results.length,q.last_seq=d.last_seq;var h={};h.query=a.query_params,d.results=d.results.filter(function(b){g--;var c=i.filterChange(a)(b);return c&&(q.results.push(b),i.call(a.onChange,b)),c})}else if(c)return a.aborted=!0,void i.call(a.complete,c);d&&d.last_seq&&(m=d.last_seq);var k=e&&0>=g||d&&b>f||a.descending;if(a.continuous||!k){c?p+=1:p=0;var l=1<<p,s=o*l,t=a.maximumWait||3e4;if(s>t)return void i.call(a.complete,c||j.UNKNOWN_ERROR);setTimeout(function(){n(m,r)},s)}else i.call(a.complete,null,q)}};return n(a.since||0,r),{cancel:function(){a.aborted=!0,k.abort()}}},k.revsDiff=i.adapterFun("revsDif",function(a,b,d){"function"==typeof b&&(d=b,b={}),c({headers:l.headers,method:"POST",url:f(l,"_revs_diff"),body:a},function(a,b){d(a,b)})}),k.close=i.adapterFun("close",function(a){a()}),k.replicateOnServer=function(a,b,c){return k.taskqueue.isReady?void a.info(function(d,e){h(a,b,c,e.host)}):(k.taskqueue.addTask("replicateOnServer",[a,b,c]),c)},k.destroy=i.adapterFun("destroy",function(a){c({url:f(l,""),method:"DELETE",headers:l.headers},function(b,c){b?(k.emit("error",b),a(b)):(k.emit("destroyed"),a(null,c))})})}var i=a("../utils"),j=a("../deps/errors");c.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},h.destroy=i.toPromise(function(a,b,c){var d=e(a,b);b=b||{},"function"==typeof b&&(c=b,b={}),b=i.extend(!0,{},b),b.headers=d.headers,b.method="DELETE",b.url=f(d,"");var g=b.ajax||{};b=i.extend({},b,g),i.ajax(b,c)}),h.valid=function(){return!0},b.exports=h},{"../deps/errors":8,"../utils":18}],3:[function(a,b){(function(c){"use strict";function d(a){return function(b){a(i.error(i.IDB_ERROR,b.target,b.type))}}function e(){var a="_pouch__checkModernIdb_"+(c.navigator&&c.navigator.appVersion),b=g.hasLocalStorage()&&c.localStorage[a];if(b)return JSON.parse(b);var d="_pouch__checkModernIdb",e=null===c.indexedDB.open(d,1).onupgradeneeded;return c.indexedDB.deleteDatabase&&c.indexedDB.deleteDatabase(d),g.hasLocalStorage()&&(c.localStorage[a]=JSON.stringify(e)),e}function f(a,b){function e(a){a.createObjectStore(o,{keyPath:"id"}).createIndex("seq","seq",{unique:!0}),a.createObjectStore(p,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),a.createObjectStore(q,{keyPath:"digest"}),a.createObjectStore(r,{keyPath:"id",autoIncrement:!1}),a.createObjectStore(s)}function j(a){var b=a.currentTarget.transaction.objectStore(o);b.openCursor().onsuccess=function(a){var c=a.target.result;if(c){var d=c.value,e=g.isDeleted(d),f=g.isLocalId(d.id);d.deletedOrLocal=e||f?"1":"0",b.put(d),c["continue"]()}else b.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1})}}function k(a,b){return a._bulk_seq-b._bulk_seq}function l(a,b,c){var d=b.keys,e="descending"in b?b.descending:!1;if(d.length){var f=[];d.forEach(function(h){var i=g.extend(!0,{},b);i.keys_request=!0,i.key=h,delete i.keys,delete i.skip,delete i.limit,m(a,i,function(g,i){if(f.push({err:g,res:i,key:h}),f.length===d.length){for(var j={},k=0;k<f.length;k++){var l=f[k];if(l.err)return void c(g);j[l.key]=l}var m=[];d.forEach(function(a){var b=j[a];m.push(b.res.rows.length?b.res.rows[0]:{key:a,error:"not_found"})}),e&&(m=m.reverse()),c(null,{total_rows:a,offset:b.skip,rows:"limit"in b?m.slice(b.skip,b.limit+b.skip):b.skip>0?m.slice(b.skip):m})}})})}else c(null,{offset:b.skip,rows:[],total_rows:a})}function m(a,b,d){var e="startkey"in b?b.startkey:!1,f="endkey"in b?b.endkey:!1,j="key"in b?b.key:!1,k=b.skip||0,l="number"==typeof b.limit?b.limit:-1,m="descending"in b&&b.descending?"prev":null,n=!1;m&&e&&f&&(n=f,f=!1);var q;try{q=e&&f?c.IDBKeyRange.bound(e,f):e?m?c.IDBKeyRange.upperBound(e):c.IDBKeyRange.lowerBound(e):f?m?c.IDBKeyRange.lowerBound(f):c.IDBKeyRange.upperBound(f):j?c.IDBKeyRange.only(j):null}catch(r){return"DataError"===r.name&&0===r.code?d(null,{total_rows:a,offset:b.skip,rows:[]}):d(i.error(i.IDB_ERROR,r.name,r.message))}var s=y.transaction([o,p],"readonly");s.oncomplete=function(){d(null,{total_rows:a,offset:b.skip,rows:v})};var t=s.objectStore(o),u=m?t.openCursor(q,m):t.openCursor(q),v=[];u.onsuccess=function(a){function c(a,c){if(g.isLocalId(a.id))return d["continue"]();var e={id:a.id,key:a.id,value:{rev:h.winningRev(a)}};if(b.include_docs){e.doc=c,e.doc._rev=h.winningRev(a),e.doc._doc_id_rev&&delete e.doc._doc_id_rev,b.conflicts&&(e.doc._conflicts=h.collectConflicts(a));for(var f in e.doc._attachments)e.doc._attachments.hasOwnProperty(f)&&(e.doc._attachments[f].stub=!0)}if(b.keys_request)g.isDeleted(a)&&(e.value.deleted=!0,e.doc=null),v.push(e);else if(!g.isDeleted(a)&&k--<=0){if(n&&e.key<n)return;if(v.push(e),0===--l)return}d["continue"]()}if(a.target.result){var d=a.target.result,e=d.value;if(b.include_docs){var f=s.objectStore(p).index("_doc_id_rev"),i=h.winningRev(e),j=e.id+"::"+i;f.get(j).onsuccess=function(a){c(d.value,a.target.result)}}else c(e)}}}var n=2,o="document-store",p="by-sequence",q="attach-store",r="meta-store",s="detect-blob-support",t=a.name,u=c.indexedDB.open(t,n);"openReqList"in f||(f.openReqList={}),f.openReqList[t]=u;var v=null,w=null,x=this,y=null;u.onupgradeneeded=function(a){var b=a.target.result;a.oldVersion<1&&e(b),a.oldVersion<2&&j(a)},u.onsuccess=function(a){y=a.target.result,y.onversionchange=function(){y.close()};var c=y.transaction([r,s],"readwrite"),d=c.objectStore(r).get(r);d.onsuccess=function(a){var d=!1,e=function(){null!==v&&d&&b(null,x)},f=a.target.result||{id:r};t+"_id"in f?(w=f[t+"_id"],d=!0,e()):(w=g.uuid(),f[t+"_id"]=w,c.objectStore(r).put(f).onsuccess=function(){d=!0,e()});try{c.objectStore(s).put(g.createBlob(),"key"),v=!0}catch(h){v=!1}finally{e()}}},u.onerror=d(b),x.type=function(){return"idb"},x._id=g.toPromise(function(a){a(null,w)}),x._bulkDocs=function(a,b,c){function e(a){var b=a.target.result;b.updateSeq=(b.updateSeq||0)+G,E.objectStore(r).put(b)}function j(){if(!C.length)return void(E.objectStore(r).get(r).onsuccess=e);var a=C.shift(),b=E.objectStore(o).get(a.metadata.id);b.onsuccess=function(b){var c=b.target.result;c?u(c,a):w(a)}}function l(){var a=[];F.sort(k),F.forEach(function(b){if(delete b._bulk_seq,b.error)return void a.push(b);var c=b.metadata,d=h.winningRev(c);a.push({ok:!0,id:c.id,rev:d}),g.isLocalId(c.id)||(f.Changes.notify(t),f.Changes.notifyLocalWindows(t))}),c(null,a)}function m(a,b){if(a.stub)return b();if("string"==typeof a.data){var d;try{d=atob(a.data)}catch(e){var f=i.error(i.BAD_ARG,"Attachments need to be base64 encoded");return c(f)}if(a.digest="md5-"+g.Crypto.MD5(d),v){var h=a.content_type;d=g.fixBinary(d),a.data=g.createBlob([d],{type:h})}return b()}var j=new FileReader;j.onloadend=function(){var c=g.arrayBufferToBinaryString(this.result);a.digest="md5-"+g.Crypto.MD5(c),v||(a.data=btoa(c)),b()},j.readAsArrayBuffer(a.data)}function n(a){function b(){c++,C.length===c&&a()}if(!C.length)return a();var c=0;C.forEach(function(a){function c(){e++,e===d.length&&b()}var d=a.data&&a.data._attachments?Object.keys(a.data._attachments):[];if(!d.length)return b();var e=0;for(var f in a.data._attachments)a.data._attachments.hasOwnProperty(f)&&m(a.data._attachments[f],c)})}function s(a,b){function c(a){f||(a?(f=a,b(f)):h===i.length&&e())}function d(a){h++,c(a)}function e(){a.data._doc_id_rev=a.data._id+"::"+a.data._rev;var c=E.objectStore(p).index("_doc_id_rev");c.getKey(a.data._doc_id_rev).onsuccess=function(c){var d=c.target.result?E.objectStore(p).put(a.data,c.target.result):E.objectStore(p).put(a.data);d.onsuccess=function(c){a.metadata.seq=c.target.result,delete a.metadata.rev;var d=g.isDeleted(a.metadata),e=g.isLocalId(a.metadata.id),f=g.extend(!0,{deletedOrLocal:d||e?"1":"0"},a.metadata),h=E.objectStore(o).put(f);h.onsuccess=function(){F.push(a),g.call(b)}}}}var f=null,h=0;a.data._id=a.metadata.id,a.data._rev=a.metadata.rev,G++,g.isDeleted(a.metadata,a.metadata.rev)&&(a.data._deleted=!0);var i=a.data._attachments?Object.keys(a.data._attachments):[];for(var j in a.data._attachments)if(a.data._attachments[j].stub)h++,c();else{var k=a.data._attachments[j].data;delete a.data._attachments[j].data;var l=a.data._attachments[j].digest;z(a,l,k,d)}i.length||e()}function u(a,b){var c=h.merge(a.rev_tree,b.metadata.rev_tree[0],1e3),d=g.isDeleted(a),e=d&&g.isDeleted(b.metadata)||!d&&A&&"new_leaf"!==c.conflicts;return e?(F.push(x(i.REV_CONFLICT,b._bulk_seq)),j()):(b.metadata.rev_tree=c.tree,void s(b,j))}function w(a){return"was_delete"in b&&g.isDeleted(a.metadata)?(F.push(i.MISSING_DOC),j()):void s(a,j)}function x(a,b){return a._bulk_seq=b,a}function z(a,b,c,d){var e=E.objectStore(q);e.get(b).onsuccess=function(f){var h=f.target.result&&f.target.result.refs||{},i=[a.metadata.id,a.metadata.rev].join("@"),j={digest:b,body:c,refs:h};j.refs[i]=!0,e.put(j).onsuccess=function(){g.call(d)}}}var A=b.new_edits,B=a.docs,C=B.map(function(a,b){var c=g.parseDoc(a,A);return c._bulk_seq=b,c}),D=C.filter(function(a){return a.error});if(D.length)return c(D[0]);var E,F=[],G=0;n(function(){E=y.transaction([o,p,q,r],"readwrite"),E.onerror=d(c),E.ontimeout=d(c),E.oncomplete=l,j()})},x._get=function(a,b,c){function d(){c(j,{doc:e,metadata:f,ctx:k})}var e,f,j,k;b=g.extend(!0,{},b),k=b.ctx?b.ctx:y.transaction([o,p,q],"readonly"),k.objectStore(o).get(a).onsuccess=function(a){if(f=a.target.result,!f)return j=i.MISSING_DOC,d();if(g.isDeleted(f)&&!b.rev)return j=i.error(i.MISSING_DOC,"deleted"),d();var c=h.winningRev(f),l=f.id+"::"+(b.rev?b.rev:c),m=k.objectStore(p).index("_doc_id_rev");m.get(l).onsuccess=function(a){return e=a.target.result,e&&e._doc_id_rev&&delete e._doc_id_rev,e?void d():(j=i.MISSING_DOC,d())}}},x._getAttachment=function(a,b,c){var d,e;b=g.extend(!0,{},b),e=b.ctx?b.ctx:y.transaction([o,p,q],"readonly");var f=a.digest,h=a.content_type;e.objectStore(q).get(f).onsuccess=function(a){var e=a.target.result.body;if(b.encode)if(v){var f=new FileReader;f.onloadend=function(){var a=g.arrayBufferToBinaryString(this.result);d=btoa(a),c(null,d)},f.readAsArrayBuffer(e)}else d=e,c(null,d);else v?d=e:(e=g.fixBinary(atob(e)),d=g.createBlob([e],{type:h})),c(null,d)}},x._allDocs=function(a,b){function e(a){f=a.target.result}var f,g=y.transaction([o],"readonly"),h=g.objectStore(o).index("deletedOrLocal");h.count(c.IDBKeyRange.only("0")).onsuccess=e,g.onerror=d(b),g.oncomplete=function(){return 0===a.limit?b(null,{total_rows:f,offset:a.skip,rows:[]}):void("keys"in a?l(f,a,b):m(f,a,b))}},x._info=function(a){function b(a){e=a.target.result&&a.target.result.updateSeq||0}function c(a){var c=a.target.result;return c?(c.value.deleted!==!0&&d++,void c["continue"]()):void(f.objectStore(r).get(r).onsuccess=b)}var d=0,e=0,f=y.transaction([o,r],"readonly");f.oncomplete=function(){a(null,{db_name:t,doc_count:d,update_seq:e})},f.objectStore(o).openCursor().onsuccess=c},x._changes=function(a){function b(){l=y.transaction([o,p]),l.oncomplete=e;var b;b=j?l.objectStore(p).openCursor(c.IDBKeyRange.lowerBound(a.since,!0),j):l.objectStore(p).openCursor(c.IDBKeyRange.lowerBound(a.since,!0)),b.onsuccess=d,b.onerror=onerror}function d(b){if(!b.target.result){for(var c=0,d=m.length;d>c;c++){var e=m[c];e&&q.push(e)}return!1}var f=b.target.result,i=f.value._id,j=n[i];if(void 0!==j)return m[j].seq=f.key,m.push(m[j]),m[j]=null,n[i]=m.length-1,f["continue"]();var r=l.objectStore(o);r.get(f.value._id).onsuccess=function(b){var c=b.target.result;if(g.isLocalId(c.id))return f["continue"]();k<c.seq&&(k=c.seq);var d=h.winningRev(c),e=c.id+"::"+d,i=l.objectStore(p).index("_doc_id_rev");i.get(e).onsuccess=function(b){var e=b.target.result;delete e._doc_id_rev,e._rev=d;var g=a.processChange(e,c,a);g.seq=f.key;var h=g.id,i=n[h];void 0!==i&&(m[i]=null),m.push(g),n[h]=m.length-1,f["continue"]()}}}function e(){g.processChanges(a,q,k)}if(a=g.extend(!0,{},a),a.continuous){var i=t+":"+g.uuid();return f.Changes.addListener(t,i,x,a),f.Changes.notify(t),{cancel:function(){f.Changes.removeListener(t,i)}}}var j=a.descending?"prev":null,k=0;a.since=a.since&&!j?a.since:0;var l,m=[],n={},q=[];b()},x._close=function(a){return null===y?a(i.NOT_OPEN):(y.close(),void a())},x._getRevisionTree=function(a,b){var c=y.transaction([o],"readonly"),d=c.objectStore(o).get(a);d.onsuccess=function(a){var c=a.target.result;c?b(null,c.rev_tree):b(i.MISSING_DOC)}},x._doCompaction=function(a,b,c,d){var e=y.transaction([o,p],"readwrite"),f=e.objectStore(o);f.get(a).onsuccess=function(d){var f=d.target.result;f.rev_tree=b;var h=c.length;c.forEach(function(b){var c=e.objectStore(p).index("_doc_id_rev"),d=a+"::"+b;c.getKey(d).onsuccess=function(a){var b=a.target.result;if(b&&(e.objectStore(p)["delete"](b),h--,!h)){if(f){var c=g.isDeleted(f),d=g.isLocalId(f.id);f=g.extend(!0,{deletedOrLocal:c||d?"1":"0"},f)}e.objectStore(o).put(f)}}})},e.oncomplete=function(){g.call(d)}}}var g=a("../utils"),h=a("../merge"),i=a("../deps/errors");f.valid=function(){return c.indexedDB&&e()},f.destroy=g.toPromise(function(a,b,e){"openReqList"in f||(f.openReqList={}),f.Changes.clearListeners(a),f.openReqList[a]&&f.openReqList[a].result&&f.openReqList[a].result.close();var g=c.indexedDB.deleteDatabase(a);g.onsuccess=function(){f.openReqList[a]&&(f.openReqList[a]=null),e()},g.onerror=d(e)}),f.Changes=new g.Changes,b.exports=f}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../deps/errors":8,"../merge":14,"../utils":18}],4:[function(a,b){(function(c){"use strict";function d(a){return"'"+a+"'"}function e(a){return function(b){var c=b&&b.constructor.toString().match(/function ([^\(]+)/),d=c&&c[1]||b.type,e=b.target||b.message;a(k.error(k.WSQ_ERROR,e,d))}}function f(a){return decodeURIComponent(window.escape(a))}function g(a,b){for(var c="",d="UTF-8"===b?2:4,e=0,g=a.length;g>e;e+=d){var h=a.substring(e,e+d);4===d&&(h=h.substring(2,4)+h.substring(0,2)),c+=String.fromCharCode(parseInt(h,16))}return c="UTF-8"===b?f(c):c}function h(a,b){function d(){i.hasLocalStorage()&&(c.localStorage["_pouch__websqldb_"+D]=!0),b(null,B)}function f(a){a.executeSql(w),a.executeSql("ALTER TABLE "+r+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){a.executeSql(u),a.executeSql("ALTER TABLE "+q+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){a.executeSql(v);var b="SELECT "+q+".winningseq AS seq, "+q+".json AS metadata FROM "+r+" JOIN "+q+" ON "+r+".seq = "+q+".winningseq";a.executeSql(b,[],function(a,b){for(var c=[],d=[],e=0;e<b.rows.length;e++){var f=b.rows.item(e),g=f.seq,h=JSON.parse(f.metadata);i.isDeleted(h)&&c.push(g),i.isLocalId(h.id)&&d.push(h.id)}a.executeSql("UPDATE "+q+"SET local = 1 WHERE id IN ("+d.map(function(){return"?"}).join(",")+")",d),a.executeSql("UPDATE "+r+" SET deleted = 1 WHERE seq IN ("+c.map(function(){return"?"}).join(",")+")",c)})})})}function l(a){for(;E.length>0;){var b=E.pop();b(null,C)}x(a)}function x(a){a.executeSql("SELECT dbid, hex(dbid) AS hexId FROM "+t,[],function(a,b){var c=b.rows.item(0).dbid,d=b.rows.item(0).hexId;A=d.length===2*c.length?"UTF-8":"UTF-16"})}function y(a,b){if(0===b){var c="CREATE TABLE IF NOT EXISTS "+t+" (update_seq, dbid, db_version INTEGER)",d="CREATE TABLE IF NOT EXISTS "+s+" (digest, json, body BLOB)",e="CREATE TABLE IF NOT EXISTS "+q+" (id unique, seq, json, winningseq, local TINYINT(1))",g="CREATE TABLE IF NOT EXISTS "+r+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, doc_id_rev UNIQUE, json, deleted TINYINT(1))";a.executeSql(d),a.executeSql(e,[],function(){a.executeSql(w),a.executeSql(v)}),a.executeSql(g,[],function(){a.executeSql(u)}),a.executeSql(c,[],function(){var b="INSERT INTO "+t+" (update_seq, db_version, dbid) VALUES (?, ?, ?)";C=i.uuid(),a.executeSql(b,[0,p,C]),l(a)})}else 1===b&&(f(a),a.executeSql("UPDATE "+t+" SET db_version = "+p)),a.executeSql("SELECT dbid FROM "+t,[],function(a,b){C=b.rows.item(0).dbid,l(a)})}function z(){F.transaction(function(a){a.executeSql("SELECT sql FROM sqlite_master WHERE tbl_name = "+t,[],function(a,b){b.rows.length?/db_version/.test(b.rows.item(0).sql)?a.executeSql("SELECT db_version FROM "+t,[],function(a,b){var c=b.rows.item(0).db_version;y(a,c)}):a.executeSql("ALTER TABLE "+t+" ADD COLUMN db_version INTEGER",[],function(){y(a,1)}):y(a,0)})},e(b),d)}var A,B=this,C=null,D=a.name,E=[],F=m(D,n,D,o);return F?(i.isCordova()&&"undefined"!=typeof c?c.addEventListener(D+"_pouch",function G(){c.removeEventListener(D+"_pouch",G,!1),z()},!1):z(),B.type=function(){return"websql"},B._id=i.toPromise(function(a){a(null,C)}),B._info=function(a){F.transaction(function(b){var c="SELECT COUNT(id) AS count FROM "+q;b.executeSql(c,[],function(b,c){var d=c.rows.item(0).count,e="SELECT update_seq FROM "+t;b.executeSql(e,[],function(b,c){var e=c.rows.item(0).update_seq;a(null,{db_name:D,doc_count:d,update_seq:e})})})})},B._bulkDocs=function(a,b,c){function d(a,b){return a._bulk_seq-b._bulk_seq}function f(){var a=[];H.sort(d),H.forEach(function(b){if(delete b._bulk_seq,b.error)return void a.push(b);var c=b.metadata,d=j.winningRev(c);a.push({ok:!0,id:c.id,rev:d}),i.isLocalId(c.id)||(B++,h.Changes.notify(D),h.Changes.notifyLocalWindows(D))});var b="SELECT update_seq FROM "+t;G.executeSql(b,[],function(b,d){var e=d.rows.item(0).update_seq+B,f="UPDATE "+t+" SET update_seq=?";b.executeSql(f,[e],function(){c(null,a)})})}function l(a,b){if(a.stub)return b();if("string"==typeof a.data){try{a.data=atob(a.data)}catch(d){var e=k.error(k.BAD_ARG,"Attachments need to be base64 encoded");return c(e)}var f=i.fixBinary(a.data);a.data=i.createBlob([f],{type:a.content_type})}var g=new FileReader;g.onloadend=function(){var c=i.arrayBufferToBinaryString(this.result);a.data=c,a.digest="md5-"+i.Crypto.MD5(c),b()},g.readAsArrayBuffer(a.data)}function m(a){function b(){c++,C.length===c&&a()}if(!C.length)return a();var c=0;C.forEach(function(a){function c(){e++,e===d.length&&b()}var d=a.data&&a.data._attachments?Object.keys(a.data._attachments):[],e=0;if(!d.length)return b();for(var f in a.data._attachments)a.data._attachments.hasOwnProperty(f)&&l(a.data._attachments[f],c)})}function n(a,b,c){function d(){var b=a.data,c=b._id+"::"+b._rev,d=i.isDeleted(a.metadata,a.metadata.rev)?1:0,e="SELECT * FROM "+r+" WHERE doc_id_rev=?;";G.executeSql(e,[c],function(a,e){var f,h;e.rows.length?(f="UPDATE "+r+" SET json=?, deleted=? WHERE doc_id_rev=?;",h=[JSON.stringify(b),d,c],G.executeSql(f,h,function(a){g(a,e.rows.item(0).seq)})):(f="INSERT INTO "+r+" (doc_id_rev, json, deleted) VALUES (?, ?, ?);",h=[c,JSON.stringify(b),d],G.executeSql(f,h,function(a,b){g(a,b.insertId)}))})}function e(a){h||(a?(h=a,b(h)):k===l.length&&d())}function f(a){k++,e(a)}function g(d,e){a.metadata.seq=e,delete a.metadata.rev;var f=j.winningRev(a.metadata),g=c?"UPDATE "+q+" SET seq=?, json=?, winningseq=(SELECT seq FROM "+r+" WHERE doc_id_rev=?) WHERE id=?":"INSERT INTO "+q+" (id, seq, winningseq, json, local) VALUES (?, ?, ?, ?, ?);",h=JSON.stringify(a.metadata),k=a.metadata.id+"::"+f,l=i.isLocalId(a.metadata.id)?1:0,m=c?[e,h,k,a.metadata.id]:[a.metadata.id,e,e,h,l];d.executeSql(g,m,function(){H.push(a),b()})}var h=null,k=0;a.data._id=a.metadata.id,a.data._rev=a.metadata.rev,i.isDeleted(a.metadata,a.metadata.rev)&&(a.data._deleted=!0);var l=a.data._attachments?Object.keys(a.data._attachments):[];for(var m in a.data._attachments)if(a.data._attachments[m].stub)k++,e();else{var n=a.data._attachments[m].data;delete a.data._attachments[m].data;var o=a.data._attachments[m].digest;w(a,o,n,f)}l.length||d()}function o(a,b){var c=j.merge(a.rev_tree,b.metadata.rev_tree[0],1e3),d=i.isDeleted(a)&&i.isDeleted(b.metadata)||!i.isDeleted(a)&&y&&"new_leaf"!==c.conflicts;return d?(H.push(v(k.REV_CONFLICT,b._bulk_seq)),u()):(b.metadata.rev_tree=c.tree,void n(b,u,!0))}function p(a){return"was_delete"in b&&i.isDeleted(a.metadata)?(H.push(k.MISSING_DOC),u()):void n(a,u,!1)}function u(){if(!C.length)return f();var a=C.shift(),b=a.metadata.id;b in I?o(I[b],a):(I[b]=a.metadata,p(a))}function v(a,b){return a._bulk_seq=b,a}function w(a,b,c,d){var e=[a.metadata.id,a.metadata.rev].join("@"),f={digest:b},g="SELECT digest, json FROM "+s+" WHERE digest=?";G.executeSql(g,[b],function(a,h){h.rows.length?(f.refs=JSON.parse(h.rows.item(0).json).refs,g="UPDATE "+s+" SET json=?, body=? WHERE digest=?",a.executeSql(g,[JSON.stringify(f),c,b],function(){d()})):(f.refs={},f.refs[e]=!0,g="INSERT INTO "+s+"(digest, json, body) VALUES (?, ?, ?)",a.executeSql(g,[b,JSON.stringify(f),c],function(){d()}))})}function x(a,b){for(var c=0;c<b.rows.length;c++){var d=b.rows.item(c),e=g(d.hexId,A);I[e]=JSON.parse(d.json)}u()}var y=b.new_edits,z=a.docs,B=0,C=z.map(function(a,b){var c=i.parseDoc(a,y);return c._bulk_seq=b,c}),E=C.filter(function(a){return a.error});if(E.length)return c(E[0]);var G,H=[],I={};m(function(){F.transaction(function(a){G=a;var b="SELECT hex(id) AS hexId, json FROM "+q+" WHERE id IN ("+C.map(function(){return"?"}).join(",")+")",c=C.map(function(a){return a.metadata.id});G.executeSql(b,c,x)},e(c))})},B._get=function(a,b,c){function d(){c(g,{doc:e,metadata:f,ctx:h})}b=i.extend(!0,{},b);var e,f,g;if(!b.ctx)return void F.transaction(function(d){b.ctx=d,B._get(a,b,c)});var h=b.ctx,l="SELECT * FROM "+q+" WHERE id=?";h.executeSql(l,[a],function(a,c){if(!c.rows.length)return g=k.MISSING_DOC,d();if(f=JSON.parse(c.rows.item(0).json),i.isDeleted(f)&&!b.rev)return g=k.error(k.MISSING_DOC,"deleted"),d();var l=j.winningRev(f),m=b.rev?b.rev:l;m=f.id+"::"+m;var n="SELECT * FROM "+r+" WHERE doc_id_rev=?";h.executeSql(n,[m],function(a,b){return b.rows.length?(e=JSON.parse(b.rows.item(0).json),void d()):(g=k.MISSING_DOC,d())})})},B._allDocs=function(a,b){var c,d=[],f={},g=r+" JOIN "+q+" ON "+r+".seq = "+q+".winningseq",h="startkey"in a?a.startkey:!1,k="endkey"in a?a.endkey:!1,l="key"in a?a.key:!1,m="descending"in a?a.descending:!1,n="keys"in a?a.keys:!1,o="limit"in a?a.limit:!1,p="skip"in a?a.skip:!1,s=[],t=[q+".local = 0"];l!==!1?(t.push(q+".id = ?"),s.push(l)):n!==!1?(t.push(q+".id in ("+n.map(function(){return"?"}).join(",")+")"),s=s.concat(n)):(h!==!1||k!==!1)&&(h!==!1&&(t.push(q+".id "+(m?"<=":">=")+" ?"),s.push(h)),k!==!1&&(t.push(q+".id "+(m?">=":"<=")+" ?"),s.push(k)),l!==!1&&(t.push(q+".id = ?"),s.push(l))),n===!1&&t.push(r+".deleted = 0"),F.transaction(function(b){var e="SELECT COUNT("+q+".id) AS 'num' FROM "+g+" WHERE "+r+".deleted = 0 AND "+q+".local = 0";b.executeSql(e,[],function(b,e){if(c=e.rows.item(0).num,0!==o){var h="SELECT "+q+".id, "+r+".seq, "+r+".json AS data, "+q+".json AS metadata FROM "+g;t.length&&(h+=" WHERE "+t.join(" AND ")),h+=" ORDER BY "+q+".id "+(m?"DESC":"ASC"),o!==!1&&(h+=" LIMIT "+o),p!==!1&&p>0&&(o===!1&&(h+=" LIMIT -1"),h+=" OFFSET "+p),b.executeSql(h,s,function(b,c){for(var e=0,g=c.rows.length;g>e;e++){var h=c.rows.item(e),k=JSON.parse(h.metadata),l=JSON.parse(h.data);if(h={id:k.id,key:k.id,value:{rev:j.winningRev(k)}},a.include_docs){h.doc=l,h.doc._rev=j.winningRev(k),a.conflicts&&(h.doc._conflicts=j.collectConflicts(k));for(var m in h.doc._attachments)h.doc._attachments.hasOwnProperty(m)&&(h.doc._attachments[m].stub=!0)}"keys"in a?a.keys.indexOf(k.id)>-1&&(i.isDeleted(k)&&(h.value.deleted=!0,h.doc=null),f[h.id]=h):d.push(h)}})}})},e(b),function(){0!==o&&"keys"in a&&(a.keys.forEach(function(a){d.push(a in f?f[a]:{key:a,error:"not_found"})}),a.descending&&d.reverse()),b(null,{total_rows:c,offset:a.skip,rows:d})})},B._changes=function(a){function b(){var b="SELECT "+q+".id, "+r+".seq, "+r+".json AS data, "+q+".json AS metadata FROM "+r+" JOIN "+q+" ON "+r+".seq = "+q+".winningseq WHERE "+q+".seq > "+a.since+" ORDER BY "+q+".seq "+(d?"DESC":"ASC");F.transaction(function(c){c.executeSql(b,[],function(b,c){for(var d=0,f=0,g=c.rows.length;g>f;f++){var h=c.rows.item(f),j=JSON.parse(h.metadata);if(!i.isLocalId(j.id)){d<h.seq&&(d=h.seq);var k=JSON.parse(h.data),l=a.processChange(k,j,a);l.seq=h.seq,e.push(l)}}i.processChanges(a,e,d)})})}if(a=i.extend(!0,{},a),a.continuous){var c=D+":"+i.uuid();return h.Changes.addListener(D,c,B,a),h.Changes.notify(D),{cancel:function(){h.Changes.removeListener(D,c)}}}var d=a.descending;a.since=a.since&&!d?a.since:0;var e=[];b()},B._close=function(a){a()},B._getAttachment=function(a,b,c){var d,e=b.ctx,f=a.digest,h=a.content_type,j="SELECT hex(body) as body FROM "+s+" WHERE digest=?";e.executeSql(j,[f],function(a,e){var f=g(e.rows.item(0).body,A);b.encode?d=btoa(f):(f=i.fixBinary(f),d=i.createBlob([f],{type:h})),c(null,d)})},B._getRevisionTree=function(a,b){F.transaction(function(c){var d="SELECT json AS metadata FROM "+q+" WHERE id = ?";c.executeSql(d,[a],function(a,c){if(c.rows.length){var d=JSON.parse(c.rows.item(0).metadata);b(null,d.rev_tree)}else b(k.MISSING_DOC)})})},void(B._doCompaction=function(a,b,c,d){F.transaction(function(e){var f="SELECT json AS metadata FROM "+q+" WHERE id = ?";e.executeSql(f,[a],function(e,f){if(!f.rows.length)return i.call(d);var g=JSON.parse(f.rows.item(0).metadata);g.rev_tree=b;var h="DELETE FROM "+r+" WHERE doc_id_rev IN ("+c.map(function(){return"?"}).join(",")+")",j=c.map(function(b){return a+"::"+b});e.executeSql(h,[j],function(b){var c="UPDATE "+q+" SET json = ? WHERE id = ?";b.executeSql(c,[JSON.stringify(g),a],function(){d()})})})})})):b(k.UNKNOWN_ERROR)}var i=a("../utils"),j=a("../merge"),k=a("../deps/errors"),l={},m=i.getArguments(function(a){if("undefined"!=typeof c){if(c.navigator&&c.navigator.sqlitePlugin&&c.navigator.sqlitePlugin.openDatabase)return navigator.sqlitePlugin.openDatabase.apply(navigator.sqlitePlugin,a);if(c.sqlitePlugin&&c.sqlitePlugin.openDatabase)return c.sqlitePlugin.openDatabase.apply(c.sqlitePlugin,a);var b=l[a[0]];return b||(b=l[a[0]]=c.openDatabase.apply(c,a)),b}}),n=1,o=5242880,p=2,q=d("document-store"),r=d("by-sequence"),s=d("attach-store"),t=d("metadata-store"),u="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+r+" (seq, deleted)",v="CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+q+" (local, id)",w="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+q+" (winningseq)";h.valid=function(){if("undefined"!=typeof c){if(c.navigator&&c.navigator.sqlitePlugin&&c.navigator.sqlitePlugin.openDatabase)return!0;if(c.sqlitePlugin&&c.sqlitePlugin.openDatabase)return!0;if(c.openDatabase)return!0}return!1},h.destroy=i.toPromise(function(a,b,d){var f=m(a,n,a,o);f.transaction(function(a){a.executeSql("DROP TABLE IF EXISTS "+q,[]),a.executeSql("DROP TABLE IF EXISTS "+r,[]),a.executeSql("DROP TABLE IF EXISTS "+s,[]),a.executeSql("DROP TABLE IF EXISTS "+t,[])},e(d),function(){i.hasLocalStorage()&&delete c.localStorage["_pouch__websqldb_"+a],d()})}),h.Changes=new i.Changes,b.exports=h}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../deps/errors":8,"../merge":14,"../utils":18}],5:[function(a,b){(function(c){"use strict";function d(a){a&&c.debug&&console.error(a)}function e(a,b,c){if(!(this instanceof e))return new e(a,b,c);var j=this;("function"==typeof b||"undefined"==typeof b)&&(c=b,b={}),"object"==typeof a&&(b=a,a=void 0),"undefined"==typeof c&&(c=d),b=b||{};var k=c;j.auto_compaction=b.auto_compaction,j.prefix=e.prefix,g.call(j),j.taskqueue=new i;var l=new f(function(d,f){c=function(a,b){return a?f(a):(delete b.then,void d(b))},b=h.extend(!0,{},b);var g,i,k=b.name||a;return function(){try{if("string"!=typeof k)throw i=new Error("Missing/invalid DB name"),i.code=400,i;if(g=e.parseAdapter(k,b),b.originalName=k,b.name=g.name,b.adapter=b.adapter||g.adapter,!e.adapters[b.adapter])throw i=new Error("Adapter is missing"),i.code=404,i;if(!e.adapters[b.adapter].valid())throw i=new Error("Invalid Adapter"),i.code=404,i}catch(a){j.taskqueue.fail(a),j.changes=h.toPromise(function(b){b.complete&&b.complete(a)})}}(),i?f(i):(j.adapter=b.adapter,j.replicate=function(a,b,c){return h.cancellableFun(function(d,f,g){var h=e.replicate(a,b,c);g.cancel=h.cancel},j,c)},j.replicate.from=function(a,b,c){return"function"==typeof b&&(c=b,b={}),e.replicate(a,j,b,c)},j.replicate.to=function(a,b,c){return"function"==typeof b&&(c=b,b={}),e.replicate(j,a,b,c)},j.replicate.sync=function(a,b,c){return"function"==typeof b&&(c=b,b={}),h.cancellableFun(function(d,f,g){var h=e.sync(j,a,b,c);g.cancel=h.cancel},j,b)},j.destroy=h.adapterFun("destroy",function(a){var b=this;b.info(function(b,c){return b?a(b):void e.destroy(c.db_name,a)})}),e.adapters[b.adapter].call(j,b,function(a){function d(a){"destroyed"===a&&(j.emit("destroyed"),e.removeListener(b.name,d))}return a?void(c&&(j.taskqueue.fail(a),c(a))):(e.on(b.name,d),j.emit("created",j),e.emit("created",b.originalName),j.taskqueue.ready(j),void c(null,j))}),b.skipSetup&&j.taskqueue.ready(j),void(h.isCordova()&&cordova.fireWindowEvent(b.name+"_pouch",{})))});l.then(function(a){k(null,a)},k),j.then=l.then.bind(l),function(){try{j["catch"]=l["catch"].bind(l)}catch(a){}}()}var f="function"==typeof c.Promise?c.Promise:a("bluebird"),g=a("./adapter"),h=a("./utils"),i=a("./taskqueue");h.inherits(e,g),b.exports=e}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapter":1,"./taskqueue":17,"./utils":18,bluebird:28}],6:[function(a,b){(function(c){"use strict";function d(a,b){function d(b,c,d){if(a.binary||a.json||!a.processData||"string"==typeof b){if(!a.binary&&a.json&&"string"==typeof b)try{b=JSON.parse(b)}catch(e){return d(e)}}else b=JSON.stringify(b);Array.isArray(b)&&(b=b.map(function(a){var b;return a.ok?a:a.error&&"conflict"===a.error?(b=h.REV_CONFLICT,b.id=a.id,b):a.error&&"forbidden"===a.error?(b=h.FORBIDDEN,b.id=a.id,b.reason=a.reason,b):a.missing?(b=h.MISSING_DOC,b.missing=a.missing,b):a
})),d(null,b,c)}function k(a,b){var c,d,e,f;try{c=JSON.parse(a.responseText);for(f in h)if(h.hasOwnProperty(f)&&h[f].name===c.error){e=h[f];break}e||(e=h.UNKNOWN_ERROR,a.status&&(e.status=a.status),a.statusText&&(a.name=a.statusText)),d=h.error(e,c.reason)}catch(g){for(var f in h)if(h.hasOwnProperty(f)&&h[f].status===a.status){e=h[f];break}e||(e=h.UNKNOWN_ERROR,a.status&&(e.status=a.status),a.statusText&&(a.name=a.statusText)),d=h.error(e)}b(d)}var l=!1,m=j.getArguments(function(a){l||(b.apply(this,a),l=!0)});"function"==typeof a&&(m=a,a={}),a=f(!0,{},a);var n={method:"GET",headers:{},json:!0,processData:!0,timeout:1e4,cache:!1};if(a=f(!0,n,a),"GET"===a.method&&!a.cache){var o=-1!==a.url.indexOf("?");a.url+=(o?"&":"?")+"_nonce="+i(16)}if(c.browser){var p,q;q=a.xhr?new a.xhr:new XMLHttpRequest,q.open(a.method,a.url),q.withCredentials=!0,a.json&&(a.headers.Accept="application/json",a.headers["Content-Type"]=a.headers["Content-Type"]||"application/json",a.body&&a.processData&&"string"!=typeof a.body&&(a.body=JSON.stringify(a.body))),a.binary&&(q.responseType="arraybuffer");var r=function(a,b,c){var d="";if(c){var e=new Date;e.setTime(e.getTime()+24*c*60*60*1e3),d="; expires="+e.toGMTString()}document.cookie=a+"="+b+d+"; path=/"};for(var s in a.headers)if("Cookie"===s){var t=a.headers[s].split("=");r(t[0],t[1],10)}else q.setRequestHeader(s,a.headers[s]);"body"in a||(a.body=null);var u=function(){l||(q.abort(),k(q,m))};return q.onreadystatechange=function(){if(4===q.readyState&&!l)if(clearTimeout(p),q.status>=200&&q.status<300){var b;b=a.binary?g([q.response||""],{type:q.getResponseHeader("Content-Type")}):q.responseText,d(b,q,m)}else k(q,m)},a.timeout>0&&(p=setTimeout(u,a.timeout),q.onprogress=function(){clearTimeout(p),p=setTimeout(u,a.timeout)},q.upload&&(q.upload.onprogress=q.onprogress)),q.send(a.body),{abort:u}}return a.json&&(a.binary||(a.headers.Accept="application/json"),a.headers["Content-Type"]=a.headers["Content-Type"]||"application/json"),a.binary&&(a.encoding=null,a.json=!1),a.processData||(a.json=!1),e(a,function(b,c,e){if(b)return b.status=c?c.statusCode:400,k(b,m);var f,g=c.headers["content-type"],i=e||"";a.binary||!a.json&&a.processData||"object"==typeof i||!(/json/.test(g)||/^[\s]*\{/.test(i)&&/\}[\s]*$/.test(i))||(i=JSON.parse(i)),c.statusCode>=200&&c.statusCode<300?d(i,c,m):(a.binary&&(i=JSON.parse(i.toString())),f="missing"===i.reason?h.MISSING_DOC:"no_db_file"===i.reason?h.error(h.DB_MISSING,i.reason):"conflict"===i.error?h.REV_CONFLICT:h.error(h.UNKNOWN_ERROR,i.reason,i.error),f.status=c.statusCode,m(f))})}var e=a("request"),f=a("./extend.js"),g=a("./blob.js"),h=a("./errors"),i=a("../deps/uuid"),j=a("../utils");b.exports=d}).call(this,a("/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"../deps/uuid":12,"../utils":18,"./blob.js":7,"./errors":8,"./extend.js":10,"/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":23,request:21}],7:[function(a,b){(function(a){"use strict";function c(b,c){b=b||[],c=c||{};try{return new Blob(b,c)}catch(d){if("TypeError"!==d.name)throw d;for(var e=a.BlobBuilder||a.MSBlobBuilder||a.MozBlobBuilder||a.WebKitBlobBuilder,f=new e,g=0;g<b.length;g+=1)f.append(b[g]);return f.getBlob(c.type)}}b.exports=c}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(a,b,c){"use strict";function d(a){this.status=a.status,this.name=a.error,this.message=a.reason,this.error=!0}d.prototype__proto__=Error.prototype,d.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message})},c.UNAUTHORIZED=new d({status:401,error:"unauthorized",reason:"Name or password is incorrect."}),c.MISSING_BULK_DOCS=new d({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"}),c.MISSING_DOC=new d({status:404,error:"not_found",reason:"missing"}),c.REV_CONFLICT=new d({status:409,error:"conflict",reason:"Document update conflict"}),c.INVALID_ID=new d({status:400,error:"invalid_id",reason:"_id field must contain a string"}),c.MISSING_ID=new d({status:412,error:"missing_id",reason:"_id is required for puts"}),c.RESERVED_ID=new d({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),c.NOT_OPEN=new d({status:412,error:"precondition_failed",reason:"Database not open so cannot close"}),c.UNKNOWN_ERROR=new d({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),c.BAD_ARG=new d({status:500,error:"badarg",reason:"Some query argument is invalid"}),c.INVALID_REQUEST=new d({status:400,error:"invalid_request",reason:"Request was invalid"}),c.QUERY_PARSE_ERROR=new d({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"}),c.DOC_VALIDATION=new d({status:500,error:"doc_validation",reason:"Bad special document member"}),c.BAD_REQUEST=new d({status:400,error:"bad_request",reason:"Something wrong with the request"}),c.NOT_AN_OBJECT=new d({status:400,error:"bad_request",reason:"Document must be a JSON object"}),c.DB_MISSING=new d({status:404,error:"not_found",reason:"Database not found"}),c.IDB_ERROR=new d({status:500,error:"indexed_db_went_bad",reason:"unknown"}),c.WSQ_ERROR=new d({status:500,error:"web_sql_went_bad",reason:"unknown"}),c.LDB_ERROR=new d({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),c.FORBIDDEN=new d({status:403,error:"forbidden",reason:"Forbidden by design doc validate_doc_update function"}),c.error=function(a,b,c){function d(){this.message=b,c&&(this.name=c)}return d.prototype=a,new d(b)}},{}],9:[function(){"use strict";Object.keys||(Object.keys=function(a){if("object"!=typeof a&&"function"!=typeof a||null===a)throw new TypeError("Object.keys called on a non-object");var b=[];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b}),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),"forEach"in Array.prototype||(Array.prototype.forEach=function(a,b){for(var c=0,d=this.length;d>c;c++)c in this&&a.call(b,this[c],c,this)}),"map"in Array.prototype||(Array.prototype.map=function(a,b){for(var c=new Array(this.length),d=0,e=this.length;e>d;d++)d in this&&(c[d]=a.call(b,this[d],d,this));return c})},{}],10:[function(a,b){"use strict";function c(a){return null===a?String(a):"object"==typeof a||"function"==typeof a?h[l.call(a)]||"object":typeof a}function d(a){return null!==a&&a===a.window}function e(a){if(!a||"object"!==c(a)||a.nodeType||d(a))return!1;try{if(a.constructor&&!m.call(a,"constructor")&&!m.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}var e;for(e in a);return void 0===e||m.call(a,e)}function f(a){return"function"===c(a)}function g(){var a,b,c,d,h,i,j=arguments[0]||{},k=1,l=arguments.length,m=!1;for("boolean"==typeof j&&(m=j,j=arguments[1]||{},k=2),"object"==typeof j||f(j)||(j={}),l===k&&(j=this,--k);l>k;k++)if(null!=(a=arguments[k]))for(b in a)if(!(b in Object.prototype)){if(c=j[b],d=a[b],j===d)continue;m&&d&&(e(d)||(h=n(d)))?(h?(h=!1,i=c&&n(c)?c:[]):i=c&&e(c)?c:{},j[b]=g(m,i,d)):void 0!==d&&(n(a)&&f(d)||(j[b]=d))}return j}for(var h={},i=["Boolean","Number","String","Function","Array","Date","RegExp","Object","Error"],j=0;j<i.length;j++){var k=i[j];h["[object "+k+"]"]=k.toLowerCase()}var l=h.toString,m=h.hasOwnProperty,n=Array.isArray||function(a){return"array"===c(a)};b.exports=g},{}],11:[function(a,b,c){(function(b){"use strict";var d=a("crypto");c.MD5=function(a){function c(a,b){return a<<b|a>>>32-b}function e(a,b){var c,d,e,f,g;return e=2147483648&a,f=2147483648&b,c=1073741824&a,d=1073741824&b,g=(1073741823&a)+(1073741823&b),c&d?2147483648^g^e^f:c|d?1073741824&g?3221225472^g^e^f:1073741824^g^e^f:g^e^f}function f(a,b,c){return a&b|~a&c}function g(a,b,c){return a&c|b&~c}function h(a,b,c){return a^b^c}function i(a,b,c){return b^(a|~c)}function j(a,b,d,g,h,i,j){return a=e(a,e(e(f(b,d,g),h),j)),e(c(a,i),b)}function k(a,b,d,f,h,i,j){return a=e(a,e(e(g(b,d,f),h),j)),e(c(a,i),b)}function l(a,b,d,f,g,i,j){return a=e(a,e(e(h(b,d,f),g),j)),e(c(a,i),b)}function m(a,b,d,f,g,h,j){return a=e(a,e(e(i(b,d,f),g),j)),e(c(a,h),b)}function n(a){for(var b,c=a.length,d=c+8,e=(d-d%64)/64,f=16*(e+1),g=new Array(f-1),h=0,i=0;c>i;)b=(i-i%4)/4,h=i%4*8,g[b]=g[b]|a.charCodeAt(i)<<h,i++;return b=(i-i%4)/4,h=i%4*8,g[b]=g[b]|128<<h,g[f-2]=c<<3,g[f-1]=c>>>29,g}function o(a){var b,c,d="",e="";for(c=0;3>=c;c++)b=a>>>8*c&255,e="0"+b.toString(16),d+=e.substr(e.length-2,2);return d}if(!b.browser)return d.createHash("md5").update(a).digest("hex");var p,q,r,s,t,u,v,w,x,y=[],z=7,A=12,B=17,C=22,D=5,E=9,F=14,G=20,H=4,I=11,J=16,K=23,L=6,M=10,N=15,O=21;for(y=n(a),u=1732584193,v=4023233417,w=2562383102,x=271733878,p=0;p<y.length;p+=16)q=u,r=v,s=w,t=x,u=j(u,v,w,x,y[p+0],z,3614090360),x=j(x,u,v,w,y[p+1],A,3905402710),w=j(w,x,u,v,y[p+2],B,606105819),v=j(v,w,x,u,y[p+3],C,3250441966),u=j(u,v,w,x,y[p+4],z,4118548399),x=j(x,u,v,w,y[p+5],A,1200080426),w=j(w,x,u,v,y[p+6],B,2821735955),v=j(v,w,x,u,y[p+7],C,4249261313),u=j(u,v,w,x,y[p+8],z,1770035416),x=j(x,u,v,w,y[p+9],A,2336552879),w=j(w,x,u,v,y[p+10],B,4294925233),v=j(v,w,x,u,y[p+11],C,2304563134),u=j(u,v,w,x,y[p+12],z,1804603682),x=j(x,u,v,w,y[p+13],A,4254626195),w=j(w,x,u,v,y[p+14],B,2792965006),v=j(v,w,x,u,y[p+15],C,1236535329),u=k(u,v,w,x,y[p+1],D,4129170786),x=k(x,u,v,w,y[p+6],E,3225465664),w=k(w,x,u,v,y[p+11],F,643717713),v=k(v,w,x,u,y[p+0],G,3921069994),u=k(u,v,w,x,y[p+5],D,3593408605),x=k(x,u,v,w,y[p+10],E,38016083),w=k(w,x,u,v,y[p+15],F,3634488961),v=k(v,w,x,u,y[p+4],G,3889429448),u=k(u,v,w,x,y[p+9],D,568446438),x=k(x,u,v,w,y[p+14],E,3275163606),w=k(w,x,u,v,y[p+3],F,4107603335),v=k(v,w,x,u,y[p+8],G,1163531501),u=k(u,v,w,x,y[p+13],D,2850285829),x=k(x,u,v,w,y[p+2],E,4243563512),w=k(w,x,u,v,y[p+7],F,1735328473),v=k(v,w,x,u,y[p+12],G,2368359562),u=l(u,v,w,x,y[p+5],H,4294588738),x=l(x,u,v,w,y[p+8],I,2272392833),w=l(w,x,u,v,y[p+11],J,1839030562),v=l(v,w,x,u,y[p+14],K,4259657740),u=l(u,v,w,x,y[p+1],H,2763975236),x=l(x,u,v,w,y[p+4],I,1272893353),w=l(w,x,u,v,y[p+7],J,4139469664),v=l(v,w,x,u,y[p+10],K,3200236656),u=l(u,v,w,x,y[p+13],H,681279174),x=l(x,u,v,w,y[p+0],I,3936430074),w=l(w,x,u,v,y[p+3],J,3572445317),v=l(v,w,x,u,y[p+6],K,76029189),u=l(u,v,w,x,y[p+9],H,3654602809),x=l(x,u,v,w,y[p+12],I,3873151461),w=l(w,x,u,v,y[p+15],J,530742520),v=l(v,w,x,u,y[p+2],K,3299628645),u=m(u,v,w,x,y[p+0],L,4096336452),x=m(x,u,v,w,y[p+7],M,1126891415),w=m(w,x,u,v,y[p+14],N,2878612391),v=m(v,w,x,u,y[p+5],O,4237533241),u=m(u,v,w,x,y[p+12],L,1700485571),x=m(x,u,v,w,y[p+3],M,2399980690),w=m(w,x,u,v,y[p+10],N,4293915773),v=m(v,w,x,u,y[p+1],O,2240044497),u=m(u,v,w,x,y[p+8],L,1873313359),x=m(x,u,v,w,y[p+15],M,4264355552),w=m(w,x,u,v,y[p+6],N,2734768916),v=m(v,w,x,u,y[p+13],O,1309151649),u=m(u,v,w,x,y[p+4],L,4149444226),x=m(x,u,v,w,y[p+11],M,3174756917),w=m(w,x,u,v,y[p+2],N,718787259),v=m(v,w,x,u,y[p+9],O,3951481745),u=e(u,q),v=e(v,r),w=e(w,s),x=e(x,t);var P=o(u)+o(v)+o(w)+o(x);return P.toLowerCase()}}).call(this,a("/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":23,crypto:20}],12:[function(a,b){"use strict";function c(a,b){var d,e=c.CHARS,f=[];if(b=b||e.length,a)for(d=0;a>d;d++)f[d]=e[0|Math.random()*b];else{var g;for(f[8]=f[13]=f[18]=f[23]="-",f[14]="4",d=0;36>d;d++)f[d]||(g=0|16*Math.random(),f[d]=e[19===d?3&g|8:g])}return f.join("")}c.CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),b.exports=c},{}],13:[function(a,b){(function(c){"use strict";a("./deps/es5_shims");var d=a("./setup");b.exports=d,d.ajax=a("./deps/ajax"),d.extend=a("./deps/extend"),d.utils=a("./utils"),d.Errors=a("./deps/errors");var e=a("./replicate");d.replicate=e.replicate,d.sync=e.sync,d.version=a("./version");var f=a("./adapters/http");if(d.adapter("http",f),d.adapter("https",f),d.adapter("idb",a("./adapters/idb")),d.adapter("websql",a("./adapters/websql")),d.plugin(a("pouchdb-mapreduce")),!c.browser){var g=a("./adapters/leveldb");d.adapter("ldb",g),d.adapter("leveldb",g)}}).call(this,a("/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"./adapters/http":2,"./adapters/idb":3,"./adapters/websql":4,"./deps/ajax":6,"./deps/errors":8,"./deps/es5_shims":9,"./deps/extend":10,"./replicate":15,"./setup":16,"./utils":18,"./version":19,"/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":23,"pouchdb-mapreduce":43}],14:[function(a,b){"use strict";function c(a){for(var b,c=a.shift(),d=[c.id,c.opts,[]],e=d;a.length;)c=a.shift(),b=[c.id,c.opts,[]],e[2].push(b),e=b;return d}function d(a,b){for(var c=[{tree1:a,tree2:b}],d=!1;c.length>0;){var e=c.pop(),f=e.tree1,g=e.tree2;(f[1].status||g[1].status)&&(f[1].status="available"===f[1].status||"available"===g[1].status?"available":"missing");for(var h=0;h<g[2].length;h++)if(f[2][0]){for(var i=!1,j=0;j<f[2].length;j++)f[2][j][0]===g[2][h][0]&&(c.push({tree1:f[2][j],tree2:g[2][h]}),i=!0);i||(d="new_branch",f[2].push(g[2][h]),f[2].sort())}else d="new_leaf",f[2][0]=g[2][h]}return{conflicts:d,tree:a}}function e(a,b,c){var e,f=[],g=!1,h=!1;return a.length?(a.forEach(function(a){if(a.pos===b.pos&&a.ids[0]===b.ids[0])e=d(a.ids,b.ids),f.push({pos:a.pos,ids:e.tree}),g=g||e.conflicts,h=!0;else if(c!==!0){var i=a.pos<b.pos?a:b,j=a.pos<b.pos?b:a,k=j.pos-i.pos,l=[],m=[];for(m.push({ids:i.ids,diff:k,parent:null,parentIdx:null});m.length>0;){var n=m.pop();0!==n.diff?n.ids&&n.ids[2].forEach(function(a,b){m.push({ids:a,diff:n.diff-1,parent:n.ids,parentIdx:b})}):n.ids[0]===j.ids[0]&&l.push(n)}var o=l[0];o?(e=d(o.ids,j.ids),o.parent[2][o.parentIdx]=e.tree,f.push({pos:i.pos,ids:i.ids}),g=g||e.conflicts,h=!0):f.push(a)}else f.push(a)}),h||f.push(b),f.sort(function(a,b){return a.pos-b.pos}),{tree:f,conflicts:g||"internal_node"}):{tree:[b],conflicts:"new_leaf"}}function f(a,b){var d=h.rootToLeaf(a).map(function(a){var d=a.ids.slice(-b);return{pos:a.pos+(a.ids.length-d.length),ids:c(d)}});return d.reduce(function(a,b){return e(a,b,!0).tree},[d.shift()])}var g=a("./deps/extend"),h={};h.merge=function(a,b,c){a=g(!0,[],a),b=g(!0,{},b);var d=e(a,b);return{tree:f(d.tree,c),conflicts:d.conflicts}},h.winningRev=function(a){var b=[];return h.traverseRevTree(a.rev_tree,function(a,c,d,e,f){a&&b.push({pos:c,id:d,deleted:!!f.deleted})}),b.sort(function(a,b){return a.deleted!==b.deleted?a.deleted>b.deleted?1:-1:a.pos!==b.pos?b.pos-a.pos:a.id<b.id?1:-1}),b[0].pos+"-"+b[0].id},h.traverseRevTree=function(a,b){var c=[];for(a.forEach(function(a){c.push({pos:a.pos,ids:a.ids})});c.length>0;){var d=c.pop(),e=d.pos,f=d.ids,g=b(0===f[2].length,e,f[0],d.ctx,f[1]);f[2].forEach(function(a){c.push({pos:e+1,ids:a,ctx:g})})}},h.collectLeaves=function(a){var b=[];return h.traverseRevTree(a,function(a,c,d,e,f){a&&b.unshift({rev:c+"-"+d,pos:c,opts:f})}),b.sort(function(a,b){return b.pos-a.pos}),b.map(function(a){delete a.pos}),b},h.collectConflicts=function(a){var b=h.winningRev(a),c=h.collectLeaves(a.rev_tree),d=[];return c.forEach(function(a){a.rev===b||a.opts.deleted||d.push(a.rev)}),d},h.rootToLeaf=function(a){var b=[];return h.traverseRevTree(a,function(a,c,d,e,f){if(e=e?e.slice(0):[],e.push({id:d,opts:f}),a){var g=c+1-e.length;b.unshift({pos:g,ids:e})}return e}),b},b.exports=h},{"./deps/extend":10}],15:[function(a,b,c){"use strict";function d(){var a=this;this.cancelled=!1,this.cancel=function(){a.cancelled=!0}}function e(){this.seq=0,this.changes=[],this.docs=[]}function f(a,b,c,d){var e=c.filter?c.filter.toString():"";a.id(function(a,f){b.id(function(a,b){var g=f+b+e+JSON.stringify(c.query_params)+c.doc_ids;d("_local/"+n.Crypto.MD5(g))})})}function g(a,b,c,d){b.get(c,function(b,e){b&&404===b.status?d(null,0):b?d(b):a.get(c,function(a,b){a&&404===a.status||!a&&e.last_seq!==b.last_seq?d(null,0):a?d(a):d(null,b.last_seq)})})}function h(a,b,c,d,e){function f(a,b){a.get(c,function(e,f){if(e&&404===e.status)f={_id:c};else if(e)return b(e);f.last_seq=d,a.put(f,b)})}f(b,function(b){return b?e(b):void f(a,function(a){return a?e(a):void e()})})}function i(a,b,c,d,f){function i(){if(0===y.docs.length)return p();var a=y.docs;c.bulkDocs({docs:a},{new_edits:!1},function(b,c){if(b)return J.doc_write_failures+=a.length,o("target.bulkDocs completed with error",b);var d=[];return c.forEach(function(a){a.ok||(J.doc_write_failures++,d.push({status:500,error:a.error||"Unknown document write error",reason:a.reason||"Unknown reason"}))}),d.length>0?o("target.bulkDocs failed to write docs",d):(J.docs_written+=a.length,void p())})}function k(a,b){return f.cancelled?u():a?o("src.get completed with error",a):(Object.keys(b).forEach(function(a){var c=b[a].ok;c&&(J.docs_read++,y.pendingRevs++,y.docs.push(c))}),void m())}function l(a,c){b.allDocs({keys:a,include_docs:!0},function(a,b){return f.cancelled?u():a?o("src.get completed with error",a):(b.rows.forEach(function(a,b){var d=!a.doc||"1-"!==a.value.rev.slice(0,2)||a.doc._attachments&&Object.keys(a.doc._attachments).length;return d?B.push({id:"not_found"===a.error?a.key:a.id,rev:c[b]}):(J.docs_read++,y.pendingRevs++,void y.docs.push(a.doc))}),void m())})}function m(){if(B.length){var a=B.shift();return j(b,k,a.id,[a.rev])}var c=y.diffs;if(0===Object.keys(c).length)return void i();var d=Object.keys(c).reduce(function(a,b){return 1===c[b].missing.length&&"1-"===c[b].missing[0].slice(0,2)&&(a.ids.push(b),a.revs.push(c[b].missing[0]),delete c[b]),a},{ids:[],revs:[]});if(d.ids.length)return l(d.ids,d.revs);var e=Object.keys(c)[0],f=c[e].missing;delete c[e],j(b,k,e,f)}function o(a,b){if(!E){J.ok=!1,J.status="aborted",J.errors.push(b),J.end_time=new Date,J.last_seq=F,z=[],A=new e;var c={status:500,error:"Replication aborted",reason:a,details:b};E=!0,n.call(d.complete,c,J),f.cancel()}}function p(){C=!0,h(b,c,a,y.seq,function(a){return C=!1,f.cancelled?u():a?o("writeCheckpoint completed with error",a):(J.last_seq=F=y.seq,n.call(d.onChange,null,J),y=void 0,void s())})}function q(a,b){return f.cancelled?u():a?o("target.revsDiff completed with error",a):0===Object.keys(b).length?void p():(y.diffs=b,y.pendingRevs=0,void m())}function r(){var a={};y.changes.forEach(function(b){a[b.id]=b.changes.map(function(a){return a.rev})}),c.revsDiff(a,q)}function s(){if(f.cancelled)return u();if(!y){if(0===z.length)return void t();y=z.shift(),r()}}function t(){return 0===A.changes.length?void(D&&0===z.length&&!y&&u()):void((D||A.changes.length>=H)&&(z.push(A),A=new e,s()))}function u(){return E||f.cancelled&&(J.status="cancelled",C)?void 0:(J.status=J.status||"complete",J.end_time=new Date,J.last_seq=F,E=!0,J.errors.length>0?n.call(d.complete,J.errors[0],J):n.call(d.complete,null,J))}function v(a){return f.cancelled?u():void(E||(A.seq=a.seq,A.changes.push(a),t()))}function w(a){return D=!0,f.cancelled?u():(a&&(J.status="src.changes completed with error",J.errors.push(a)),void t())}function x(){g(b,c,a,function(a,c){if(a)return o("fetchCheckpoint completed with error",a);if(F=c,f.cancelled)return u();var e={continuous:G,since:F,style:"all_docs",onChange:v,complete:w,doc_ids:I};d.filter&&(e.filter=d.filter),d.query_params&&(e.query_params=d.query_params);var g=b.changes(e),h=f.cancel;f.cancel=function(){h(),u(),g&&g.cancel instanceof Function&&g.cancel()}})}var y,z=[],A=new e,B=[],C=!1,D=!1,E=!1,F=0,G=d.continuous||d.live||!1,H=d.batch_size||1,I=d.doc_ids,J={ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};"undefined"==typeof d.since?x():h(b,c,a,d.since,function(a){return a?o("writeCheckpoint completed with error",a):(F=d.since,void x())})}function j(a,b,c,d){a.get(c,{revs:!0,open_revs:d,attachments:!0},b)}function k(a,b){return"string"==typeof a?new o(a,b):void b(null,a)}function l(a,b,c,e){c instanceof Function&&(e=c,c={}),void 0===c&&(c={}),c.complete||(c.complete=e),c=n.extend(!0,{},c),c.continuous=c.continuous||c.live;var g=new d;return k(a,function(a,d){return a?e(a):void k(b,function(a,b){if(a)return e(a);if(c.server){if("function"!=typeof d.replicateOnServer)return e({error:"Server replication not supported for "+d.type()+"adapter"});if(d.type()!==b.type())return e({error:"Server replication for different adapter types ("+d.type()+" and "+b.type()+") is not supported"});d.replicateOnServer(b,c,g)}else f(d,b,c,function(a){i(a,d,b,c,g)})})}),g}function m(a,b,c,d){function e(a,b){return function(c,d){c&&j(),d.direction=b,a(c,d)}}function f(a,b){return b=b||function(){},function(c){return{source:a,change:b(c)}}}function g(a,b,c){return b=n.extend(!0,{},b),b.complete=e(b.complete,c),b.onChange=f(a,b.onChange),b.continuous=b.continuous||b.live,b}function h(){return k=l(a,b,g(a,c,"push"),d)}function i(){return m=l(b,a,g(b,c,"pull"),d)}function j(){k&&k.cancel(),m&&m.cancel()}var k,m;return c instanceof Function&&(d=c,c={}),void 0===c&&(c={}),d instanceof Function&&!c.complete&&(c.complete=d),{push:h(),pull:i(),cancel:j}}var n=a("./utils"),o=a("./index");c.replicate=l,c.sync=m},{"./index":13,"./utils":18}],16:[function(a,b){(function(c){"use strict";var d=a("./constructor"),e=a("./utils"),f=a("events").EventEmitter;d.adapters={},d.prefix="_pouch_";var g=new f,h=["on","addListener","emit","listeners","once","removeAllListeners","removeListener","setMaxListeners"],i=["levelalt","idb","leveldb","websql"];h.forEach(function(a){d[a]=g[a].bind(g)}),d.setMaxListeners(0),d.parseAdapter=function(a,b){var f,g,h=a.match(/([a-z\-]*):\/\/(.*)/);if(h){if(a=/http(s?)/.test(h[1])?h[1]+"://"+h[2]:h[2],f=h[1],!d.adapters[f].valid())throw"Invalid adapter";return{name:a,adapter:h[1]}}var j="idb"in d.adapters&&"websql"in d.adapters&&e.hasLocalStorage()&&c.localStorage["_pouch__websqldb_"+d.prefix+a];if("undefined"!=typeof b&&b.db)g="leveldb";else for(var k=0;k<i.length;++k)if(g=i[k],g in d.adapters){if(j&&"idb"===g)continue;break}if(g){f=d.adapters[g];var l="use_prefix"in f?f.use_prefix:!0;return{name:l?d.prefix+a:a,adapter:g}}throw"No valid adapter found"},d.destroy=e.toPromise(function(a,b,c){("function"==typeof b||"undefined"==typeof b)&&(c=b,b={}),"object"==typeof a&&(b=a,a=void 0);var e=d.parseAdapter(b.name||a,b),f=e.name;d.adapters[e.adapter].destroy(f,b,function(a,b){a?c(a):(d.emit("destroyed",f),d.emit(f,"destroyed"),c(null,b))})}),d.allDbs=e.toPromise(function(a){var b=new Error("allDbs method removed");b.stats="400",a(b)}),d.adapter=function(a,b){b.valid()&&(d.adapters[a]=b)},d.plugin=function(a){Object.keys(a).forEach(function(b){d.prototype[b]=a[b]})},b.exports=d}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./constructor":5,"./utils":18,events:22}],17:[function(a,b){"use strict";function c(){this.isReady=!1,this.failed=!1,this.queue=[]}b.exports=c,c.prototype.execute=function(){var a,b;if(this.failed)for(;a=this.queue.shift();)b=a.parameters[a.parameters.length-1],"function"==typeof b?b(this.failed):"changes"===a.name&&"function"==typeof b.complete&&b.complete(this.failed);else if(this.isReady)for(;a=this.queue.shift();)"function"==typeof a?a():a.task=this.db[a.name].apply(this.db,a.parameters)},c.prototype.fail=function(a){this.failed=a,this.execute()},c.prototype.ready=function(a){return this.failed?!1:0===arguments.length?this.isReady:(this.isReady=a?!0:!1,this.db=a,void this.execute())},c.prototype.addTask=function(a,b){if("function"!=typeof a){var c={name:a,parameters:b};return this.queue.push(c),this.failed&&this.execute(),c}this.queue.push(a)}},{}],18:[function(a,b,c){(function(b,d){function e(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}var f=a("./merge");c.extend=a("./deps/extend"),c.ajax=a("./deps/ajax"),c.createBlob=a("./deps/blob");var g=a("./deps/uuid");c.Crypto=a("./deps/md5.js");var h=a("./deps/buffer"),i=a("./deps/errors"),j=a("events").EventEmitter,k="function"==typeof d.Promise?d.Promise:a("bluebird"),l=["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree"];c.inherits=a("inherits"),c.uuids=function(a,b){"object"!=typeof b&&(b={});for(var c=b.length,d=b.radix,e=[];e.push(g(c,d))<a;);return e},c.uuid=function(a){return c.uuids(1,a)[0]},c.invalidIdError=function(a){return a?"string"!=typeof a?i.INVALID_ID:/^_/.test(a)&&!/^_(design|local)/.test(a)?i.RESERVED_ID:void 0:i.MISSING_ID},c.getArguments=function(a){return function(){for(var b=arguments.length,c=new Array(b),d=-1;++d<b;)c[d]=arguments[d];return a.call(this,c)}},c.call=c.getArguments(function(a){if(a.length){var b=a.shift();"function"==typeof b&&b.apply(this,a)}}),c.isLocalId=function(a){return/^_local/.test(a)},c.isDeleted=function(a,b){b||(b=f.winningRev(a)),b.indexOf("-")>=0&&(b=b.split("-")[1]);var c=!1;return f.traverseRevTree(a.rev_tree,function(a,d,e,f,g){e===b&&(c=!!g.deleted)}),c},c.filterChange=function(a){return function(b){var c={},d=a.filter&&"function"==typeof a.filter;if(c.query=a.query_params,a.filter&&d&&!a.filter.call(this,b.doc,c))return!1;if(a.doc_ids&&-1===a.doc_ids.indexOf(b.id))return!1;if(a.include_docs)for(var e in b.doc._attachments)b.doc._attachments.hasOwnProperty(e)&&(b.doc._attachments[e].stub=!0);else delete b.doc;return!0}},c.processChanges=function(a,b,d){b=b.filter(c.filterChange(a)),a.limit&&a.limit<b.length&&(b.length=a.limit),b.forEach(function(b){c.call(a.onChange,b)}),a.continuous||c.call(a.complete,null,{results:b,last_seq:d})},c.parseDoc=function(a,b){var d,e,f,g=null,h={status:"available"};if(a._deleted&&(h.deleted=!0),b)if(a._id||(a._id=c.uuid()),e=c.uuid({length:32,radix:16}).toLowerCase(),a._rev){if(f=/^(\d+)-(.+)$/.exec(a._rev),!f)throw"invalid value for property '_rev'";a._rev_tree=[{pos:parseInt(f[1],10),ids:[f[2],{status:"missing"},[[e,h,[]]]]}],d=parseInt(f[1],10)+1}else a._rev_tree=[{pos:1,ids:[e,h,[]]}],d=1;else if(a._revisions&&(a._rev_tree=[{pos:a._revisions.start-a._revisions.ids.length+1,ids:a._revisions.ids.reduce(function(a,b){return null===a?[b,h,[]]:[b,{status:"missing"},[a]]},null)}],d=a._revisions.start,e=a._revisions.ids[0]),!a._rev_tree){if(f=/^(\d+)-(.+)$/.exec(a._rev),!f)return i.BAD_ARG;d=parseInt(f[1],10),e=f[2],a._rev_tree=[{pos:parseInt(f[1],10),ids:[f[2],h,[]]}]}g=c.invalidIdError(a._id);for(var j in a)a.hasOwnProperty(j)&&"_"===j[0]&&-1===l.indexOf(j)&&(g=c.extend({},i.DOC_VALIDATION),g.reason+=": "+j);return a._id=decodeURIComponent(a._id),a._rev=[d,e].join("-"),g?g:Object.keys(a).reduce(function(b,c){return/^_/.test(c)&&"_attachments"!==c?b.metadata[c.slice(1)]=a[c]:b.data[c]=a[c],b},{metadata:{},data:{}})},c.isCordova=function(){return"undefined"!=typeof cordova||"undefined"!=typeof PhoneGap||"undefined"!=typeof phonegap},c.hasLocalStorage=function(){if(e())return!1;try{return d.localStorage}catch(a){return!1}},c.Changes=function(){var a={},b=new j,f=e(),g={},h=!1;return f||(h=c.hasLocalStorage()),f?chrome.storage.onChanged.addListener(function(a){null!=a.db_name&&b.emit(a.dbName.newValue)}):h&&(d.addEventListener?d.addEventListener("storage",function(a){b.emit(a.key)}):d.attachEvent("storage",function(a){b.emit(a.key)})),a.addListener=function(a,d,e,f){function h(){e.changes({include_docs:f.include_docs,conflicts:f.conflicts,continuous:!1,descending:!1,filter:f.filter,view:f.view,since:f.since,query_params:f.query_params,onChange:function(a){a.seq>f.since&&!f.cancelled&&(f.since=a.seq,c.call(f.onChange,a))}})}g[d]||(g[d]=h,b.on(a,h))},a.removeListener=function(a,c){c in g&&b.removeListener(a,g[c])},a.clearListeners=function(a){b.removeAllListeners(a)},a.notifyLocalWindows=function(a){f?chrome.storage.local.set({dbName:a}):h&&(localStorage[a]="a"===localStorage[a]?"b":"a")},a.notify=function(a){b.emit(a)},a},c.atob=b.browser&&"atob"in d?function(a){return atob(a)}:function(a){var b=new h(a,"base64");if(b.toString("base64")!==a)throw"Cannot base64 encode full string";return b.toString("binary")},c.btoa=b.browser&&"btoa"in d?function(a){return btoa(a)}:function(a){return new h(a,"binary").toString("base64")},c.fixBinary=function(a){if(!b.browser)return a;for(var c=a.length,d=new ArrayBuffer(c),e=new Uint8Array(d),f=0;c>f;f++)e[f]=a.charCodeAt(f);return d},c.once=function(a){var b=!1;return c.getArguments(function(c){if(b)throw console.trace(),new Error("once called  more than once");b=!0,a.apply(this,c)})},c.toPromise=function(a){return c.getArguments(function(d){var e,f=this,g="function"==typeof d[d.length-1]?d.pop():!1;g&&(e=function(a,c){b.nextTick(function(){g(a,c)})});var h=new k(function(b,e){try{var g=c.once(function(a,c){a?e(a):b(c)});d.push(g),a.apply(f,d)}catch(h){e(h)}});return e&&h.then(function(a){e(null,a)},e),h.cancel=function(){return this},h})},c.adapterFun=function(a,b){return c.toPromise(c.getArguments(function(c){return this.taskqueue.isReady?void b.apply(this,c):void this.taskqueue.addTask(a,c)}))},c.arrayBufferToBinaryString=function(a){for(var b="",c=new Uint8Array(a),d=c.byteLength,e=0;d>e;e++)b+=String.fromCharCode(c[e]);return b},c.cancellableFun=function(a,b,d){d=d?c.extend(!0,{},d):{},d.complete=d.complete||function(){};var e=c.once(d.complete),f=new k(function(a,b){d.complete=function(c,d){c?b(c):a(d)}});return f.then(function(a){e(null,a)},e),f.cancel=function(){f.isCancelled=!0,b.taskqueue.isReady&&d.complete(null,{status:"cancelled"})},b.taskqueue.isReady?(a(b,d,f),f):(b.taskqueue.addTask(function(){f.isCancelled?d.complete(null,{status:"cancelled"}):a(b,d,f)}),f)}}).call(this,a("/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./deps/ajax":6,"./deps/blob":7,"./deps/buffer":21,"./deps/errors":8,"./deps/extend":10,"./deps/md5.js":11,"./deps/uuid":12,"./merge":14,"/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":23,bluebird:28,events:22,inherits:24}],19:[function(a,b){b.exports=a("../package.json").version},{"../package.json":53}],20:[function(){},{}],21:[function(a,b){b.exports=a(20)},{}],22:[function(a,b){function c(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(a){return"function"==typeof a}function e(a){return"number"==typeof a}function f(a){return"object"==typeof a&&null!==a}function g(a){return void 0===a}b.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._maxListeners=void 0,c.defaultMaxListeners=10,c.prototype.setMaxListeners=function(a){if(!e(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},c.prototype.emit=function(a){var b,c,e,h,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||f(this._events.error)&&!this._events.error.length))throw b=arguments[1],b instanceof Error?b:TypeError('Uncaught, unspecified "error" event.');if(c=this._events[a],g(c))return!1;if(d(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];c.apply(this,h)}else if(f(c)){for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];for(j=c.slice(),e=j.length,i=0;e>i;i++)j[i].apply(this,h)}return!0},c.prototype.addListener=function(a,b){var e;if(!d(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,d(b.listener)?b.listener:b),this._events[a]?f(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,f(this._events[a])&&!this._events[a].warned){var e;e=g(this._maxListeners)?c.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[a].length>e&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),console.trace())
}return this},c.prototype.on=c.prototype.addListener,c.prototype.once=function(a,b){function c(){this.removeListener(a,c),e||(e=!0,b.apply(this,arguments))}if(!d(b))throw TypeError("listener must be a function");var e=!1;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,b){var c,e,g,h;if(!d(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],g=c.length,e=-1,c===b||d(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(f(c)){for(h=g;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){e=h;break}if(0>e)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(e,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},c.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],d(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},c.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?d(this._events[a])?[this._events[a]]:this._events[a].slice():[]},c.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?d(a._events[b])?1:a._events[b].length:0}},{}],23:[function(a,b){var c=b.exports={};c.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),c.length>0)){var d=c.shift();d()}},!0),function(a){c.push(a),window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}(),c.title="browser",c.browser=!0,c.env={},c.argv=[],c.binding=function(){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(){throw new Error("process.chdir is not supported")}},{}],24:[function(a,b){b.exports="function"==typeof Object.create?function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],25:[function(a,b){"use strict";function c(){}b.exports=c},{}],26:[function(a,b){"use strict";var c=a("./INTERNAL"),d=a("./promise"),e=a("./reject"),f=a("./resolve");b.exports=function(a){function b(a,b){f(a).then(function(a){h[b]=a,++i===g&&k.resolve(h)},function(a){k.reject(a)})}if("[object Array]"!==Object.prototype.toString.call(a))return e(new TypeError("must be an array"));var g=a.length;if(!g)return f([]);for(var h=[],i=0,j=-1,k=new d(c);++j<g;)b(a[j],j);return k}},{"./INTERNAL":25,"./promise":30,"./reject":31,"./resolve":32}],27:[function(a,b){"use strict";function c(a){var b=a&&a.then;return a&&"object"==typeof a&&"function"==typeof b?function(){b.apply(a,arguments)}:void 0}b.exports=c},{}],28:[function(a,b,c){b.exports=c=a("./promise"),c.resolve=a("./resolve"),c.reject=a("./reject"),c.all=a("./all")},{"./all":26,"./promise":30,"./reject":31,"./resolve":32}],29:[function(a,b){"use strict";function c(){var a=0;return function(b){return function(){a++||b.apply(this,arguments)}}}b.exports=c},{}],30:[function(a,b){"use strict";function c(a){if(!(this instanceof c))return new c(a);if("function"!=typeof a)throw new TypeError("reslover must be a function");this.state=j,this.queue=[],a!==f&&d(this,a)}function d(a,b){var c=g(),d=c(function(b){return a.reject(b)}),e=h(function(){b(c(function(b){return a.resolve(b)}),d)});"error"===e.status&&d(e.value)}var e=a("./unwrap"),f=a("./INTERNAL"),g=a("./once"),h=a("./tryCatch"),i=a("./getThen"),j=["PENDING"],k=["FULFILLED"],l=["REJECTED"];b.exports=c,c.prototype.resolve=function(a){var b=h(i,a);if("error"===b.status)return this.reject(b.value);var c=b.value;if(c)d(this,c);else{this.state=k,this.outcome=a;for(var e=-1,f=this.queue.length;++e<f;)this.queue[e].callFulfilled(a)}return this},c.prototype.reject=function(a){this.state=l,this.outcome=a;for(var b=-1,c=this.queue.length;++b<c;)this.queue[b].callRejected(a);return this},c.prototype["catch"]=function(a){return this.then(null,a)},c.prototype.then=function(a,b){var d="function"==typeof a,g="function"==typeof b;if(!d&&this.state===k||!b&&this.state===l)return this;var h=new c(f),i={promise:h};return this.state!==l&&(i.callFulfilled=d?function(b){e(h,a,b)}:function(a){h.resolve(a)}),this.state!==k&&(i.callRejected=g?function(a){e(h,b,a)}:function(a){h.reject(a)}),this.state===k?i.callFulfilled(this.outcome):this.state===l?i.callRejected(this.outcome):this.queue.push(i),h}},{"./INTERNAL":25,"./getThen":27,"./once":29,"./tryCatch":33,"./unwrap":34}],31:[function(a,b){"use strict";function c(a){var b=new d(e);return b.reject(a)}var d=a("./promise"),e=a("./INTERNAL");b.exports=c},{"./INTERNAL":25,"./promise":30}],32:[function(a,b){"use strict";function c(a){if(a)return new d(e).resolve(a);var b=typeof a;switch(b){case"boolean":return f;case"undefined":return h;case"object":return g;case"number":return i;case"string":return j}}var d=a("./promise"),e=a("./INTERNAL");b.exports=c;var f=new d(e).resolve(!1),g=new d(e).resolve(null),h=new d(e).resolve(void 0),i=new d(e).resolve(0),j=new d(e).resolve("")},{"./INTERNAL":25,"./promise":30}],33:[function(a,b){"use strict";function c(a,b){var c={};try{c.value=a(b),c.status="success"}catch(d){c.status="error",c.value=d}return c}b.exports=c},{}],34:[function(a,b){"use strict";function c(a,b,c){d(function(){var d;try{d=b(c)}catch(e){return a.reject(e)}d===a?a.reject(new TypeError("Cannot resolve promise with itself")):a.resolve(d)})}var d=a("immediate");b.exports=c},{immediate:36}],35:[function(a,b,c){"use strict";c.test=function(){return!1}},{}],36:[function(a,b){"use strict";function c(){var a,b=0,c=f;for(f=[];a=c[b++];)a()}for(var d,e=[a("./nextTick"),a("./mutation"),a("./postMessage"),a("./messageChannel"),a("./stateChange"),a("./timeout")],f=[],g=-1,h=e.length;++g<h;)if(e[g].test()){d=e[g].install(c);break}b.exports=function(a){var b,e,g,h=a;if(arguments.length>1&&"function"==typeof a){for(g=new Array(arguments.length-1),e=0;++e<arguments.length;)g[e-1]=arguments[e];h=function(){a.apply(void 0,g)}}return 1===(b=f.push(h))&&d(c),b},b.exports.clear=function(a){return a<=f.length&&(f[a-1]=function(){}),this}},{"./messageChannel":37,"./mutation":38,"./nextTick":35,"./postMessage":39,"./stateChange":40,"./timeout":41}],37:[function(a,b,c){(function(a){"use strict";c.test=function(){return"undefined"!=typeof a.MessageChannel},c.install=function(b){var c=new a.MessageChannel;return c.port1.onmessage=b,function(){c.port2.postMessage(0)}}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],38:[function(a,b,c){(function(a){"use strict";var b=a.MutationObserver||a.WebKitMutationObserver;c.test=function(){return b},c.install=function(c){var d=new b(c),e=a.document.createElement("div");return d.observe(e,{attributes:!0}),a.addEventListener("unload",function(){d.disconnect(),d=null},!1),function(){e.setAttribute("drainQueue","drainQueue")}}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],39:[function(a,b,c){(function(a){"use strict";c.test=function(){if(!a.postMessage||a.importScripts)return!1;var b=!0,c=a.onmessage;return a.onmessage=function(){b=!1},a.postMessage("","*"),a.onmessage=c,b},c.install=function(b){function c(c){c.source===a&&c.data===d&&b()}var d="com.calvinmetcalf.setImmediate"+Math.random();return a.addEventListener?a.addEventListener("message",c,!1):a.attachEvent("onmessage",c),function(){a.postMessage(d,"*")}}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],40:[function(a,b,c){(function(a){"use strict";c.test=function(){return"document"in a&&"onreadystatechange"in a.document.createElement("script")},c.install=function(b){return function(){var c=a.document.createElement("script");return c.onreadystatechange=function(){b(),c.onreadystatechange=null,c.parentNode.removeChild(c),c=null},a.document.documentElement.appendChild(c),b}}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],41:[function(a,b,c){"use strict";c.test=function(){return!0},c.install=function(a){return function(){setTimeout(a,0)}}},{}],42:[function(_dereq_,module,exports){"use strict";module.exports=function(func,emit,sum,log,isArray,toJSON){return eval("'use strict'; ("+func+");")}},{}],43:[function(a,b,c){(function(b,d){"use strict";function e(a){for(var b={},c=0,d=a.length;d>c;c++){var e=r(a[c]),f=b[e];"undefined"==typeof f?b[e]=c:"number"==typeof f?b[e]=[f,c]:f.push(c)}return b}function f(a,b){var c=o(a.id,b.id);return 0!==c?c:o(a.value,b.value)}function g(a,b,c){var d=c[a];"undefined"==typeof d?c[a]=b:Array.isArray(d)?d.push(b):c[a]=[d,b]}function h(a){return a.reduce(function(a,b){return a+b},0)}function i(a,b,c,d){var e=b[a];"undefined"!=typeof e&&(d&&(e=encodeURIComponent(JSON.stringify(e))),c.push(a+"="+e))}function j(a,b,c){var d=new Array(b.length);a.forEach(function(a){var b=c[r(a.key)];"number"==typeof b?g(b,a,d):b.forEach(function(b){g(b,a,d)})});var e=[];return d.forEach(function(a){Array.isArray(a)?e=e.concat(a.sort(f)):e.push(a)}),e}function k(a,b,c){function d(b,d){var g={id:i.doc._id,key:b,value:d};if(!("undefined"!=typeof c.startkey&&o(b,c.startkey)<0||"undefined"!=typeof c.endkey&&o(b,c.endkey)>0||"undefined"!=typeof c.key&&0!==o(b,c.key)||"undefined"!=typeof c.keys&&(k=k||e(c.keys),"undefined"==typeof k[r(b)]))){if(m++,c.include_docs){if(d&&"object"==typeof d&&d._id)return void a.get(d._id,function(a,b){b&&(g.doc=b),l.push(g),f()});g.doc=i.doc}l.push(g)}}function f(){var a;if(n&&l.length===m){if("undefined"!=typeof c.keys&&l.length?l=j(l,c.keys,k):l.sort(function(a,b){var c=o(a.key,b.key);return 0!==c?c:o(a.id,b.id)}),c.descending&&l.reverse(),c.reduce===!1)return c.complete(null,{total_rows:l.length,offset:c.skip,rows:"limit"in c?l.slice(c.skip,c.limit+c.skip):c.skip>0?l.slice(c.skip):l});var d=[];if(l.forEach(function(a){var b=d[d.length-1];return b&&0===o(b.key[0][0],a.key)?(b.key.push([a.key,a.id]),void b.value.push(a.value)):void d.push({key:[[a.key,a.id]],value:[a.value]})}),d.forEach(function(c){return c.value=b.reduce.call(null,c.key,c.value),c.value.sumsqr&&c.value.sumsqr instanceof Error?void(a=c.value):void(c.key=c.key[0][0])}),a)return void c.complete(a);c.complete(null,{total_rows:d.length,offset:c.skip,rows:"limit"in c?d.slice(c.skip,c.limit+c.skip):c.skip>0?d.slice(c.skip):d})}}var g;c.skip||(c.skip=0),b.reduce||(c.reduce=!1);var i,k,l=[],m=0,n=!1;"function"==typeof b.map&&2===b.map.length?(g=b.map,b.map=function(a){return g(a,d)}):b.map=p(b.map.toString(),d,h,q,Array.isArray,JSON.parse),b.reduce&&(b.reduce=s[b.reduce]?s[b.reduce]:p(b.reduce.toString(),d,h,q,Array.isArray,JSON.parse)),a.changes({conflicts:!0,include_docs:!0,onChange:function(a){"deleted"in a||"_"===a.id[0]||(i={doc:a.doc},b.map.call(null,a.doc))},complete:function(){n=!0,f()}})}function l(a,b,c){var d,e=c.complete,f=[],g="GET";if(i("reduce",c,f),i("include_docs",c,f),i("limit",c,f),i("descending",c,f),i("group",c,f),i("group_level",c,f),i("skip",c,f),i("startkey",c,f,!0),i("endkey",c,f,!0),i("key",c,f,!0),"undefined"!=typeof c.keys&&(g="POST","string"==typeof b?d=JSON.stringify({keys:c.keys}):b.keys=c.keys),f=f.join("&"),f=""===f?"":"?"+f,"string"==typeof b){var h=b.split("/");return void a.request({method:g,url:"_design/"+h[0]+"/_view/"+h[1]+f,body:d},e)}var j=JSON.parse(JSON.stringify(b,function(a,b){return"function"==typeof b?b+"":b}));a.request({method:"POST",url:"_temp_view"+f,body:j},e)}var m=a("pouchdb-collate"),n="function"==typeof d.Promise?d.Promise:a("lie"),o=m.collate,p=a("./evalfunc"),q="undefined"!=typeof console?Function.prototype.bind.call(console.log,console):function(){},r=function(a){return JSON.stringify(m.normalizeKey(a))},s={_sum:function(a,b){return h(b)},_count:function(a,b){return b.length},_stats:function(a,b){return{sum:h(b),min:Math.min.apply(null,b),max:Math.max.apply(null,b),count:b.length,sumsqr:function(){var a,c=0;for(var d in b){if("number"!=typeof b[d])return a=new Error("builtin _stats function requires map values to be numbers"),a.name="invalid_value",a.status=500,a;c+=b[d]*b[d]}return c}()}}};c.query=function(a,c,d){var e=this;"function"==typeof c&&(d=c,c={}),c=c||{},d&&(c.complete=d);var f,g=c.complete;c.complete&&(f=function(a,c){b.nextTick(function(){g(a,c)})});var h=new n(function(b,d){if(c.complete=function(a,c){a?d(a):b(c)},"http"===e.type())return"function"==typeof a?l(e,{map:a},c):l(e,a,c);if("object"==typeof a)return k(e,a,c);if("function"==typeof a)return k(e,{map:a},c);var f=a.split("/");e.get("_design/"+f[0],function(a,b){return a?void c.complete(a):b.views[f[1]]?void k(e,{map:b.views[f[1]].map,reduce:b.views[f[1]].reduce},c):void c.complete({name:"not_found",message:"missing_named_view"})})});return f&&h.then(function(a){f(null,a)},f),h}}).call(this,a("/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./evalfunc":42,"/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":23,lie:44,"pouchdb-collate":52}],44:[function(a,b){"use strict";function c(a,b,c){i?Object.defineProperty(a,b,{value:c,configurable:!0,writable:!0}):a[b]=c}function d(a){return this instanceof d?(c(this,"successQueue",[]),c(this,"failureQueue",[]),c(this,"resolved",!1),void("function"==typeof a&&this.resolvePassed(a))):new d(a)}function e(a,b,c){c&&"function"==typeof c.then?c.then(a,b):a(c)}function f(a,b,c){function e(){var e=arguments[c];return"function"!=typeof e?a:new d(function(a,c){h(g,e,b,a,c)})}return e}function g(a,b,c,d){try{e(c,d,a(b))}catch(f){d(f)}}var h=a("immediate"),i=!1;!function(){try{Object.defineProperty({},"test",{value:!0}),i=!0}catch(a){}}(),c(d.prototype,"resolvePassed",function(a){try{a(this.fulfillUnwrap.bind(this),this.reject.bind(this))}catch(b){this.reject(b)}}),c(d.prototype,"reject",function(a){this.resolve(!1,a)}),c(d.prototype,"fulfill",function(a){this.resolve(!0,a)}),c(d.prototype,"fulfillUnwrap",function(a){e(this.fulfill.bind(this),this.reject.bind(this),a)}),d.prototype.then=function(a,b){return this.resolved?this.resolved(a,b):this.pending(a,b)},function(){try{d.prototype["catch"]=function(a){return this.then(null,a)}}catch(a){}}(),c(d.prototype,"pending",function(a,b){var c=this;return new d(function(d,e){c.successQueue.push("function"==typeof a?{resolve:d,reject:e,callback:a}:{next:d,callback:!1}),c.failureQueue.push("function"==typeof b?{resolve:d,reject:e,callback:b}:{next:e,callback:!1})})}),c(d.prototype,"resolve",function(a,b){if(!this.resolved){this.resolved=f(this,b,a?0:1);for(var c=a?this.successQueue:this.failureQueue,d=c.length,e=-1;++e<d;)c[e].callback?h(g,c[e].callback,b,c[e].resolve,c[e].reject):c[e].next(b)}}),b.exports=d},{immediate:46}],45:[function(a,b){b.exports=a(35)},{}],46:[function(a,b){b.exports=a(36)},{"./messageChannel":47,"./mutation":48,"./nextTick":45,"./postMessage":49,"./stateChange":50,"./timeout":51}],47:[function(a,b){b.exports=a(37)},{}],48:[function(a,b){b.exports=a(38)},{}],49:[function(a,b){b.exports=a(39)},{}],50:[function(a,b){b.exports=a(40)},{}],51:[function(a,b){b.exports=a(41)},{}],52:[function(a,b,c){"use strict";function d(a,b){for(var d=Math.min(a.length,b.length),e=0;d>e;e++){var f=c.collate(a[e],b[e]);if(0!==f)return f}return a.length===b.length?0:a.length>b.length?1:-1}function e(a,b){return a===b?0:a>b?1:-1}function f(a,b){for(var d=Object.keys(a),e=Object.keys(b),f=Math.min(d.length,e.length),g=0;f>g;g++){var h=c.collate(d[g],e[g]);if(0!==h)return h;if(h=c.collate(a[d[g]],b[e[g]]),0!==h)return h}return d.length===e.length?0:d.length>e.length?1:-1}function g(a){var b=["boolean","number","string","object"];return-1!==b.indexOf(typeof a)?null===a?1:b.indexOf(typeof a)+2:Array.isArray(a)?4.5:void 0}c.collate=function(a,b){a=c.normalizeKey(a),b=c.normalizeKey(b);var h=g(a),i=g(b);return h-i!==0?h-i:null===a?0:"number"==typeof a?a-b:"boolean"==typeof a?a===b?0:b>a?-1:1:"string"==typeof a?e(a,b):Array.isArray(a)?d(a,b):"object"==typeof a?f(a,b):void 0},c.normalizeKey=function(a){if("undefined"==typeof a)return null;if("number"==typeof a){if(1/0===a||a===-1/0||isNaN(a))return null}else if(a instanceof Date)return a.toJSON();return a}},{}],53:[function(a,b){b.exports={name:"pouchdb",version:"2.1.0",description:"PouchDB is a pocket-sized database.",release:"nightly",main:"./lib/index.js",homepage:"https://github.com/daleharvey/pouchdb",repository:"https://github.com/daleharvey/pouchdb",keywords:["db","couchdb","pouchdb"],tags:["db","couchdb","pouchdb"],dependencies:{bluebird:"~1.0.0",inherits:"~2.0.1","level-js":"~2.0.0","level-sublevel":"~5.2.0",leveldown:"~0.10.2",levelup:"~0.18.2",lie:"^2.6.0","pouchdb-mapreduce":"1.0.0",request:"~2.28.0"},devDependencies:{commander:"~2.1.0",watchify:"~0.4.1","uglify-js":"~2.4.6",jshint:"~2.3.0","http-proxy":"~0.10.3",corsproxy:"~0.2.13","http-server":"~0.5.5",browserify:"~3.24.13",wd:"~0.2.8",tin:"~0.4.0",mocha:"~1.17.1",chai:"~1.9.0",istanbul:"~0.2.4",ncp:"~0.5.0","sauce-connect-launcher":"0.2.2",less:"~1.7.0",bower:"~1.2.8"},scripts:{jshint:"jshint -c .jshintrc bin/ lib/ tests/*.js","build-js":"./bin/build-js.sh",build:"mkdir -p dist && npm run build-js","test-node":"./bin/run-mocha.sh","test-browser":"mkdir -p dist && npm run build-js && ./bin/test-browser.js",dev:"./bin/dev-server.js",test:"npm run jshint && ./bin/run-test.sh",publish:"./bin/publish.sh","publish-site":"./bin/publish-site.sh","build-site":"./bin/build-site.sh",shell:"./bin/repl.js","report-coverage":"./bin/run-coverage.js"},browser:{"./deps/buffer":!1,request:!1,leveldown:"level-js",bluebird:"lie"}}},{}]},{},[13])(13)}),function(a){"use strict";function b(){for(var a={},c=0;c<arguments.length;c++){var d=arguments[c];if("object"==typeof d)for(var e in d)a[e]="object"==typeof d[e]&&"object"==typeof a[e]?b(a[e]||{},d[e]):d[e]}return a}var c;c="object"==typeof exports?exports:a.BackbonePouch={};var d=a._;d||"function"!=typeof require||(d=require("underscore"));var e={create:"post",update:"put",patch:"put","delete":"remove"};c.defaults={fetch:"allDocs",listen:!1,options:{post:{},put:{},get:{},remove:{},allDocs:{},query:{},spatial:{},changes:{continuous:!0}}},c.sync=function(a){a=a||{},a=b(c.defaults,a);var f=function(c,f,g){function h(a,b){return a?g.error&&g.error(a):(("create"===c||"update"===c||"patch"===c)&&(b={_id:b.id,_rev:b.rev}),"delete"===c&&(b={}),"read"===c&&g.listen&&g.db.info(function(a,b){g.db.changes(d.extend({},g.options.changes,{since:b.update_seq,onChange:function(a){var b=f.get(a.id);a.deleted?b&&b.destroy():b?b.set(a.doc):f.add(a.doc),"function"==typeof g.options.changes.onChange&&g.options.changes.onChange(a)}}))}),g.success&&g.success(b))}if(g=g||{},g=b(a,f&&f.pouch||{},g),"string"!=typeof c)return g;if(!g.db)throw new Error('A "db" property must be specified');if(f.trigger("request",f,g.db,g),"read"===c){if(f.id)return g.db.get(f.id,g.options.get,h);if("query"===g.fetch||"spatial"===g.fetch){if(!g.options[g.fetch].fun)throw new Error('A "'+g.fetch+'.fun" object must be specified');return g.db[g.fetch](g.options[g.fetch].fun,g.options[g.fetch],h)}g.db[g.fetch](g.options[g.fetch],h)}else g.db[e[c]](f.toJSON(),g.options[e[c]],h);return g};return f.defaults=a,f},c.attachments=function(a){function b(b){if(b.pouch&&b.pouch.db)return b.pouch.db;if(b.collection&&b.collection.pouch&&b.collection.pouch.db)return b.collection.pouch.db;if(a.db)return a.db;var c=b.sync();if(c.db)return c.db;throw new Error('A "db" property must be specified')}return a=a||{},{attachments:function(a){var b=this.get("_attachments")||{};return a?d.filter(d.keys(b),function(c){return"function"==typeof a?a(c,b[c]):b[c].content_type.match(a)}):d.keys(b)},attachment:function(a,c){var d=b(this);return d.getAttachment(this.id,a,c)},attach:function(a,c,d,e){"function"==typeof c&&(e=c,c=void 0,d=void 0),"function"==typeof d&&(e=d,d=void 0),c=c||a.filename,d=d||a.type,this.id||this.set({_id:Math.uuid()},{silent:!0});var f=b(this),g=this;return f.putAttachment(this.id,c,this.get("_rev"),a,d,function(a,b){if(!a&&b.rev){var f=g.get("_attachments")||{};f[c]={content_type:d,stub:!0},g.set({_rev:b.rev,_attachments:f},{silent:!0})}e(a,b)})}}}}(this),Backbone.ChildViewContainer=function(a,b){var c=function(a){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),b.each(a,this.add,this)};b.extend(c.prototype,{add:function(a,b){var c=a.cid;return this._views[c]=a,a.model&&(this._indexByModel[a.model.cid]=c),b&&(this._indexByCustom[b]=c),this._updateLength(),this},findByModel:function(a){return this.findByModelCid(a.cid)},findByModelCid:function(a){var b=this._indexByModel[a];return this.findByCid(b)},findByCustom:function(a){var b=this._indexByCustom[a];return this.findByCid(b)},findByIndex:function(a){return b.values(this._views)[a]},findByCid:function(a){return this._views[a]},remove:function(a){var c=a.cid;return a.model&&delete this._indexByModel[a.model.cid],b.any(this._indexByCustom,function(a,b){return a===c?(delete this._indexByCustom[b],!0):void 0},this),delete this._views[c],this._updateLength(),this},call:function(a){this.apply(a,b.tail(arguments))},apply:function(a,c){b.each(this._views,function(d){b.isFunction(d[a])&&d[a].apply(d,c||[])})},_updateLength:function(){this.length=b.size(this._views)}});var d=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];return b.each(d,function(a){c.prototype[a]=function(){var c=b.values(this._views),d=[c].concat(b.toArray(arguments));return b[a].apply(b,d)}}),c}(Backbone,_),Backbone.Wreqr=function(a,b,c){"use strict";var d={};return d.Handlers=function(a,b){var c=function(a){this.options=a,this._wreqrHandlers={},b.isFunction(this.initialize)&&this.initialize(a)};return c.extend=a.Model.extend,b.extend(c.prototype,a.Events,{setHandlers:function(a){b.each(a,function(a,c){var d=null;b.isObject(a)&&!b.isFunction(a)&&(d=a.context,a=a.callback),this.setHandler(c,a,d)},this)},setHandler:function(a,b,c){var d={callback:b,context:c};this._wreqrHandlers[a]=d,this.trigger("handler:add",a,b,c)},hasHandler:function(a){return!!this._wreqrHandlers[a]},getHandler:function(a){var b=this._wreqrHandlers[a];if(!b)throw new Error("Handler not found for '"+a+"'");return function(){var a=Array.prototype.slice.apply(arguments);return b.callback.apply(b.context,a)}},removeHandler:function(a){delete this._wreqrHandlers[a]},removeAllHandlers:function(){this._wreqrHandlers={}}}),c}(a,c),d.CommandStorage=function(){var b=function(a){this.options=a,this._commands={},c.isFunction(this.initialize)&&this.initialize(a)};return c.extend(b.prototype,a.Events,{getCommands:function(a){var b=this._commands[a];return b||(b={command:a,instances:[]},this._commands[a]=b),b},addCommand:function(a,b){var c=this.getCommands(a);c.instances.push(b)},clearCommands:function(a){var b=this.getCommands(a);b.instances=[]}}),b}(),d.Commands=function(a){return a.Handlers.extend({storageType:a.CommandStorage,constructor:function(b){this.options=b||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this);var c=Array.prototype.slice.call(arguments);a.Handlers.prototype.constructor.apply(this,c)},execute:function(a,b){a=arguments[0],b=Array.prototype.slice.call(arguments,1),this.hasHandler(a)?this.getHandler(a).apply(this,b):this.storage.addCommand(a,b)},_executeCommands:function(a,b,d){var e=this.storage.getCommands(a);c.each(e.instances,function(a){b.apply(d,a)}),this.storage.clearCommands(a)},_initializeStorage:function(a){var b,d=a.storageType||this.storageType;b=c.isFunction(d)?new d:d,this.storage=b}})}(d),d.RequestResponse=function(a){return a.Handlers.extend({request:function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);return this.getHandler(a).apply(this,b)}})}(d),d.EventAggregator=function(a,b){var c=function(){};return c.extend=a.Model.extend,b.extend(c.prototype,a.Events),c}(a,c),d}(Backbone,Backbone.Marionette,_);var Marionette=function(a,b,c){"use strict";function d(a,b){var c=new Error(a);throw c.name=b||"Error",c}var e={};b.Marionette=e,e.$=b.$;var f=Array.prototype.slice;return e.extend=b.Model.extend,e.getOption=function(a,b){if(a&&b){var c;return c=a.options&&b in a.options&&void 0!==a.options[b]?a.options[b]:a[b]}},e.normalizeMethods=function(a){var b,d={};return c.each(a,function(a,e){b=a,c.isFunction(b)||(b=this[b]),b&&(d[e]=b)},this),d},e.normalizeUIKeys=function(a,b){return"undefined"!=typeof a?(c.each(c.keys(a),function(c){var d=/@ui.[a-zA-Z_$0-9]*/g;c.match(d)&&(a[c.replace(d,function(a){return b[a.slice(4)]})]=a[c],delete a[c])}),a):void 0},e.triggerMethod=function(){function a(a,b,c){return c.toUpperCase()}var b=/(^|:)(\w)/gi,d=function(d){var e="on"+d.replace(b,a),f=this[e];return c.isFunction(this.trigger)&&this.trigger.apply(this,arguments),c.isFunction(f)?f.apply(this,c.tail(arguments)):void 0};return d}(),e.MonitorDOMRefresh=function(a){function b(a){a._isShown=!0,e(a)}function d(a){a._isRendered=!0,e(a)}function e(a){a._isShown&&a._isRendered&&f(a)&&c.isFunction(a.triggerMethod)&&a.triggerMethod("dom:refresh")}function f(b){return a.contains(b.el)}return function(a){a.listenTo(a,"show",function(){b(a)}),a.listenTo(a,"render",function(){d(a)})}}(document.documentElement),function(a){function b(a,b,e,f){var g=f.split(/\s+/);c.each(g,function(c){var f=a[c];f||d("Method '"+c+"' was configured as an event handler, but does not exist."),a.listenTo(b,e,f)})}function e(a,b,c,d){a.listenTo(b,c,d)}function f(a,b,d,e){var f=e.split(/\s+/);c.each(f,function(c){var e=a[c];a.stopListening(b,d,e)})}function g(a,b,c,d){a.stopListening(b,c,d)}function h(a,b,d,e,f){b&&d&&(c.isFunction(d)&&(d=d.call(a)),c.each(d,function(d,g){c.isFunction(d)?e(a,b,g,d):f(a,b,g,d)}))}a.bindEntityEvents=function(a,c,d){h(a,c,d,e,b)},a.unbindEntityEvents=function(a,b,c){h(a,b,c,g,f)}}(e),e.Callbacks=function(){this._deferred=e.$.Deferred(),this._callbacks=[]},c.extend(e.Callbacks.prototype,{add:function(a,b){this._callbacks.push({cb:a,ctx:b}),this._deferred.done(function(c,d){b&&(c=b),a.call(c,d)})},run:function(a,b){this._deferred.resolve(b,a)},reset:function(){var a=this._callbacks;this._deferred=e.$.Deferred(),this._callbacks=[],c.each(a,function(a){this.add(a.cb,a.ctx)},this)}}),e.Controller=function(a){this.triggerMethod=e.triggerMethod,this.options=a||{},c.isFunction(this.initialize)&&this.initialize(this.options)},e.Controller.extend=e.extend,c.extend(e.Controller.prototype,b.Events,{close:function(){this.stopListening();var a=Array.prototype.slice.call(arguments);this.triggerMethod.apply(this,["close"].concat(a)),this.unbind()}}),e.Region=function(a){if(this.options=a||{},this.el=e.getOption(this,"el"),this.el||d("An 'el' must be specified for a region.","NoElError"),this.initialize){var b=Array.prototype.slice.apply(arguments);this.initialize.apply(this,b)}},c.extend(e.Region,{buildRegion:function(a,b){var e=c.isString(a),f=c.isString(a.selector),g=c.isUndefined(a.regionType),h=c.isFunction(a);h||e||f||d("Region must be specified as a Region type, a selector string or an object with selector property");var i,j;e&&(i=a),a.selector&&(i=a.selector,delete a.selector),h&&(j=a),!h&&g&&(j=b),a.regionType&&(j=a.regionType,delete a.regionType),(e||h)&&(a={}),a.el=i;var k=new j(a);return a.parentEl&&(k.getEl=function(b){var d=a.parentEl;return c.isFunction(d)&&(d=d()),d.find(b)}),k}}),c.extend(e.Region.prototype,b.Events,{show:function(a){this.ensureEl();var b=a.isClosed||c.isUndefined(a.$el),d=a!==this.currentView;d&&this.close(),a.render(),e.triggerMethod.call(this,"before:show",a),e.triggerMethod.call(a,"before:show"),(d||b)&&this.open(a),this.currentView=a,e.triggerMethod.call(this,"show",a),e.triggerMethod.call(a,"show")},ensureEl:function(){this.$el&&0!==this.$el.length||(this.$el=this.getEl(this.el))},getEl:function(a){return e.$(a)},open:function(a){this.$el.empty().append(a.el)},close:function(){var a=this.currentView;a&&!a.isClosed&&(a.close?a.close():a.remove&&a.remove(),e.triggerMethod.call(this,"close",a),delete this.currentView)},attachView:function(a){this.currentView=a},reset:function(){this.close(),delete this.$el}}),e.Region.extend=e.extend,e.RegionManager=function(a){var b=a.Controller.extend({constructor:function(b){this._regions={},a.Controller.prototype.constructor.call(this,b)},addRegions:function(a,b){var d={};return c.each(a,function(a,e){c.isString(a)&&(a={selector:a}),a.selector&&(a=c.defaults({},a,b));var f=this.addRegion(e,a);d[e]=f},this),d},addRegion:function(b,d){var e,f=c.isObject(d),g=c.isString(d),h=!!d.selector;return e=g||f&&h?a.Region.buildRegion(d,a.Region):c.isFunction(d)?a.Region.buildRegion(d,a.Region):d,this._store(b,e),this.triggerMethod("region:add",b,e),e},get:function(a){return this._regions[a]},removeRegion:function(a){var b=this._regions[a];this._remove(a,b)},removeRegions:function(){c.each(this._regions,function(a,b){this._remove(b,a)},this)},closeRegions:function(){c.each(this._regions,function(a){a.close()},this)},close:function(){this.removeRegions(),a.Controller.prototype.close.apply(this,arguments)},_store:function(a,b){this._regions[a]=b,this._setLength()},_remove:function(a,b){b.close(),delete this._regions[a],this._setLength(),this.triggerMethod("region:remove",a,b)},_setLength:function(){this.length=c.size(this._regions)}}),d=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];return c.each(d,function(a){b.prototype[a]=function(){var b=c.values(this._regions),d=[b].concat(c.toArray(arguments));return c[a].apply(c,d)}}),b}(e),e.TemplateCache=function(a){this.templateId=a},c.extend(e.TemplateCache,{templateCaches:{},get:function(a){var b=this.templateCaches[a];return b||(b=new e.TemplateCache(a),this.templateCaches[a]=b),b.load()},clear:function(){var a,b=f.call(arguments),c=b.length;if(c>0)for(a=0;c>a;a++)delete this.templateCaches[b[a]];else this.templateCaches={}}}),c.extend(e.TemplateCache.prototype,{load:function(){if(this.compiledTemplate)return this.compiledTemplate;var a=this.loadTemplate(this.templateId);return this.compiledTemplate=this.compileTemplate(a),this.compiledTemplate},loadTemplate:function(a){var b=e.$(a).html();return b&&0!==b.length||d("Could not find template: '"+a+"'","NoTemplateError"),b},compileTemplate:function(a){return c.template(a)}}),e.Renderer={render:function(a,b){a||d("Cannot render the template since it's false, null or undefined.","TemplateNotFoundError");var c;return(c="function"==typeof a?a:e.TemplateCache.get(a))(b)}},e.View=b.View.extend({constructor:function(a){c.bindAll(this,"render"),c.isObject(this.behaviors)&&new e.Behaviors(this),this.options=c.extend({},c.result(this,"options"),c.isFunction(a)?a.call(this):a),this.events=this.normalizeUIKeys(c.result(this,"events")),b.View.prototype.constructor.apply(this,arguments),e.MonitorDOMRefresh(this),this.listenTo(this,"show",this.onShowCalled)},triggerMethod:e.triggerMethod,normalizeMethods:e.normalizeMethods,getTemplate:function(){return e.getOption(this,"template")},mixinTemplateHelpers:function(a){a=a||{};var b=e.getOption(this,"templateHelpers");return c.isFunction(b)&&(b=b.call(this)),c.extend(a,b)
},normalizeUIKeys:function(a){var b=c.result(this,"ui");return e.normalizeUIKeys(a,b)},configureTriggers:function(){if(this.triggers){var a={},b=this.normalizeUIKeys(c.result(this,"triggers"));return c.each(b,function(b,d){var e=c.isObject(b),f=e?b.event:b;a[d]=function(a){if(a){var c=a.preventDefault,d=a.stopPropagation,g=e?b.preventDefault:c,h=e?b.stopPropagation:d;g&&c&&c.apply(a),h&&d&&d.apply(a)}var i={view:this,model:this.model,collection:this.collection};this.triggerMethod(f,i)}},this),a}},delegateEvents:function(a){this._delegateDOMEvents(a),e.bindEntityEvents(this,this.model,e.getOption(this,"modelEvents")),e.bindEntityEvents(this,this.collection,e.getOption(this,"collectionEvents"))},_delegateDOMEvents:function(a){a=a||this.events,c.isFunction(a)&&(a=a.call(this));var d={},e=c.result(this,"behaviorEvents")||{},f=this.configureTriggers();c.extend(d,e,a,f),b.View.prototype.delegateEvents.call(this,d)},undelegateEvents:function(){var a=Array.prototype.slice.call(arguments);b.View.prototype.undelegateEvents.apply(this,a),e.unbindEntityEvents(this,this.model,e.getOption(this,"modelEvents")),e.unbindEntityEvents(this,this.collection,e.getOption(this,"collectionEvents"))},onShowCalled:function(){},close:function(){if(!this.isClosed){var a=Array.prototype.slice.call(arguments),b=this.triggerMethod.apply(this,["before:close"].concat(a));b!==!1&&(this.isClosed=!0,this.triggerMethod.apply(this,["close"].concat(a)),this.unbindUIElements(),this.remove())}},bindUIElements:function(){if(this.ui){this._uiBindings||(this._uiBindings=this.ui);var a=c.result(this,"_uiBindings");this.ui={},c.each(c.keys(a),function(b){var c=a[b];this.ui[b]=this.$(c)},this)}},unbindUIElements:function(){this.ui&&this._uiBindings&&(c.each(this.ui,function(a,b){delete this.ui[b]},this),this.ui=this._uiBindings,delete this._uiBindings)}}),e.ItemView=e.View.extend({constructor:function(){e.View.prototype.constructor.apply(this,arguments)},serializeData:function(){var a={};return this.model?a=this.model.toJSON():this.collection&&(a={items:this.collection.toJSON()}),a},render:function(){this.isClosed=!1,this.triggerMethod("before:render",this),this.triggerMethod("item:before:render",this);var a=this.serializeData();a=this.mixinTemplateHelpers(a);var b=this.getTemplate(),c=e.Renderer.render(b,a);return this.$el.html(c),this.bindUIElements(),this.triggerMethod("render",this),this.triggerMethod("item:rendered",this),this},close:function(){this.isClosed||(this.triggerMethod("item:before:close"),e.View.prototype.close.apply(this,arguments),this.triggerMethod("item:closed"))}}),e.CollectionView=e.View.extend({itemViewEventPrefix:"itemview",constructor:function(){this._initChildViewStorage(),e.View.prototype.constructor.apply(this,arguments),this._initialEvents(),this.initRenderBuffer()},initRenderBuffer:function(){this.elBuffer=document.createDocumentFragment(),this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer(),this.isBuffering=!0},endBuffering:function(){this.isBuffering=!1,this.appendBuffer(this,this.elBuffer),this._triggerShowBufferedChildren(),this.initRenderBuffer()},_triggerShowBufferedChildren:function(){this._isShown&&(c.each(this._bufferedChildren,function(a){e.triggerMethod.call(a,"show")}),this._bufferedChildren=[])},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this.addChildView),this.listenTo(this.collection,"remove",this.removeItemView),this.listenTo(this.collection,"reset",this.render))},addChildView:function(a){this.closeEmptyView();var b=this.getItemView(a),c=this.collection.indexOf(a);this.addItemView(a,b,c)},onShowCalled:function(){this.children.each(function(a){e.triggerMethod.call(a,"show")})},triggerBeforeRender:function(){this.triggerMethod("before:render",this),this.triggerMethod("collection:before:render",this)},triggerRendered:function(){this.triggerMethod("render",this),this.triggerMethod("collection:rendered",this)},render:function(){return this.isClosed=!1,this.triggerBeforeRender(),this._renderChildren(),this.triggerRendered(),this},_renderChildren:function(){this.startBuffering(),this.closeEmptyView(),this.closeChildren(),this.isEmpty(this.collection)?this.showEmptyView():this.showCollection(),this.endBuffering()},showCollection:function(){var a;this.collection.each(function(b,c){a=this.getItemView(b),this.addItemView(b,a,c)},this)},showEmptyView:function(){var a=this.getEmptyView();if(a&&!this._showingEmptyView){this._showingEmptyView=!0;var c=new b.Model;this.addItemView(c,a,0)}},closeEmptyView:function(){this._showingEmptyView&&(this.closeChildren(),delete this._showingEmptyView)},getEmptyView:function(){return e.getOption(this,"emptyView")},getItemView:function(){var a=e.getOption(this,"itemView");return a||d("An `itemView` must be specified","NoItemViewError"),a},addItemView:function(a,b,d){var f=e.getOption(this,"itemViewOptions");c.isFunction(f)&&(f=f.call(this,a,d));var g=this.buildItemView(a,b,f);return this.addChildViewEventForwarding(g),this.triggerMethod("before:item:added",g),this.children.add(g),this.renderItemView(g,d),this._isShown&&!this.isBuffering&&e.triggerMethod.call(g,"show"),this.triggerMethod("after:item:added",g),g},addChildViewEventForwarding:function(a){var b=e.getOption(this,"itemViewEventPrefix");this.listenTo(a,"all",function(){var d=f.call(arguments),g=d[0],h=this.normalizeMethods(this.getItemEvents());d[0]=b+":"+g,d.splice(1,0,a),"undefined"!=typeof h&&c.isFunction(h[g])&&h[g].apply(this,d),e.triggerMethod.apply(this,d)},this)},getItemEvents:function(){return c.isFunction(this.itemEvents)?this.itemEvents.call(this):this.itemEvents},renderItemView:function(a,b){a.render(),this.appendHtml(this,a,b)},buildItemView:function(a,b,d){var e=c.extend({model:a},d);return new b(e)},removeItemView:function(a){var b=this.children.findByModel(a);this.removeChildView(b),this.checkEmpty()},removeChildView:function(a){a&&(this.stopListening(a),a.close?a.close():a.remove&&a.remove(),this.children.remove(a)),this.triggerMethod("item:removed",a)},isEmpty:function(){return!this.collection||0===this.collection.length},checkEmpty:function(){this.isEmpty(this.collection)&&this.showEmptyView()},appendBuffer:function(a,b){a.$el.append(b)},appendHtml:function(a,b){a.isBuffering?(a.elBuffer.appendChild(b.el),a._bufferedChildren.push(b)):a.$el.append(b.el)},_initChildViewStorage:function(){this.children=new b.ChildViewContainer},close:function(){this.isClosed||(this.triggerMethod("collection:before:close"),this.closeChildren(),this.triggerMethod("collection:closed"),e.View.prototype.close.apply(this,arguments))},closeChildren:function(){this.children.each(function(a){this.removeChildView(a)},this),this.checkEmpty()}}),e.CompositeView=e.CollectionView.extend({constructor:function(){e.CollectionView.prototype.constructor.apply(this,arguments)},_initialEvents:function(){this.once("render",function(){this.collection&&(this.listenTo(this.collection,"add",this.addChildView),this.listenTo(this.collection,"remove",this.removeItemView),this.listenTo(this.collection,"reset",this._renderChildren))})},getItemView:function(){var a=e.getOption(this,"itemView")||this.constructor;return a||d("An `itemView` must be specified","NoItemViewError"),a},serializeData:function(){var a={};return this.model&&(a=this.model.toJSON()),a},render:function(){this.isRendered=!0,this.isClosed=!1,this.resetItemViewContainer(),this.triggerBeforeRender();var a=this.renderModel();return this.$el.html(a),this.bindUIElements(),this.triggerMethod("composite:model:rendered"),this._renderChildren(),this.triggerMethod("composite:rendered"),this.triggerRendered(),this},_renderChildren:function(){this.isRendered&&(this.triggerMethod("composite:collection:before:render"),e.CollectionView.prototype._renderChildren.call(this),this.triggerMethod("composite:collection:rendered"))},renderModel:function(){var a={};a=this.serializeData(),a=this.mixinTemplateHelpers(a);var b=this.getTemplate();return e.Renderer.render(b,a)},appendBuffer:function(a,b){var c=this.getItemViewContainer(a);c.append(b)},appendHtml:function(a,b){if(a.isBuffering)a.elBuffer.appendChild(b.el),a._bufferedChildren.push(b);else{var c=this.getItemViewContainer(a);c.append(b.el)}},getItemViewContainer:function(a){if("$itemViewContainer"in a)return a.$itemViewContainer;var b,f=e.getOption(a,"itemViewContainer");if(f){var g=c.isFunction(f)?f.call(this):f;b=a.$(g),b.length<=0&&d("The specified `itemViewContainer` was not found: "+a.itemViewContainer,"ItemViewContainerMissingError")}else b=a.$el;return a.$itemViewContainer=b,b},resetItemViewContainer:function(){this.$itemViewContainer&&delete this.$itemViewContainer}}),e.Layout=e.ItemView.extend({regionType:e.Region,constructor:function(a){a=a||{},this._firstRender=!0,this._initializeRegions(a),e.ItemView.prototype.constructor.call(this,a)},render:function(){return this.isClosed&&this._initializeRegions(),this._firstRender?this._firstRender=!1:this.isClosed||this._reInitializeRegions(),e.ItemView.prototype.render.apply(this,arguments)},close:function(){this.isClosed||(this.regionManager.close(),e.ItemView.prototype.close.apply(this,arguments))},addRegion:function(a,b){var c={};return c[a]=b,this._buildRegions(c)[a]},addRegions:function(a){return this.regions=c.extend({},this.regions,a),this._buildRegions(a)},removeRegion:function(a){return delete this.regions[a],this.regionManager.removeRegion(a)},_buildRegions:function(a){var b=this,c={regionType:e.getOption(this,"regionType"),parentEl:function(){return b.$el}};return this.regionManager.addRegions(a,c)},_initializeRegions:function(a){var b;this._initRegionManager(),b=c.isFunction(this.regions)?this.regions(a):this.regions||{},this.addRegions(b)},_reInitializeRegions:function(){this.regionManager.closeRegions(),this.regionManager.each(function(a){a.reset()})},_initRegionManager:function(){this.regionManager=new e.RegionManager,this.listenTo(this.regionManager,"region:add",function(a,b){this[a]=b,this.trigger("region:add",a,b)}),this.listenTo(this.regionManager,"region:remove",function(a,b){delete this[a],this.trigger("region:remove",a,b)})}}),e.Behavior=function(a,b){function c(b,c){this.view=c,this.defaults=a.result(this,"defaults")||{},this.options=a.extend({},this.defaults,b),this.$=function(){return this.view.$.apply(this.view,arguments)},this.initialize.apply(this,arguments)}return a.extend(c.prototype,{initialize:function(){},triggerMethod:e.triggerMethod}),a.extend(c,{extend:b.View.extend}),c}(c,b),e.Behaviors=function(a,b){function c(a){this.behaviors=c.parseBehaviors(a,a.behaviors),c.wrap(a,this.behaviors,["bindUIElements","unbindUIElements","delegateEvents","undelegateEvents","onShow","onClose","behaviorEvents","triggerMethod","setElement"])}var d={setElement:function(a,c){a.apply(this,b.tail(arguments,2)),b.each(c,function(a){a.$el=this.$el},this)},onShow:function(c,d){var e=b.tail(arguments,2);b.each(d,function(b){a.triggerMethod.apply(b,["show"].concat(e))}),b.isFunction(c)&&c.apply(this,e)},onClose:function(c,d){var e=b.tail(arguments,2);b.each(d,function(b){a.triggerMethod.apply(b,["close"].concat(e))}),b.isFunction(c)&&c.apply(this,e)},bindUIElements:function(a,c){a.apply(this),b.invoke(c,a)},unbindUIElements:function(a,c){a.apply(this),b.invoke(c,a)},triggerMethod:function(a,c){var d=b.tail(arguments,2);a.apply(this,d),b.each(c,function(b){a.apply(b,d)})},delegateEvents:function(c,d){var e=b.tail(arguments,2);c.apply(this,e),b.each(d,function(b){a.bindEntityEvents(this,this.model,a.getOption(b,"modelEvents")),a.bindEntityEvents(this,this.collection,a.getOption(b,"collectionEvents"))},this)},undelegateEvents:function(c,d){var e=b.tail(arguments,2);c.apply(this,e),b.each(d,function(b){a.unbindEntityEvents(this,this.model,a.getOption(b,"modelEvents")),a.unbindEntityEvents(this,this.collection,a.getOption(b,"collectionEvents"))},this)},behaviorEvents:function(c,d){var e={},f=b.result(this,"ui");return b.each(d,function(c,d){var g={},h=b.result(c,"events")||{},i=b.result(c,"ui"),j=b.extend({},f,i);h=a.normalizeUIKeys(h,j),b.each(b.keys(h),function(a){var e=new Array(d+2).join(" "),f=a+e,i=b.isFunction(h[a])?h[a]:c[h[a]];g[f]=b.bind(i,c)}),e=b.extend(e,g)}),e}};return b.extend(c,{behaviorsLookup:function(){throw new Error("You must define where your behaviors are stored. See https://github.com/marionettejs/backbone.marionette/blob/master/docs/marionette.behaviors.md#behaviorslookup")},getBehaviorClass:function(a,d){return a.behaviorClass?a.behaviorClass:b.isFunction(c.behaviorsLookup)?c.behaviorsLookup.apply(this,arguments)[d]:c.behaviorsLookup[d]},parseBehaviors:function(a,d){return b.map(d,function(b,d){var e=c.getBehaviorClass(b,d);return new e(b,a)})},wrap:function(a,c,e){b.each(e,function(e){a[e]=b.partial(d[e],a[e],c)})}}),c}(e,c),e.AppRouter=b.Router.extend({constructor:function(a){b.Router.prototype.constructor.apply(this,arguments),this.options=a||{};var c=e.getOption(this,"appRoutes"),d=this._getController();this.processAppRoutes(d,c)},appRoute:function(a,b){var c=this._getController();this._addAppRoute(c,a,b)},processAppRoutes:function(a,b){if(b){var d=c.keys(b).reverse();c.each(d,function(c){this._addAppRoute(a,c,b[c])},this)}},_getController:function(){return e.getOption(this,"controller")},_addAppRoute:function(a,b,e){var f=a[e];f||d("Method '"+e+"' was not found on the controller"),this.route(b,e,c.bind(f,a))}}),e.Application=function(a){this._initRegionManager(),this._initCallbacks=new e.Callbacks,this.vent=new b.Wreqr.EventAggregator,this.commands=new b.Wreqr.Commands,this.reqres=new b.Wreqr.RequestResponse,this.submodules={},c.extend(this,a),this.triggerMethod=e.triggerMethod},c.extend(e.Application.prototype,b.Events,{execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(a){this._initCallbacks.add(a)},start:function(a){this.triggerMethod("initialize:before",a),this._initCallbacks.run(a,this),this.triggerMethod("initialize:after",a),this.triggerMethod("start",a)},addRegions:function(a){return this._regionManager.addRegions(a)},closeRegions:function(){this._regionManager.closeRegions()},removeRegion:function(a){this._regionManager.removeRegion(a)},getRegion:function(a){return this._regionManager.get(a)},module:function(a,b){var c=e.Module.getClass(b),d=f.call(arguments);return d.unshift(this),c.create.apply(c,d)},_initRegionManager:function(){this._regionManager=new e.RegionManager,this.listenTo(this._regionManager,"region:add",function(a,b){this[a]=b}),this.listenTo(this._regionManager,"region:remove",function(a){delete this[a]})}}),e.Application.extend=e.extend,e.Module=function(a,b,d){this.moduleName=a,this.options=c.extend({},this.options,d),this.initialize=d.initialize||this.initialize,this.submodules={},this._setupInitializersAndFinalizers(),this.app=b,this.startWithParent=!0,this.triggerMethod=e.triggerMethod,c.isFunction(this.initialize)&&this.initialize(this.options,a,b)},e.Module.extend=e.extend,c.extend(e.Module.prototype,b.Events,{initialize:function(){},addInitializer:function(a){this._initializerCallbacks.add(a)},addFinalizer:function(a){this._finalizerCallbacks.add(a)},start:function(a){this._isInitialized||(c.each(this.submodules,function(b){b.startWithParent&&b.start(a)}),this.triggerMethod("before:start",a),this._initializerCallbacks.run(a,this),this._isInitialized=!0,this.triggerMethod("start",a))},stop:function(){this._isInitialized&&(this._isInitialized=!1,e.triggerMethod.call(this,"before:stop"),c.each(this.submodules,function(a){a.stop()}),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),e.triggerMethod.call(this,"stop"))},addDefinition:function(a,b){this._runModuleDefinition(a,b)},_runModuleDefinition:function(a,d){if(a){var f=c.flatten([this,this.app,b,e,e.$,c,d]);a.apply(this,f)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new e.Callbacks,this._finalizerCallbacks=new e.Callbacks}}),c.extend(e.Module,{create:function(a,b,d){var e=a,g=f.call(arguments);g.splice(0,3),b=b.split(".");var h=b.length,i=[];return i[h-1]=d,c.each(b,function(b,c){var f=e;e=this._getModule(f,b,a,d),this._addModuleDefinition(f,e,i[c],g)},this),e},_getModule:function(a,b,d,e){var f=c.extend({},e),g=this.getClass(e),h=a[b];return h||(h=new g(b,d,f),a[b]=h,a.submodules[b]=h),h},getClass:function(a){var b=e.Module;return a?a.prototype instanceof b?a:a.moduleClass||b:b},_addModuleDefinition:function(a,b,c,d){var e=this._getDefine(c),f=this._getStartWithParent(c,b);e&&b.addDefinition(e,d),this._addStartWithParent(a,b,f)},_getStartWithParent:function(a,b){var d;return c.isFunction(a)&&a.prototype instanceof e.Module?(d=b.constructor.prototype.startWithParent,c.isUndefined(d)?!0:d):c.isObject(a)?(d=a.startWithParent,c.isUndefined(d)?!0:d):!0},_getDefine:function(a){return!c.isFunction(a)||a.prototype instanceof e.Module?c.isObject(a)?a.define:null:a},_addStartWithParent:function(a,b,c){b.startWithParent=b.startWithParent&&c,b.startWithParent&&!b.startWithParentIsConfigured&&(b.startWithParentIsConfigured=!0,a.addInitializer(function(a){b.startWithParent&&b.start(a)}))}}),e}(this,Backbone,_);!function(){"use strict";window.NeuronalSynchrony=new Backbone.Marionette.Application,NeuronalSynchrony.Models={},NeuronalSynchrony.Collections={},NeuronalSynchrony.Views={},NeuronalSynchrony.Routers={},NeuronalSynchrony.Layouts={},NeuronalSynchrony.currentBar=0,NeuronalSynchrony.mute_metronome=!0;var a=$("#bpmChosen");return NeuronalSynchrony.bpm=a.html(),NeuronalSynchrony.init=function(){console.log("Hello from Backbone!")},NeuronalSynchrony.addRegions({headerRegion:"header",mainRegion:"#content",creditsRegion:"#credits",seqPanelRegion:"#sequencer_panel"}),NeuronalSynchrony.addInitializer(function(){Backbone.history.start()}),NeuronalSynchrony.sessionName=Date.now(),console.log("NeuronalSynchrony.sessionName: "+NeuronalSynchrony.sessionName),Backbone.sync=BackbonePouch.sync({db:PouchDB("SEQdb")}),Backbone.Model.prototype.idAttribute="_id",NeuronalSynchrony.signature=4,NeuronalSynchrony.context="undefined"==typeof AudioContext?new webkitAudioContext:new AudioContext,NeuronalSynchrony.clock=new WAAClock(NeuronalSynchrony.context,{toleranceEarly:.1}),NeuronalSynchrony}(),$(document).ready(function(){"use strict";NeuronalSynchrony.init(),NeuronalSynchrony.MainMenuView=new NeuronalSynchrony.Views.MainMenuView,NeuronalSynchrony.creditsRegion.show(NeuronalSynchrony.MainMenuView),NeuronalSynchrony.Song=new NeuronalSynchrony.Collections.SongCollection,NeuronalSynchrony.SequencerLayout=new NeuronalSynchrony.Layouts.SequencerLayout,NeuronalSynchrony.SequencerPanel=new NeuronalSynchrony.Views.SequencerPanelView,NeuronalSynchrony.MainMenuView.loadSequencePanel()}),function(){var a,b=this,c=(b.Sound||{},[]);b.addEventListener("load",function(){b.AudioContext=b.AudioContext||b.webkitAudioContext,d._ready=!0;try{d.ctx=a=new b.AudioContext,d.has=!0,_.each(c,function(a){a.call(d)})}catch(e){delete d.ctx,d.has=!1}c.length=0},!1);var d=b.Sound=function(a,b){d.get(a,_.bind(function(a){this.buffer=a,this._ready=!0,_.isFunction(b)&&b.call(this),this.trigger("load")},this))};_.extend(d,{_ready:!1,ready:function(a){return d._ready?void a.call(d):void c.push(a)},noConflict:function(){return b.Sound=previousAudio,this},get:function(b,c){var d=new XMLHttpRequest;d.open("GET",b,!0),d.responseType="arraybuffer",d.onload=function(){a.decodeAudioData(d.response,function(a){_.isFunction(c)&&c(a)},function(a){console.log("Error loading",b,a)})},d.send()}}),_.extend(d.prototype,Backbone.Events,{stop:function(b){if(!this.source)return this;var c=_.defaults(b||{},{time:a.currentTime});return this.source.stop(c.time),this},pause:function(){},play:function(b){var c=_.defaults(b||{},{time:a.currentTime,loop:!1});return this.source=a.createBufferSource(),this.source.buffer=this.buffer,this.source.connect(a.destination),this.source.loop=c.loop,_.isFunction(this.source.start)?this.source.start(c.time):_.isFunction(this.source.noteOn)&&this.source.noteOn(c.time),this}})}();var animationRatio=url.int("resolution",100)/100,two=new Two({type:has.mobile&&has.iOS||!has.mobile&&has.Firefox?Two.Types.canvas:Two.Types.svg}).appendTo(document.querySelector("#content"));two.renderer.domElement.id="stage";var TWO_PI=2*Math.PI;window.animations=function(){var b=document.querySelector("#content"),c=two.renderer.domElement,d=$(window).width(),e=$(window).height(),f={x:d/2,y:e/2},g=d>e?e:d,h=1e3,j=.125,k={},l=3,m=3,n=3;two.renderer.setSize(d,e,animationRatio);var o=TWEEN.Easing,p=["background","middleground","foreground","highlight","accent","white","black"],q=[{background:{r:181,g:181,b:181},middleground:{r:141,g:164,b:170},foreground:{r:227,g:79,b:12},highlight:{r:163,g:141,b:116},accent:{r:255,g:197,b:215},white:{r:255,g:255,b:255},black:{r:0,g:0,b:0},isDark:!1},{background:{r:255,g:230,b:255},middleground:{r:151,g:41,b:164},foreground:{r:1,g:120,b:186},highlight:{r:255,g:255,b:0},accent:{r:255,g:51,b:148},white:{r:255,g:255,b:255},black:{r:255,g:255,b:255},isDark:!1},{background:{r:217,g:82,b:31},middleground:{r:143,g:74,b:45},foreground:{r:255,g:108,b:87},highlight:{r:255,g:126,b:138},accent:{r:227,g:190,b:141},white:{r:255,g:255,b:255},black:{r:0,g:0,b:0},isDark:!1},{background:{r:57,g:109,b:193},middleground:{r:186,g:60,b:223},foreground:{r:213,g:255,b:93},highlight:{r:213,g:160,b:255},accent:{r:36,g:221,b:165},white:{r:215,g:236,b:255},black:{r:0,g:0,b:0},isDark:!0},{background:{r:255,g:244,b:211},middleground:{r:207,g:145,b:79},foreground:{r:38,g:83,b:122},highlight:{r:178,g:87,b:53},accent:{r:235,g:192,b:92},white:{r:226,g:82,b:87},black:{r:0,g:0,b:0},isDark:!1},{background:{r:39,g:6,b:54},middleground:{r:69,g:26,b:87},foreground:{r:252,g:25,b:246},highlight:{r:52,g:255,b:253},accent:{r:133,g:102,b:193},white:{r:253,g:228,b:252},black:{r:255,g:255,b:255},isDark:!0}],r=url.int("palette",0),s={},t={};_.each(q[r],function(a,b){s[b]=_.clone(a),t[b]=toRGB(a)}),t.getRandomKey=function(){return p[Math.floor(Math.random()*p.length)]},c.style.background=t.background;!function(){function a(){i.visible=!1,c=!1,e=Math.random()>.5,e?(i.translation.set(-f.x,f.y),p.x=1.5*d):(i.translation.set(1.5*d,f.y),p.x=-f.x),n.x=f.x,q.stop(),r.stop()}var b=_.identity,c=!1,e=!0,g=[new Two.Anchor(-f.x,-f.y),new Two.Anchor(f.x,-f.y),new Two.Anchor(f.x,f.y),new Two.Anchor(-f.x,f.y)],i=two.makePolygon(g);i.fill=t.middleground,i.noStroke();var j=function(a,d){c=!0,i.visible=!0,q.start(),!d&&s.sound&&s.sound.stop().play(),_.isFunction(a)&&(b=a)};j.onComplete=a;var l=function(){i.fill=t.middleground},m=function(){g[0].set(-f.x,-f.y),g[1].set(f.x,-f.y),g[2].set(f.x,f.y),g[3].set(-f.x,f.y)},n={x:f.x},p={x:1.5*d},q=new TWEEN.Tween(i.translation).to(n,.5*h).easing(o.Exponential.Out).onComplete(function(){r.start()}),r=new TWEEN.Tween(i.translation).to(p,.5*h).easing(o.Exponential.In).onComplete(function(){j.onComplete(),b()});a();var s={start:j,update:l,resize:m,clear:a,playing:function(){return c},hash:"2,1",filename:"wipe"};return k[s.hash]=s,s}(),function(){function a(){i.visible=!1,c=!1,d=Math.random()>.5,d?(i.translation.set(f.x,-f.y),p.y=1.5*e):(i.translation.set(f.x,1.5*e),p.y=-f.y),n.y=f.y,q.stop(),r.stop()}var b=_.identity,c=!1,d=!0,g=[new Two.Anchor(-f.x,-f.y),new Two.Anchor(f.x,-f.y),new Two.Anchor(f.x,f.y),new Two.Anchor(-f.x,f.y)],i=two.makePolygon(g);i.fill=t.highlight,i.noStroke();var j=function(a,d){c=!0,i.visible=!0,q.start(),!d&&s.sound&&s.sound.stop().play(),_.isFunction(a)&&(b=a)};j.onComplete=a;var l=function(){i.fill=t.highlight},m=function(){g[0].set(-f.x,-f.y),g[1].set(f.x,-f.y),g[2].set(f.x,f.y),g[3].set(-f.x,f.y)},n={y:f.y},p={y:0},q=new TWEEN.Tween(i.translation).to(n,.5*h).easing(o.Exponential.Out).onComplete(function(){r.start()}),r=new TWEEN.Tween(i.translation).to(p,.5*h).easing(o.Exponential.In).onComplete(function(){j.onComplete(),b()});a();var s={start:j,update:l,resize:m,clear:a,playing:function(){return c},hash:"1,1",filename:"veil"};return k[s.hash]=s,s}();_.each(_.range(m),function(a){!function(){function b(){p.visible=!1,q.ending=p.scale=0,j=!1,x.stop()}var c=Math.floor(1.5*a)+3,d=100,e=2,g=10,i=_.identity,j=!1,l=[],m=_.map(_.range(c),function(a){var b=a/c,f=TWO_PI*b,g=d*Math.cos(f),h=d*Math.sin(f),i=two.makeCircle(g,h,e);return i.fill=t.black,i.noStroke(),l.push(i),new Two.Anchor(g,h)}),n=two.makePolygon(m);n.stroke=t.black,n.noFill(),n.linewidth=.5;var p=two.makeGroup(n).add(l);p.translation.set(f.x,f.y);var q={ending:0},r=function(a,b){p.visible=!0,x.start(),!b&&y.sound&&y.sound.stop().play(),_.isFunction(a)&&(i=a)};r.onComplete=b;var s,u,v=function(){for(n.stroke=t.black,a=0,u=l.length;u>a;a++)s=l[a],s.fill=t.black},w=function(){p.translation.set(f.x,f.y)},x=new TWEEN.Tween(q).to({ending:1},.75*h).easing(o.Circular.In).onStart(function(){j=!0}).onUpdate(function(){p.scale=q.ending*g}).onComplete(function(){r.onComplete(),i()});b();var y={start:r,update:v,clear:b,resize:w,playing:function(){return j},hash:a+",6",filename:"prism-"+(a+1)};return k[y.hash]=y,y}()});!function(){function a(){m.visible=!1,impact=new Two.Vector(Math.random()*d,Math.random()*e);var a,b,h=8*Math.random();for(h>7?(a=f.x,b=0):h>6?(a=0,b=0):h>5?(a=0,b=f.y):h>4?(a=0,b=e):h>3?(a=f.x,b=e):h>2?(a=d,b=e):h>1?(a=d,b=f.y):(a=d,b=0),m.translation.set(a,b),A.ending=0,i=e,q=0;g>q;q++)p=l[q],pct=q/g,x=pct*TWO_PI,p.set(i*Math.cos(x),i*Math.sin(x)),w=angleBetween(p,impact)-x,r=p.distanceTo(impact),v=10*i/Math.sqrt(r),a=v*Math.cos(w)+p.x,b=v*Math.sin(w)+p.y,j[q].set(a,b);c=!1,B.stop()}var b=_.identity,c=!1,g=8*Math.floor(Math.random())+8,i=(d*Math.random(),e*Math.random(),e),j=(Math.PI/2,[]),l=_.map(_.range(g),function(a){var b=a/g,c=TWO_PI*b,d=i*Math.sin(c),e=i*Math.cos(c);return j.push(new Two.Vector(d,e)),new Two.Anchor(d,e)}),m=two.makeCurve(l);m.fill=t.middleground,m.noStroke(),l=m.vertices;var n=function(a,c){m.visible=!0,B.start(),!c&&C.sound&&C.sound.stop().play(),_.isFunction(a)&&(b=a)};n.onComplete=a;var p,q,r,s,u,v,w,x,y=function(){m.fill=t.middleground},z=function(){},A={ending:0},B=new TWEEN.Tween(A).to({ending:1},.75*h).easing(o.Circular.In).onStart(function(){c=!0}).onUpdate(function(){var a=A.ending;for(q=0;g>q;q++)p=l[q],r=j[q],s=lerp(p.x,r.x,a),u=lerp(p.y,r.y,a),p.set(s,u)}).onComplete(function(){n.onComplete(),b()});a();var C={start:n,update:y,clear:a,resize:z,playing:function(){return c},hash:"0,1",filename:"clay"};return k[C.hash]=C,C}();_.each(_.range(l),function(a){!function(){function b(){q.beginning=q.ending=0;var b=Math.random()>.5?!0:!1;for(b?(c=-l/2,e=l/2):(c=l/2,e=-l/2),a=0;j>a;a++)u=p[a],p.visible=!1,v=u.vertices,v[0].x=v[1].x=v[2].x=v[3].x=c;g=!1,y.stop(),z.stop()}var c,e,g=!1,i=_.identity,j=4*a+1,l=.75*d,m=f.y,n=two.makeGroup();n.translation.copy(f);var p=_.map(_.range(j),function(a){var b=m/j-m/(3*j),c=0,d=-m/2+(a+1)*(m/(j+1)),e=two.makeRectangle(c,d,l,b);return e.fill=t.white,e.noStroke(),n.add(e),e}),q={ending:0,beginning:0},r=function(a){a.visible=!0},s=function(a,b){_.each(p,r),y.start(),!b&&A.sound&&A.sound.stop().play(),_.isFunction(a)&&(i=a)};s.onComplete=b;var u,v,w=function(){for(a=0;j>a;a++)p[a].fill=t.white},x=function(){l=.75*d,m=f.y,n.translation.copy(f)},y=new TWEEN.Tween(q).to({ending:1},.125*h).easing(o.Sinusoidal.Out).onStart(function(){g=!0}).onUpdate(function(){for(a=0;j>a;a++)u=p[a],v=u.vertices,v[3].x=v[0].x=e*q.ending}).onComplete(function(){z.start()}),z=new TWEEN.Tween(q).to({beginning:1},.125*h).easing(o.Sinusoidal.Out).onUpdate(function(){for(a=0;j>a;a++)u=p[a],v=u.vertices,v[1].x=v[2].x=e*q.beginning}).onComplete(function(){s.onComplete(),i()}),A={start:s,update:w,clear:b,resize:x,playing:function(){return g},hash:a+",3",filename:"piston-"+(a+1)};return k[A.hash]=A,b(),A}()}),_.each(_.range(n),function(a){!function(){var b,c=!1,g=_.identity,i=two.makeRectangle(f.x,f.y,d,e);i.noStroke().fill=t[p[p.length-1-a%p.length]],i.visible=!1;var j=function(a,d){_.isUndefined(b)||(clearTimeout(b),b=void 0),c=!0,!d&&n.sound&&n.sound.stop().play(),b=setTimeout(function(){c=!1,g(),i.visible=!1},.25*h),_.isFunction(a)&&(g=a)},l=function(){i.fill=t[p[p.length-1-a%p.length]]},m=function(){var a=i.vertices;a[0].set(-f.x,-f.y),a[1].set(f.x,-f.y),a[2].set(f.x,f.y),a[3].set(-f.x,f.y),i.translation.copy(f)};two.bind("update",function(){c&&(i.visible=Math.random()>.5)});var n={start:j,update:l,clear:_.identity,resize:m,playing:function(){return c},hash:a+",0",filename:"flash-"+(a+1)};return k[n.hash]=n,n}()});var u=(function(){function a(){_.each(l,x),n.rotation=Math.random()*TWO_PI,n.scale=1,w.to({rotation:n.rotation+Math.PI/8,scale:2*Math.random()+10},2*h).stop(),b=!1}var b=!1,c=_.identity,d=120,e=g/(2*d),i=4,j=g/2,l=_.map(_.range(d),function(a){var b=a/d,c=j*b,f=b*Math.PI*i,g=c*Math.cos(f),h=c*Math.sin(f);b=(a+.25)/d,c=j*b,f=b*Math.PI*i;var k=c*Math.cos(f),l=c*Math.sin(f),m=two.makeLine(g,h,k,l);return m.stroke=t.black,m.linewidth=(1-Math.sqrt(1-b))*e,m.cap=m.join="round",m}),m=function(a,b){var c=b/d;a.linewidth=Math.sqrt(1-c)*e};l.reverse();var n=two.makeGroup(l);n.translation.set(f.x,f.y);var p=function(a,b){w.start(),!b&&y.sound&&y.sound.stop().play(),_.isFunction(a)&&(c=a)};p.onComplete=a;var q,r,s,u=function(){n.stroke=t.black},v=function(){n.translation.set(f.x,f.y),e=g/d,_.each(l,m)},w=new TWEEN.Tween(n).onStart(function(){b=!0}).easing(o.Circular.In).to({rotation:Math.PI/8,scale:8},2*h).onUpdate(function(a){for(r=Math.min(map(a,0,.25,0,1),1),s=Math.floor(r*d),q=0;s>q;q++)l[q].visible=!0}).onComplete(function(){p.onComplete(),c()}),x=function(a){a.visible=!1};a();var y={start:p,update:u,clear:a,resize:v,playing:function(){return b},hash:"0,9",filename:"dotted-spiral"};return k[y.hash]=y,y}(),function(){function b(){for(c=Math.random()*TWO_PI,d=map(Math.random(),0,1,Math.PI/4,Math.PI/2),D.ending=0,u=0;l>u;u++)v=r[u],x=c+Math.random()*d*2-d,a=Math.random()*p,z=a*Math.cos(x),A=a*Math.sin(x),q[u].set(z,A),v.visible=!1,v.translation.set(0,0);i=!1,E.stop()}var c,d,i=!1,j=_.identity,l=16,m=12*g/900,n=20*g/900,p=e,q=[],r=_.map(_.range(l),function(){var a=Math.round(map(Math.random(),0,1,m,n)),b=two.makeCircle(0,0,a);return b.fill=t.white,b.noStroke(),q.push(new Two.Vector),b}),s=two.makeGroup(r);s.translation.set(f.x,f.y);var u,v,w=function(a,b){for(u=0;l>u;u++)r[u].visible=!0;E.start(),!b&&F.sound&&F.sound.stop().play(),_.isFunction(a)&&(j=a)};w.onComplete=b;var x,y,z,A,B=function(){s.fill=t.white},C=function(){s.translation.set(f.x,f.y)},D={ending:0},E=new TWEEN.Tween(D).to({ending:1},.5*h).easing(o.Sinusoidal.Out).onStart(function(){i=!0}).onUpdate(function(){for(x=D.ending,u=0;l>u;u++)v=r[u],y=q[u],z=lerp(v.translation.x,y.x,x),A=lerp(v.translation.y,y.y,x),v.translation.set(z,A)}).onComplete(function(){w.onComplete(),j()});b();var F={start:w,update:B,clear:b,resize:C,playing:function(){return i},hash:"0,5",filename:"suspension"};return k[F.hash]=F,F}(),function(){function a(){var a,g,h=4*Math.random();for(h>3?(a=-d/8,g=f.y):h>2?(a=1.125*d,g=f.y):h>1?(a=f.x,g=-e/8):(a=f.x,g=1.125*e),v.translation.set(a,g),b=Math.atan2(f.y-g,f.x-a),c=Math.PI/2,H.ending=0,i=0;m>i;i++)C=u[i],y=b+Math.random()*c*2-c,D=Math.random()*r,A=D*Math.cos(y),B=D*Math.sin(y),s[i].set(A,B),C.visible=!1,C.translation.set(0,0);j=!1,I.stop()}var b,c,j=!1,l=_.identity,m=32,n=12*g/900,q=20*g/900,r=d,s=[],u=_.map(_.range(m),function(){var a=Math.round(map(Math.random(),0,1,n,q)),b=two.makeCircle(0,0,a);return b.property=p[Math.floor(Math.random()*p.length)],b.fill=t[b.property],b.noStroke(),s.push(new Two.Vector),b}),v=two.makeGroup(u),w=function(a){a.visible=!0},x=function(a,b){_.each(u,w),I.start(),!b&&J.sound&&J.sound.stop().play(),_.isFunction(a)&&(l=a)};x.onComplete=a;var y,z,A,B,C,D,E=function(a){a.fill=t[a.property]},F=function(){_.each(u,E)},G=function(){v.translation.set(f.x,f.y)},H={ending:0},I=new TWEEN.Tween(H).to({ending:1},.5*h).easing(o.Sinusoidal.Out).onStart(function(){j=!0}).onUpdate(function(){for(y=H.ending,i=0;m>i;i++)C=u[i],z=s[i],A=lerp(C.translation.x,z.x,y),B=lerp(C.translation.y,z.y,y),C.translation.set(A,B)
}).onComplete(function(){x.onComplete(),l()});a();var J={start:x,update:F,clear:a,resize:G,playing:function(){return j},hash:"2,5",filename:"confetti"};return k[J.hash]=J,J}(),function(){function a(){direction=Math.random()>.5,j.visible=!1,j.rotation=TWO_PI*Math.random(),q.ending=q.beginning=0,j.ending=j.beginning=direction?0:1,c=!1,r.stop(),s.stop()}var b=_.identity,c=!1,d=32,e=g/3,i=_.map(_.range(d),function(a){var b=a/(d-1),c=b*TWO_PI,f=e*Math.cos(c),g=e*Math.sin(c);return new Two.Anchor(f,g)});i.push(i[0].clone(),i[1].clone());var j=two.makeCurve(i,!0);j.stroke=t.highlight,j.cap="butt",j.linewidth=g/10,j.noFill(),j.translation.set(f.x,f.y);var l=function(a,c){j.visible=!0,r.start(),!c&&u.sound&&u.sound.stop().play(),_.isFunction(a)&&(b=a)};l.onComplete=a;var m=function(a,b){var c=b/d,f=c*TWO_PI,g=e*Math.cos(f),h=e*Math.sin(f);a.set(g,h)},n=function(){j.stroke=t.highlight},p=function(){j.translation.set(f.x,f.y),e=g/3,j.linewidth=g/10,_.each(i,m)},q={beginning:0,ending:0},r=new TWEEN.Tween(q).to({ending:1},h/3).easing(o.Sinusoidal.Out).onUpdate(function(){direction?j.ending=q.ending:j.beginning=1-q.ending}).onStart(function(){c=!0}).onComplete(function(){s.start()}),s=new TWEEN.Tween(q).to({beginning:1},h/3).easing(o.Sinusoidal.In).onUpdate(function(){direction?j.beginning=q.beginning:j.ending=1-q.beginning}).onComplete(function(){l.onComplete(),b()});a();var u={start:l,update:n,clear:a,resize:p,playing:function(){return c},hash:"0,4",filename:"timer"};return k[u.hash]=u,u}(),function(){function a(){j.visible=!1;var a=Math.random()>.5,b=Math.random()>.5;j.translation.x=a?.75*d:.25*d,j.origin=j.translation.y=b?-f.y:1.5*e,j.destination.y=f.y,j.scale=1,p.stop(),q.stop()}var b=!1,c=_.identity,i=.25*g,j=two.makeCircle(0,0,i);j.noStroke().fill=t.accent;var l=function(a,d){b=!0,p.start(),j.visible=!0,!d&&r.sound&&r.sound.stop().play(),_.isFunction(a)&&(c=a)};l.onComplete=a;var m=function(){j.fill=t.accent},n=function(){i=.25*g};j.destination={y:f.y};var p=new TWEEN.Tween(j.translation).to(j.destination,h/2).easing(o.Circular.Out).onComplete(function(){q.start()}),q=new TWEEN.Tween(j).to({scale:0},h/2).easing(o.Circular.Out).onComplete(function(){b=!1,l.onComplete(),c()});a();var r={resize:n,update:m,clear:a,start:l,playing:function(){return b},hash:"1,2",filename:"ufo"};return k[r.hash]=r,r}(),function(){function a(){b=!1,r.ending=r.beginning=0,q.visible=!1,q.rotation=Math.random()*TWO_PI,n.translation.copy(n.origin),p.translation.copy(p.origin),q.opacity=1,w.stop(),x.stop()}var b=!1,c=_.identity,d=25,i=d-1,j=.33*g,l=e/6,m=_.map(_.range(d),function(a){var b=a/i,c=b*Math.PI,d=j*Math.cos(c),e=j*Math.sin(c);return new Two.Anchor(d,e)}),n=two.makePolygon(m);n.origin=(new Two.Vector).copy(n.translation),m=_.map(_.range(d),function(a){var b=a/i,c=b*Math.PI+Math.PI,d=j*Math.cos(c),e=j*Math.sin(c);return new Two.Anchor(d,e)});var p=two.makePolygon(m);p.origin=(new Two.Vector).copy(p.translation);var q=two.makeGroup(n,p);q.fill=q.stroke=t.foreground,q.translation.set(f.x,f.y);var r={ending:0,beginning:0},s=function(a,d){b=!0,w.start(),!d&&y.sound&&y.sound.stop().play(),_.isFunction(a)&&(c=a)};s.onComplete=a;var u=function(){q.fill=q.stroke=t.foreground},v=function(){j=.33*g,l=e/6,q.translation.set(f.x,f.y)},w=new TWEEN.Tween(r).to({ending:1},.5*h).easing(o.Circular.In).onUpdate(function(a){q.visible=Math.random()<a}).onComplete(function(){q.visible=!0,x.start()}),x=new TWEEN.Tween(r).to({beginning:1},.5*h).easing(o.Circular.Out).delay(.5*h).onUpdate(function(a){n.translation.y=ease(n.translation.y,n.origin.y+l,.3),p.translation.y=ease(p.translation.y,p.origin.y-l,.3),q.opacity=1-a}).onComplete(function(){s.onComplete(),c()});a();var y={start:s,update:u,clear:a,resize:v,playing:function(){return b},hash:"2,2",filename:"splits"};return k[y.hash]=y,y}(),function(){function a(){for(m.visible=!1,m.rotation=Math.random()*TWO_PI,n.beginning=n.ending=0,q=0;d>q;q++)r=l[q],v=q/(d-1),w=v*TWO_PI,s=i*Math.cos(w),u=i*Math.sin(w),j[q].x=s,j[q].y=u,r.set(s,Math.abs(u));b=!1,z.stop(),A.stop()}var b=!1,c=_.identity,d=42,e=d/2,i=.33*g,j=[],l=[];_.each(_.range(d),function(a){var b=a/(d-1),c=b*TWO_PI,e=i*Math.cos(c),f=i*Math.sin(c);j.push({x:e,y:f}),l.push(new Two.Anchor(e,f))});var m=two.makePolygon(l);m.translation.set(f.x,f.y),m.fill=t.foreground,m.noStroke();var n={ending:0,beginning:0},p=function(a,b){m.visible=!0,z.start(),!b&&B.sound&&B.sound.stop().play(),_.isFunction(a)&&(c=a)};p.onComplete=a;var q,r,s,u,v,w,x=function(){m.fill=t.foreground},y=function(){i=.33*g,m.translation.set(f.x,f.y)},z=new TWEEN.Tween(n).to({ending:1},h/2).easing(o.Sinusoidal.Out).onUpdate(function(a){for(q=e;d>q;q++)l[q].y=lerp(l[q].y,j[q].y,a)}).onStart(function(){b=!0}).onComplete(function(){A.start()}),A=new TWEEN.Tween(n).to({beginning:1},h/2).easing(o.Sinusoidal.Out).onUpdate(function(a){for(q=0;e>q;q++)l[q].y=lerp(l[q].y,negate(j[q].y),a)}).onComplete(function(){p.onComplete(),c()});a();var B={start:p,update:x,clear:a,resize:y,playing:function(){return b},hash:"0,2",filename:"moon"};return k[B.hash]=B,B}(),function(){function a(){for(b=!1,p=Math.random(),m.linewidth=Math.round(7*p)+3,j=Math.round(map(p,0,1,.5*e,d)),q=Math.random()*TWO_PI,A.x=j*Math.cos(q),A.y=j*Math.sin(q),q+=Math.PI,B.x=j*Math.cos(q),B.y=j*Math.sin(q),m.ending=m.beginning=0,m.visible=!1,s=0;i>s;s++)u=l[s],r=s/(i-1),u.x=lerp(A.x,B.x,r),u.y=lerp(A.y,B.y,r);x.stop(),y.stop()}var b=!1,c=_.identity,i=32,j=.5*g,l=_.map(_.range(i),function(){return new Two.Anchor}),m=two.makePolygon(l,!0);m.noFill().stroke=t.black,m.translation.set(f.x,f.y),m.cap="round";var n=function(a,d){m.visible=!0,b=!0,x.start(),!d&&z.sound&&z.sound.stop().play(),_.isFunction(a)&&(c=a)};n.onComplete=a;var p,q,r,s,u,v=function(){m.translation.set(f.x,f.y)},w=function(){m.stroke=t.black},x=new TWEEN.Tween(m).to({ending:1},.25*h).easing(o.Circular.In).onComplete(function(){y.start()}),y=new TWEEN.Tween(m).to({beginning:1},.25*h).easing(o.Circular.Out).onComplete(function(){n.onComplete(),c()}),z={start:n,update:w,clear:a,resize:v,playing:function(){return b},hash:"1,5",filename:"strike"},A={x:0,y:0},B={x:0,y:0};return a(),k[z.hash]=z,z}(),function(){function a(){for(Math.random()>.5?q.translation.set(.85*d,f.y):q.translation.set(.15*d,f.y),q.visible=!1,z=4*Math.random(),l=z>3?5:z>2?4:z>1?2:1,n=Math.PI/2,q.rotation=Math.random()>.5?Math.PI:0,x=0,q.beginning=q.ending=0,s=0;i>s;s++)u=p[s],v=s/i,w=Math.abs((2*(v*TWO_PI*l+n)/Math.PI-1)%4-2)-1,x=w*j/2,y=map(v,0,1,-m/2,m/2),u.set(x,y);b=!1,C.stop(),D.stop()}var b=!1,c=_.identity,i=120,j=d/16,l=6,m=.66*e,n=.5*Math.PI,p=_.map(_.range(i),function(a){var b=a/i,c=TWO_PI*l*b+n,d=j*Math.sin(c),e=map(b,0,1,-m/2,m/2);return new Two.Anchor(d,e)}),q=two.makePolygon(p,!0);q.stroke=t.black,q.linewidth=g/30,q.noFill(),q.join="miter",q.miter=4,q.cap="butt";var r=function(a,b){q.visible=!0,C.start(),!b&&E.sound&&E.sound.stop().play(),_.isFunction(a)&&(c=a)};r.onComplete=a;var s,u,v,w,x,y,z,A=function(){q.stroke=t.black},B=function(){j=d/16,m=.66*e},C=new TWEEN.Tween(q).to({ending:1},.25*h).easing(o.Sinusoidal.Out).onStart(function(){b=!0}).onComplete(function(){D.start()}),D=new TWEEN.Tween(q).to({beginning:1},.25*h).easing(o.Sinusoidal.Out).onComplete(function(){r.onComplete(),c()});a();var E={start:r,update:A,clear:a,resize:B,playing:function(){return b},hash:"1,8",filename:"zig-zag"};return k[E.hash]=E,E}(),function(){function a(){for(p.visible=!1,j=Math.round(6*Math.random())+1,m=Math.PI/2,p.rotation=Math.random()>.5?Math.PI:0,p.ending=p.beginning=0,r=0;d>r;r++)s=n[r],u=r/d,v=TWO_PI*j*u+m,w=map(u,0,1,-i/2,i/2),x=l*Math.sin(v),s.set(w,x);b=!1,A.stop(),B.stop()}var b=!1,c=_.identity,d=200,i=f.x,j=6,l=.33*e,m=.5*Math.PI,n=_.map(_.range(d),function(a){var b=a/d,c=TWO_PI*j*b+m,e=map(b,0,1,-i/2,i/2),f=l*Math.sin(c);return new Two.Anchor(e,f)}),p=two.makePolygon(n,!0);p.translation.set(f.x,f.y),p.stroke=t.accent,p.linewidth=g/40,p.cap=p.join="round",p.noFill();var q=function(a,d){p.visible=!0,b=!0,A.start(),!d&&C.sound&&C.sound.stop().play(),_.isFunction(a)&&(c=a)};q.onComplete=a;var r,s,u,v,w,x,y=function(){p.stroke=t.accent},z=function(){i=f.x,l=.33*e,p.linewidth=g/40,p.translation.set(f.x,f.y)},A=new TWEEN.Tween(p).to({ending:1},h/2).easing(o.Sinusoidal.Out).onComplete(function(){B.start()}),B=new TWEEN.Tween(p).to({beginning:1},h/2).easing(o.Sinusoidal.In).onComplete(function(){q.onComplete(),c()});a();var C={start:q,update:y,clear:a,resize:z,playing:function(){return b},hash:"0,7",filename:"squiggle"};return k[C.hash]=C,C}(),function(){function a(){for(n=Math.random()>.5,p.visible=!1,p.rotation=TWO_PI*Math.random(),c=!1,i=0;d>i;i++)x=o[i],x.theta=0,x.translation.set(e,0),A[i].stop(),B[i].stop()}var b=_.identity,c=!1,d=24,e=.33*g,j=d-1,l=.2*h,m=10*g/900,n=!0,o=_.map(_.range(d),function(a){var b=a/j,c=b*TWO_PI,d=(e*Math.cos(c),e*Math.sin(c),two.makeCircle(e,0,m));return d.theta=0,d.destination=c,d}),p=two.makeGroup(o);p.noStroke().fill=t.black,p.translation.set(f.x,f.y);var q=function(a,d){c=!0,A[0].start(),!d&&C.sound&&C.sound.stop().play(),_.isFunction(a)&&(b=a)};q.onComplete=a;var r,s,u,v,w,x,y=function(){p.fill=t.black},z=function(){p.translation.set(f.x,f.y),e=.33*g},A=_.map(o,function(a,b){return new TWEEN.Tween(a).to({theta:a.destination},l/(b+1)).onStart(function(){a.visible=!0}).onUpdate(function(){r=n?a.theta:-a.theta,s=e*Math.cos(r),u=e*Math.sin(r),a.translation.set(s,u)}).onComplete(function(){return b>=j?void B[0].start():(v=o[b+1],w=A[b+1],v.theta=a.theta,v.translation.copy(a.translation),void w.start())})}),B=_.map(o,function(a,c){return v=o[c+1],v=v?v.destination:TWO_PI,new TWEEN.Tween(a).to({theta:v},l/(d-(c+1))).onUpdate(function(){r=n?a.theta:-a.theta,s=e*Math.cos(r),u=e*Math.sin(r),a.translation.set(s,u)}).onComplete(function(){return a.visible=!1,c>=j-1?(b(),void q.onComplete()):void(w=B[c+1].start())})});a();var C={start:q,update:y,clear:a,resize:z,playing:function(){return c},hash:"1,4",filename:"bubbles"};return k[C.hash]=C,C}(),function(){function a(){for(n=Math.random()>.5,p.visible=!1,p.rotation=TWO_PI*Math.random(),c=!1,y=0;d>y;y++)x=o[y],x.theta=0,x.translation.set(i,0),B[y].stop(),C[y].stop()}var b=_.identity,c=!1,d=32,i=.45*g,j=d-1,l=.1*h,m=12*e/900,n=!0,o=_.map(_.range(d),function(a){var b=a/j,c=b*TWO_PI,d=(i*Math.cos(c),i*Math.sin(c),makeTriangle(i,0,m));return d.theta=0,d.destination=c,d}),p=two.makeGroup(o);p.noStroke().fill=t.white,p.translation.set(f.x,f.y);var q=function(a,d){c=!0,B[0].start(),!d&&D.sound&&D.sound.stop().play(),_.isFunction(a)&&(b=a)};q.onComplete=a;var r,s,u,v,w,x,y,z=function(){p.fill=t.white},A=function(){p.translation.set(f.x,f.y),i=.45*g},B=_.map(o,function(a,b){return new TWEEN.Tween(a).to({theta:a.destination},l/(b+1)).onStart(function(){a.visible=!0}).onUpdate(function(){r=n?a.theta:-a.theta,s=i*Math.cos(r),u=i*Math.sin(r),a.translation.set(s,u),a.rotation=r}).onComplete(function(){return b>=j?void C[0].start():(v=o[b+1],w=B[b+1],v.theta=a.theta,v.translation.copy(a.translation),void w.start())})}),C=_.map(o,function(a,c){return v=o[c+1],v=v?v.destination:TWO_PI,new TWEEN.Tween(a).to({theta:v},l/(d-(c+1))).onUpdate(function(){r=n?a.theta:-a.theta,s=i*Math.cos(r),u=i*Math.sin(r),a.translation.set(s,u),a.rotation=r}).onComplete(function(){return a.visible=!1,c>=j-1?(b(),void q.onComplete()):void(w=C[c+1].start())})});a();var D={start:q,update:z,clear:a,resize:A,playing:function(){return c},hash:"2,4",filename:"corona"};return k[D.hash]=D,D}(),function(){function a(){for(p.visible=!1,p.rotation=Math.random()*TWO_PI,q=0,r=n.length;r>q;q++)z=n[q],A=q/d,B=j,C=i*Math.cos(B),D=i*Math.sin(B),z.set(C,D);p.scale=1,p._update(),E.stop(),_.each(x,F)}var b=!1,c=_.identity,d=8,g=h/(d+2),i=e/5,j=0,l=TWO_PI,m=Math.random()*TWO_PI,n=_.map(_.range(d),function(){return new Two.Anchor}),p=two.makePolygon(n);p.fill=t.highlight,p.noStroke(),p.translation.set(f.x,f.y);var q,r,s,u=function(a,d){for(b=!0,p.visible=!0,q=0,r=x[0].length;r>q;q++)s=x[0][q],s.start();!d&&H.sound&&H.sound.stop().play(),_.isFunction(a)&&(c=a)};u.onComplete=a;var v=function(){p.fill=t.highlight},w=function(){i=e/6,p.translation.set(f.x,f.y)},x=[],y=function(a){a.start()};_.each(_.range(d),function(a){var b=a+1,c=Math.PI*(b/d),e=[];_.each(_.range(d),function(a){var d=Math.min(a/b,1),f=d*l+j+c+m,h=n[a],k=i*Math.cos(f),p=i*Math.sin(f),q=new TWEEN.Tween(h).to({x:k,y:p},g).easing(o.Sinusoidal.Out);e.push(q)});var f=e[0];f.onComplete(function(){var a=x[b];return _.isArray(a)?void _.each(a,y):void E.start()}),x.push(e)});var z,A,B,C,D,E=new TWEEN.Tween(p).to({scale:0},g).easing(o.Sinusoidal.Out).onComplete(function(){u.onComplete(),c(),b=!1}),F=function(a){_.each(a,G)},G=function(a){a.stop()};a();var H={start:u,update:v,clear:a,resize:w,playing:function(){return b},hash:"1,7",filename:"pinwheel"};return k[H.hash]=H,H}(),function(){function a(){for(p=0;g>p;p++)q=m[p],s=TWO_PI*Math.random(),u=Math.random()*f.y*Math.cos(s),v=Math.random()*f.y*Math.sin(s),q.translation.set(u,v),q.visible=!1,q.scale=0,q.linewidth=q.__linewidth,q.tween.stop();c=!1}var b,c=!1,d=_.identity,g=12,i=20*e/900,j=40*e/900,l=0,m=_.map(_.range(g),function(a){var c=Math.round(map(Math.random(),0,1,i,j)),d=Math.random()*h*.5,e=two.makeCircle(0,0,c);return e.key=t.getRandomKey(),e.stroke=t[e.key],e.noFill(),e.__linewidth=20*Math.random()+40,e.tween=new TWEEN.Tween(e).to({scale:1,linewidth:0},.2*h).easing(o.Sinusoidal.Out).delay(d).onComplete(function(){e.visible=!1}),d>l&&(l=d,b=a),e});m[b].tween.onComplete(function(){m[b].visible=!1,r.onComplete(),d()});var n=two.makeGroup(m);n.translation.set(f.x,f.y);var p,q,r=function(a,b){for(c=!0,p=0;g>p;p++)q=m[p],q.visible=!0,q.tween.start();!b&&y.sound&&y.sound.stop().play(),_.isFunction(a)&&(d=a)};r.onComplete=a;var s,u,v,w=function(){for(p=0;g>p;p++)m[p].stroke=t[m[p].key]},x=function(){n.translation.set(f.x,f.y)};a();var y={start:r,update:w,clear:a,resize:x,playing:function(){return c},hash:"0,8",filename:"glimmer"};return k[y.hash]=y,y}(),function(a){a.resize&&a.resize()});$(window).bind("resize",function(){var a=b.getBoundingClientRect();two.renderer.setSize(a.width,a.height,animationRatio),two.width=a.width,two.height=a.height,d=two.width,e=two.height,f.x=d/2,f.y=e/2,g=d>e?e:d,_.each(animations.map,u)});var v=!0,w={};w.start=function(a){r=(r+1)%q.length,_.each(J.list,F),v=!1,_.isFunction(a)&&(w.callback=a)},w.hash="3,",w.callback=_.identity,w.playing=function(){return!v},w.onComplete=function(){w.callback()},w.clear=_.identity,_.each(_.range(8),function(a){k[w.hash+a]=w}),k["2,7"]=w;var x,y,z,A,B,C,D,E,F=function(a){_.isArray(a.sounds)&&(a.sound=a.sounds[r%a.sounds.length])},G=function(a){_.isFunction(a.update)&&a.update()},H=function(a){y=0;for(D in s)E=s[D],z=a[D],E.r=z.r,E.g=z.g,E.b=z.b,y++,t[D]=toRGB(E);return y},I=function(a){y=0;for(D in s)E=s[D],z=a[D],A=E.r,B=E.g,C=E.b,colorsEqual(z,E)&&y++,E.r=ease(A,z.r,j),E.g=ease(B,z.g,j),E.b=ease(C,z.b,j),t[D]=toRGB(E);return y},J={initializeSound:function(){return _.each(J.list,F),J},update:function(){return v?J:(x=q[r],y=has.mobile?H(x):I(x),_.each(J.list,G),c.style.background=t.background,y>=q.length&&(v||(v=!0,w.onComplete())),J)},map:k,list:_.toArray(k),getColorPalette:function(){return q[r]}};return J}(),$(function(){function a(){for(var a=0;a<e.length;a++){for(;e[a].intervals.length>0;)interval=e[a].intervals.shift(),clearInterval(interval);e.shift()}}Duloop={};var b=!1,c=120,d=$("#bpmChosen");c=d.html();var e=[],f=!1;Duloop.onKeyDown=function(d){var e=$("#bpmChosen");if(8==d.which)return a(),f=!1,!1;if(f)return f=!1,!1;if(b){if("bpm"===d.target.id)return!1;if(9==d.which||91==d.which)return!1;c=e.html(),console.log("Current bpm: "+c+"at NeuronalSynchrony.beatCount: "+NeuronalSynchrony.beatCount),NeuronalSynchrony.startBeat("graphics",NeuronalSynchrony.beatCount,d.which,!1)}},Duloop.simulateKeypress=function(a){var b=jQuery.Event("keydown");b.which=a,f=!0,$(window).trigger(b)},$(window).on("keydown",Duloop.onKeyDown),$("#lp_recpause").bind("click",{},function(a){$("#lp_stop").show(),$("#new_seq_button").show(),b?(b=!1,$(a.target).attr("fill","#cccccc")):(b=!0,curpat={sec:2,intervals:[]},e.push(curpat),$(a.target).attr("fill","red"))}),$("#lp_stop").bind("click",{},function(){$("#lp_recpause circle").attr("fill","#cccccc"),b=!1,a()})}),$(function(){function a(){animations.initializeSound();var a=function(b){u.has(b.target).length||(u.fadeOut(function(){v=!1}),k.unbind("click",a))};$("#embed-button").click(function(b){b.preventDefault(),r.fadeOut(),x.fadeOut(),u.fadeIn(function(){v=!0,u.find("textarea").select(),k.bind("click",a)})});var c=!0;$("#merchandise-button").click(function(a){a.preventDefault(),c&&(x.css({opacity:1,display:"none",zIndex:0}),c=!1),r.fadeOut(),u.fadeOut(),x.fadeIn(function(){v=!0})}),$("#close-merchandise").click(function(a){a.preventDefault(),v=!1,x.fadeOut()}),k=$(window).bind("resize",function(a){n=k.width(),o=k.height(),d(a)}).bind("mousemove",function(a){has.mobile||v||(t.set(a.clientX,a.clientY),j())}).bind("touchstart touchmove touchend touchcancel",function(a){return a.preventDefault(),!1}).bind("keydown",function(a,b){if(!a.metaKey&&!a.ctrlKey){a.preventDefault();var c,d=a.which||b;switch(d){case 81:c="0,0";break;case 87:c="0,1";break;case 69:c="0,2";break;case 82:c="0,3";break;case 84:c="0,4";break;case 89:c="0,5";break;case 85:c="0,6";break;case 73:c="0,7";break;case 79:c="0,8";break;case 80:c="0,9";break;case 65:c="1,0";break;case 83:c="1,1";break;case 68:c="1,2";break;case 70:c="1,3";break;case 71:c="1,4";break;case 72:c="1,5";break;case 74:c="1,6";break;case 75:c="1,7";break;case 76:c="1,8";break;case 90:c="2,0";break;case 88:c="2,1";break;case 67:c="2,2";break;case 86:c="2,3";break;case 66:c="2,4";break;case 78:c="2,5";break;case 77:c="2,6";break;case 32:c="3,0"}g(c),i()}}),has.mobile?(r.find(".message").html("Press anywhere on the screen and turn up speakers"),b()):(s.css("display","block"),r.find(".message").html('Press any key, A to Z or spacebar, and turn up speakers. <br/>Sequencer:<ul style="text-align: left; margin: 1em"><li>To record/play a sequence, move the mouse in the lower area to reveal the menu.</li><li>Click the round grey button to record bars. </li><li>Click the play button to play bars.</li><li>Click the cabinet to record a new bar.</li><li>The metronome may be muted.</li></ul>')),two.bind("update",function(){TWEEN.update(),animations.update(),l&&(_.each(m.needsUpdate,e),l.update())}).play(),k.trigger("resize"),_.delay(function(){return $("#lobby").fadeOut(f),url.boolean("kiosk")||window.localStorage&&window.localStorage.visited?void i():(r.fadeIn(),void(window.localStorage&&(window.localStorage.visited=!0)))},1e3)}function b(){l=new Two({fullscreen:!0}).appendTo(q[0]),l.renderer.domElement.id="ui",m=[],m.width=m.height=32,m.needsUpdate={},m.map={},m[0]=_.map(_.range(10),c,l),m[1]=_.map(_.range(9),c,l),m[2]=_.map(_.range(8),c,l);l.update();var a,b,d,e,f,h,j,r=[],s=function(a,b){return e=m.length,p?(f=Math.min(Math.max(Math.floor(e*b/o),0),e-1),e=m[f].length,h=Math.min(Math.max(Math.floor(e*a/n),0),e-1)):(f=Math.min(Math.max(Math.floor(e*a/n),0),e-1),e=m[f].length,h=Math.min(Math.max(Math.floor(e*b/o),0),e-1)),f+","+h},t=function(a){b=a.clientX,d=a.clientY,r[a.identifier]={id:s(b,d,b,d),x:b,y:d}},u=function(a){b=a.clientX,d=a.clientY,j=s(b,d,r[a.identifier].x,r[a.identifier].y),r[a.identifier]&&r[a.identifier].id!==j&&(v(j,m.map[j]),r[a.identifier].id=j),r[a.identifier].x=b,r[a.identifier].y=d},v=function(a,b){g(a),i(),b.fill=animations.getColorPalette().isDark?"rgba(255, 255, 255, 0.3)":"rgba(0, 0, 0, 0.3)",b.opacity=1,m.needsUpdate[b.id]=b};k.bind("touchstart",function(b){a=b.originalEvent,_.each(a.touches,t)}).bind("touchmove",function(b){a=b.originalEvent,_.each(a.touches,u)}),_.each(m,function(b,c){_.each(b,function(b,d){var e=b._renderer.elem,f=c+","+d;m.map[f]=b,$(e).css({cursor:"pointer"}).bind("mousedown touchstart",function(c){a=c.originalEvent,v(f,b)})})})}function c(){var a=this.makeRectangle(0,0,m.width,m.height);return a.noFill().noStroke(),a.opacity=0,a.visible=!1,a}function d(){if(l){n=k.width(),o=k.height(),p=n>=o;var a=m.length;_.each(m,function(b,c){var d,e,f,g,h=b.length;p?(d=n/h,e=o/a):(d=n/a,e=o/h),b.width=d,b.height=e,d/=2,e/=2,_.each(b,function(b,i){var j=b.vertices;p?(f=n*(i+.5)/h,g=o*(c+.5)/a):(f=n*(c+.5)/a,g=o*(i+.5)/h),j[0].set(-d,-e),j[1].set(d,-e),j[2].set(d,e),j[3].set(-d,e),b.translation.set(f,g),b.visible=!0})})}}function e(a){a.opacity+=.2*-a.opacity,a.opacity<=.1&&(a.opacity=0,delete m.needsUpdate[a.id])}function f(){window.localStorage&&window.localStorage.visited||(g("0,9"),g("2,6"),g("1,7"),g("2,1"),window.localStorage&&(window.localStorage.visited=!0))}function g(a,b){var c=animations.map[a];c&&(c.playing()&&c.clear(),c.start(void 0,b))}function h(){if(E&&(clearTimeout(E),E=null),!w){var a=Math.floor(Math.random()*animations.list.length);g(animations.list[a].hash,!0),E=setTimeout(function(){requestAnimationFrame(h)},2e3)}}function i(){return url.boolean("kiosk")?(F(),void(w=!0)):(r.fadeOut(),void G())}function j(){q.css("top","-64px"),H()}var k,l,m,n,o,p,q=$("#content"),r=$("#hint"),s=$("#credits"),t=new Two.Vector,u=$("#embed"),v=!1,w=!1,x=$("#merchandise"),y=["A","B","C","D","E","F"],z="assets/",A=".mp3",B=0,C=$("#loaded");$("#total-assets").html(26*y.length);var D=_.after(26*y.length,function(){return url.loop&&url.loop.match(/(clap|groove)/gi)?(new Sound("assets/"+url.loop.replace(/\//gi,"")+"-loop"+A,function(){this.play({loop:!0})}),void a()):void a()});Sound.ready(function(){_.each(animations.list,function(a){a.filename&&(a.sounds=_.map(y,function(b){return new Sound(z+b+"/"+a.filename+A,function(){B++,C.html(B),D()})}))})});var E,F=_.debounce(function(){w=!1,h()},2e4),G=_.debounce(function(){return v?void G():void r.fadeIn()},2e4),H=_.debounce(function(){return t.y>o-64?void H():void q.css("top",0)},1e3)}),this.JST=this.JST||{},this.JST["app/scripts/templates/BarView.hbs"]=Handlebars.template(function(a,b,c,d,e){function f(a,b){var c,d="";return d+=j((c=b,c=null==c||c===!1?c:c.index,typeof c===i?c.apply(a):c))+":"+j(typeof a===i?a.apply(a):a)+","}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,h="",i="function",j=this.escapeExpression,k=this;return h+='<td class="playBar">',g=c.each.call(b,b.beatAssets,{hash:{},inverse:k.noop,fn:k.program(1,f,e),data:e}),(g||0===g)&&(h+=g),h+='</td>\n<td class="deleteBar">[x]</td>'}),this.JST["app/scripts/templates/MainMenuView.hbs"]=Handlebars.template(function(a,b,c,d,e){return this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{},'<ul>\n    <li>\n        <a href="http://patatap.com" target="_blank" style="border-bottom: 0;"><strong>Patatap</strong></a>\n    </li>\n    <li>\n        <a href="mailto:inquiries@patatap.com">Inquiries</a>\n    </li>\n    <li>\n        <a id="embed-button" href="#">Embed</a>\n    </li>\n    <li>\n        <a id="merchandise-button" href="#">Merchandise</a>\n    </li>\n    <li>\n        <a id="jonobr1" href="http://jonobr1.com/" target="_blank">jonobr1</a> + <a id="lullatone" href="http://lullatone.com/" target="_blank">lullatone</a>\n    </li>\n    <li>\n        <div id="loops" >\n            <svg version="1.1" id="lp_recpause" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="16 16 32 32" enable-background="new 8 8 32 32" xml:space="preserve"><circle fill="#cccccc" cx="32" cy="32" r="10"></circle></svg>\n            <svg version="1.1" style="display:none" id="lp_stop" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="16 16 32 32" enable-background="new 8 8 16 16" xml:space="preserve"><rect x="20.75" y="20.125" width="20.5" height="20.5" fill="#cccccc"></rect></svg>\n            <!--<svg version="1.1" style="display:none" id="new_seq_button" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="16 16 32 32" enable-background="new 8 8 16 16" xml:space="preserve"><rect x="20.75" y="20.125" width="40.5" height="20.5" fill="#00ff00" /></svg>-->\n            <!--<svg version="1.1" id="play_seq_button" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="16px" height="16px" viewBox="8 8 16 16" enable-background="new 8 8 16 16" xml:space="preserve"><polygon  points="10 0,10 20,20 10" fill = "blue" stroke = "black" stroke-width = "1"/></svg>-->\n            <img src="images/icons/cabinet.png" style="display:none" id="new_seq_button">\n            <img src="images/icons/play2.png" id="play_seq_button">\n        </div>\n    </li>\n    <!--<li><div id="bpmSettings" /></li>-->\n    <!--<label for="bpm">bpm: </label><input type="text" id="bpmInput" name="bpmInput" value="120"/>-->\n    <li><div id="sequencerText-menu">\n        <span id="metro_trigger">&#9833</span><span id="signature"></span>/4 drum pattern, tempo <span id="tempo"></span> BPM\n        </div>\n    </li>\n    <!--<li><div id="sequencerbox" >-->\n        <!--<table id="pattern"><tr data-track="graphics"></tr></table>-->\n        <!--</div>-->\n    <!--</li>-->\n</ul>'}),this.JST["app/scripts/templates/SequencerLayout.hbs"]=Handlebars.template(function(a,b,c,d,e){return this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{},'<div id="toolsRegion"></div>\n<div id="barsRegion"></div>'}),this.JST["app/scripts/templates/SequencerToolbarPanel.hbs"]=Handlebars.template(function(a,b,c,d,e){return this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{},'<div id="outerSeqToolBar">\n    <div id="seqToolBar">\n        <div id="stopImg" align="left" class="float-left" style="width:20%;"><img src="images/icons/stop.png" id="stop_seq_button"></div>\n        <div id="sequencerbox" align="center" class="float-left" style="width:60%;">\n            <table id="pattern"><tr data-track="graphics"></tr></table>\n        </div>\n        <div id="closeImg" style="text-align: right; width:20%;" align="center" class="float-left"><img src="images/icons/close.png" id="closeSeqPanel" align="right"/></div>\n        <input id="bpmSlide" type="range" min="0" max="200" step="1" value="120" onchange="updateSlider(this.value)" /><span id="bpmChosen">120</div>\n</div>\n</div>'}),this.JST["app/scripts/templates/SongView.hbs"]=Handlebars.template(function(a,b,c,d,e){return this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{},'<thead>\n<tr id="barHeader">\n    <th><p>Click to activate a bar.</p></th>\n    <th>&nbsp;</th>\n</tr>\n</thead>\n<tbody></tbody>'}),NeuronalSynchrony.Models=NeuronalSynchrony.Models||{},function(){"use strict";NeuronalSynchrony.Models.BarModel=Backbone.Model.extend({url:"",initialize:function(){this.bind("remove",function(){this.destroy()})},defaults:{},validate:function(){},sync:BackbonePouch.sync({db:PouchDB("SEQdb")})})}(),NeuronalSynchrony.Collections=NeuronalSynchrony.Collections||{},function(){"use strict";NeuronalSynchrony.Collections.SongCollection=Backbone.Collection.extend({model:NeuronalSynchrony.Models.BarModel,parse:function(a){return _.pluck(a.rows,"value")}})}(),NeuronalSynchrony.Views=NeuronalSynchrony.Views||{},function(){"use strict";NeuronalSynchrony.Views.SongView=Backbone.Marionette.CompositeView.extend({tagName:"table",itemView:NeuronalSynchrony.Views.BarView,template:JST["app/scripts/templates/SongView.hbs"],itemViewContainer:"tbody",initialize:function(){this.listenTo(NeuronalSynchrony.Song,"add",this.update)},events:{"click .playBar":"playMe","click .deleteBar":"deleteBar"},itemIndex:0,itemViewOptions:function(a,b){return{itemIndex:b}},getItemView:function(a){var b=Marionette.getOption(this,"itemView")||this.constructor;b||throwError("An `itemView` must be specified","NoItemViewError");var c=0;return null!=this.collection&&(c=this.collection.length),a.set("len",c),b},appendHtml:function(a,b){if(a.isBuffering)a.elBuffer.appendChild(b.el),a._bufferedChildren.push(b);else{var c=this.getItemViewContainer(a);c.append(b.el)}},playMe:function(a){var b=a.currentTarget.parentElement.attributes["data-id"].value,c=NeuronalSynchrony.Song.where({_id:b});console.log("playMe: "+c[0].get("_id"));for(var d=0;d<NeuronalSynchrony.signature;d++){var e=NeuronalSynchrony.beats.graphics[d];null!=e&&(e.clear(),e.removeAllListeners())}var f=c[0].get("beatAssets");f.forEach(function(a,b){NeuronalSynchrony.startBeat("graphics",b,a,!0)})},deleteBar:function(a){var b=a.currentTarget.parentElement.attributes["data-id"].value,c=NeuronalSynchrony.Song.where({_id:b});console.log("deleteBar: "+c[0].get("_id")),NeuronalSynchrony.Song.remove(c,function(a){console.log(a?"err: "+a:"Deleting bar.")})},close:function(){console.log("closing SongView.")}})}(),NeuronalSynchrony.Views=NeuronalSynchrony.Views||{},function(){"use strict";NeuronalSynchrony.Views.BarView=Backbone.Marionette.ItemView.extend({tagName:"tr",template:JST["app/scripts/templates/BarView.hbs"],destroy:function(){this.model.destroy()},onBeforeRender:function(){this.model.set("index",this.options.itemIndex),$(this.el).attr("class","barRow"),$(this.el).attr("style","background-color:"+rainbowPastel(this.model.get("len"),this.options.itemIndex)),$(this.el).attr("data-id",this.model.get("_id")),$(this.el).attr("data-len",this.model.get("len")),$(this.el).attr("data-itemIndex",this.options.itemIndex)}})}(),NeuronalSynchrony.Views.SequencerPanelView=Backbone.Marionette.ItemView.extend({template:JST["app/scripts/templates/SequencerToolbarPanel.hbs"],events:{"click #closeSeqPanel":"hideSequencerPanel","click #stop_seq_button":"stopSeq"},stopSeq:function(){console.log("Stop seq..");for(var a=0;a<NeuronalSynchrony.signature;a++){var b=NeuronalSynchrony.beats.graphics[a];null!=b&&b.clear()}},hideSequencerPanel:function(){$("#sequencer_panel").hide()}}),function(){"use strict";NeuronalSynchrony.Layouts.SequencerLayout=Backbone.Marionette.Layout.extend({template:JST["app/scripts/templates/SequencerLayout.hbs"],regions:{barsRegion:"#barsRegion",toolsRegion:"#toolsRegion"}})}(),function(){"use strict";NeuronalSynchrony.Views.MainMenuView=Backbone.Marionette.ItemView.extend({template:JST["app/scripts/templates/MainMenuView.hbs"],events:{"click #sequencerText-menu":"toggleMetronome","click #new_seq_button":"newSequence","click #play_seq_button":"showSequencerPanel","change #bpmChosen":"changeBpm"},changeBpm:function(){console.log("bpm changed.")},showSequencerPanel:function(){$("#sequencer_panel").show()},toggleMetronome:function(){console.log("toggleMetronome"),NeuronalSynchrony.mute_metronome?(NeuronalSynchrony.mute_metronome=!1,$("#metro_trigger")[0].style.color="#000000",$("#metro_trigger")[0].style.textDecoration="none"):(NeuronalSynchrony.mute_metronome=!0,$("#metro_trigger")[0].style.color="red",$("#metro_trigger")[0].style.textDecoration="line-through")},newSequence:function(a){for(var b=[],c=0;c<NeuronalSynchrony.signature;c++){var a=NeuronalSynchrony.beats.graphics[c];if(null!=a){var d=a.asset;NeuronalSynchrony.currentBar=NeuronalSynchrony.currentBar+1,b[c]=d,a.clear()}}if(b.length>0){var e={sessionName:NeuronalSynchrony.sessionName,currentBar:NeuronalSynchrony.currentBar,beatAssets:b};NeuronalSynchrony.Song.create(e,{success:function(){console.log("added new record to song.")},error:function(a){console.log("Error saving: "+a)}})}},loadSequencePanel:function(){var a={query:{include_docs:!1,fun:{map:function(a){a.sessionName&&emit(a.sessionName,a)}}}};NeuronalSynchrony.Song.fetch({fetch:"query",options:a,success:function(a){console.log("item count: "+a.length);var b={collection:NeuronalSynchrony.Song,itemView:NeuronalSynchrony.Views.BarView},c=new NeuronalSynchrony.Views.SongView(b);NeuronalSynchrony.seqPanelRegion.on("show",function(){NeuronalSynchrony.SequencerLayout.toolsRegion.show(NeuronalSynchrony.SequencerPanel),NeuronalSynchrony.SequencerLayout.barsRegion.show(c)}),NeuronalSynchrony.seqPanelRegion.on("remove",function(){console.log("removing seqPanelRegion subviews."),NeuronalSynchrony.SequencerLayout.toolsRegion.remove(NeuronalSynchrony.SequencerPanel),NeuronalSynchrony.SequencerLayout.barsRegion.remove(c)
}),NeuronalSynchrony.seqPanelRegion.show(NeuronalSynchrony.SequencerLayout),$("#sequencer_panel").show()}})},stopSeq:function(){console.log("Stop seq..");for(var a=0;a<NeuronalSynchrony.signature;a++){var b=NeuronalSynchrony.beats.graphics[a];null!=b&&b.clear()}}})}(),$(function(){var a=120,b={},c=60/a,d=NeuronalSynchrony.signature*c;NeuronalSynchrony.beatCount=-1,NeuronalSynchrony.beats={};var e=function(){"";NeuronalSynchrony.beatCount=(NeuronalSynchrony.beatCount+1)%NeuronalSynchrony.signature,$("#pattern td").removeClass("active"),$("#pattern td:nth-child("+(NeuronalSynchrony.beatCount+1)+")").addClass("active")};NeuronalSynchrony.beatClock=NeuronalSynchrony.clock.callbackAtTime(e,0).repeat(c).tolerance(100),NeuronalSynchrony.startBeat=function(a,c,e){var f=function(g,h){{var i=NeuronalSynchrony.context.currentTime;Math.round(i%d)}if(null!=b[a])var j=b[a]();var k=function(){f(l.time+d,!1)},l=(j.start?j.start2(g):j.noteOn2(g)).tolerance(.01);h?console.log("isFirst is true! not triggering the sample."):null!=e&0!=e&&Duloop.simulateKeypress(e),l.asset=e,l.on("executed",k),l.on("expired",k),NeuronalSynchrony.beats[a][c]=l};f(g(c),!0)};var f=function(a,b){var c=NeuronalSynchrony.beats[a][b];c.clear(),c.removeAllListeners()},g=function(a){var b=NeuronalSynchrony.context.currentTime,e=Math.floor(b/d),f=Math.round(b%d);if(a>f){var g=e*d+a*c;return console.log("LESS: currentBeat: "+f+" beatInd: "+a+" currentTime: "+b+" currentBar: "+e+" nextBeatTime: "+g),g}var h=(e+1)*d+a*c;return console.log("MORE: currentBeat: "+f+" beatInd: "+a+" currentTime: "+b+" currentBar: "+e+" neatBeatTime: "+h),h},h=function(a){var c=new XMLHttpRequest;c.open("GET",a,!0),c.responseType="arraybuffer",c.onload=function(){NeuronalSynchrony.context.decodeAudioData(c.response,function(c){var d=function(){var a=NeuronalSynchrony.context.createBufferSource();return a.buffer=c,NeuronalSynchrony.mute_metronome&&(a.gain.value=0),a.connect(NeuronalSynchrony.context.destination),a};b[a]=d})},c.send()},i=function(a){var c=new XMLHttpRequest;c.open("GET","sounds/"+a+".wav",!0),c.responseType="arraybuffer",c.onload=function(){NeuronalSynchrony.context.decodeAudioData(c.response,function(c){var d=function(){var a=NeuronalSynchrony.context.createBufferSource();return a.buffer=c,a.gain.value=0,a.connect(NeuronalSynchrony.context.destination),a};b[a]=d})},c.send()};h("sounds/strike_edit.wav"),NeuronalSynchrony.beats["sounds/strike_edit.wav"]={},h("sounds/flash-2_edit.wav"),NeuronalSynchrony.beats["sounds/flash-2_edit.wav"]={},window.onload=function(){window.setTimeout(function(){$("#signature").html(NeuronalSynchrony.signature),$("#tempo").html(a),$("#pattern tr").each(function(){var a=$(this),b=a.data("track");i(b),NeuronalSynchrony.beats[b]={};for(var c=0;c<NeuronalSynchrony.signature;c++){var d=$('<td class="'+c+'"><div class="beat"></div></td>');d.appendTo(a),d.find(".beat").click(function(a){return function(){var c=$(this);c.hasClass("active")?(c.removeClass("active"),f(b,a)):(c.addClass("active"),NeuronalSynchrony.startBeat(b,a,!1))}}(c))}}),NeuronalSynchrony.startBeat("sounds/flash-2_edit.wav",0,!1),NeuronalSynchrony.startBeat("sounds/strike_edit.wav",1,!1),NeuronalSynchrony.startBeat("sounds/strike_edit.wav",2,!1),NeuronalSynchrony.startBeat("sounds/strike_edit.wav",3,!1),NeuronalSynchrony.mute_metronome=!0,$("#metro_trigger")[0].style.color="red",$("#metro_trigger")[0].style.textDecoration="line-through"},2e3)}});